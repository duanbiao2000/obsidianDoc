---
aliases:
  - Proper Abstractions
date: 2025-11-05 11:37
tags:
source:
  - https://github.com/duanbiao2000/claude-flow/blob/main/.claude/agents/core/reviewer.md
update:
rating:
related:
  - "[[不为清单：系统熵增防御协议]]"
  - "[[代码认知负荷：高效工程的底层度量]]"
  - "[[通用思维模式]]"
view-count: 9
---
# 抽象设计：从编码到架构的认知跃迁（一页清）

---

## 💎 核心公式

$$\text{好抽象} = \frac{\text{隐藏细节} \times \text{暴露意图}}{\text{变更成本}} \quad \text{s.t.} \quad \text{层级数} \to \min$$

**目标：** 让未来变化变得"无聊"（Boring）

---

## 🎯 抽象设计十诫

| # | 原则 | 公式/表现 | 权重 |
|---|------|-----------|------|
| 1 | **恰当抽象 = 隐藏细节** | $C_{\text{复杂度}} = f(\text{暴露接口}) \downarrow$ | ★★★★★ |
| 2 | **单一职责定义边界** | $\text{抽象} \perp \text{其他职责}$ | ★★★★★ |
| 3 | **接口定义 What** | $I = \text{What}, \quad M = \text{How}$ | ★★★★★ |
| 4 | **变化点应被隔离** | $\Delta \text{需求} \Rightarrow \Delta \text{实现} \not\Rightarrow \Delta \text{接口}$ | ★★★★★ |
| 5 | **依赖抽象非实现** | $\text{可替换性} \uparrow$ | ★★★ |
| 6 | **命名即意图** | $\text{误用率} \propto \frac{1}{\text{命名精度}}$ | ★★★★ |
| 7 | **抽象应可删除** | $\text{允许}(\text{合并/移除/回退})$ | ❗ 关键 |
| 8 | **延迟抽象** | $\text{等变化真实出现才抽}$ | ❗ 反直觉 |
| 9 | **过度抽象 = 负债** | $\text{层级} \uparrow \Rightarrow \text{理解} \downarrow$ | ❗ 警告 |
| 10 | **好抽象 ≈ 黑盒** | $\text{知}(I, O) \Rightarrow \text{可用}$ | ★★★★ |

---

## 🚫 抽象反模式

### 致命错误

$$\text{失败抽象} = \begin{cases}
\text{职责混合} & \text{多目标} \to \text{耦合} \uparrow \\
\text{过度分层} & \text{层级} \uparrow \to \text{理解} \downarrow \\
\text{重复抽象} & \text{功能重叠} \to \text{维护} \uparrow \\
\text{暴露状态} & \text{public state} \to \text{封装破坏}
\end{cases}$$

### 常见陷阱

| 症状 | 根因 | 后果 |
|------|------|------|
| **大函数** | 缺抽象 | 责任分散 |
| **需求变更=大改代码** | 变化点未隔离 | 维护成本 ↑ |
| **技术命名** | 非领域语言 | 语义弱 |
| **横切逻辑散落** | 未装饰器化 | 重复代码 |

---

## 🧠 Staff/Principal 隐藏信号

### 认知跃迁标志

| # | 信号 | 中级 | 高级 | Staff+ |
|---|------|------|------|--------|
| 1 | **设计前讨论** | 现在怎么实现 | 如何扩展 | **哪部分半年内会变** |
| 2 | **抽象数量** | 多而细 | 适中 | **少而必要** |
| 3 | **接口稳定性** | $\Delta I = \Delta M$ | $\Delta I < \Delta M$ | **$\Delta I \approx 0$** |
| 4 | **命名层级** | 技术词 | 混合 | **领域词** |
| 5 | **抽象时机** | 提前设计 | 适时抽象 | **延迟抽象** |
| 6 | **重构目标** | DRY/优雅 | 可读性 | **变更成本 ↓** |
| 7 | **Review 焦点** | 格式/语法 | 逻辑正确 | **系统级风险** |
| 8 | **反向能力** | 知道何时抽象 | - | **知道何时不抽象** |
| 9 | **抽象可逆性** | 难删除 | - | **易删除/回退** |
| 10 | **团队影响** | 个人产出 | 团队效率 | **新人快速上手** |

---

## ⚖️ Staff vs Principal 微妙差异

$$\text{架构师级别} = f(\text{抽象范围}, \text{关注点}, \text{成功标志})$$

| 维度 | Staff | Principal |
|------|-------|-----------|
| **抽象范围** | 单系统 | 跨系统 |
| **关注点** | 变化成本 | 组织成本 |
| **抽象对象** | 代码 | 团队 + 接口 |
| **成功标志** | 系统稳定 | 组织不痛 |
| **决策权重** | 技术债 | 组织债 |

---

## 📊 抽象质量评估矩阵

### 定量指标

$$Q_{\text{抽象}} = \frac{S \times M \times R}{L \times D}$$

其中：
- $S$：单一职责度 (Single Responsibility)
- $M$：可维护性 (Maintainability)
- $R$：可替换性 (Replaceability)
- $L$：抽象层级数 (Layers)
- $D$：依赖复杂度 (Dependencies)

### 定性检查

```
□ 接口变更频率 < 实现变更频率？
□ 能用一句话说清职责？
□ 命名来自业务领域而非技术？
□ 新需求主要改实现而非接口？
□ 能在5分钟内向新人解释？
□ 可以安全删除或替换？
```

---

## 🎓 晋升评审 Rubric（1页版）

### Staff Engineer 标准

$$\text{Staff} = \begin{cases}
\text{设计前} & \text{能画出变化边界} \\
\text{抽象} & \text{少而必要} \\
\text{接口} & \text{比实现稳定10x+} \\
\text{命名} & \text{领域语言占比>80\%} \\
\text{判断} & \text{知道何时不抽象}
\end{cases}$$

### Principal Engineer 标准

$$\text{Principal} = \text{Staff} + \begin{cases}
\text{跨系统} & \text{抽象多个团队接口} \\
\text{组织} & \text{降低协作成本} \\
\text{债务} & \text{权衡技术债 vs 组织债} \\
\text{影响} & \text{让整个组织更快}
\end{cases}$$

---

## 💡 内行识别内行的一句话

> **"This design makes future changes boring."**  
> （这个设计让未来的变更变得无聊）

**解读：**
- Boring = 可预测
- Boring = 低风险
- Boring = 廉价变更
- Boring ≠ 简单粗暴

---

## 🔑 实践公式总结

$$\boxed{
\begin{aligned}
\text{好抽象} &= \arg\min_{A} \frac{\text{变更成本}}{\text{表达力}} \\
&\text{s.t.} \quad \text{职责单一} \\
&\quad \quad \text{接口稳定} \\
&\quad \quad \text{实现可变} \\
&\quad \quad \text{层级最少} \\
&\quad \quad \text{可被删除}
\end{aligned}
}$$

---

**关联笔记：** [[Go 语言设计哲学]] | [[No Magic, Just Code设计哲学]] | [[World-class Engineer 自检一页纸]]