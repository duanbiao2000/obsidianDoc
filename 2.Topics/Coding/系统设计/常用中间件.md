---
view-count: 3
---
这份表格列出了 Traefik（一个现代化的反向代理和负载均衡器）中可用的 **HTTP 中间件（Middleware）**，并按其用途进行了分类。中间件在 Traefik 的请求处理流程中起到“插件”作用，可以在请求被转发到后端服务之前或之后对请求/响应进行修改、增强或控制。

下面是对各类中间件及其用途的简要介绍：

---

### 🔧 **路径修改类（Path Modifier）**

用于修改传入请求的 URL 路径：

- **AddPrefix**：为请求路径添加前缀。
- **ReplacePath**：将整个路径替换为指定值。
- **ReplacePathRegex**：使用正则表达式替换路径。
- **StripPrefix**：移除路径开头的指定前缀。
- **StripPrefixRegex**：使用正则表达式移除路径前缀。

> 适用于微服务路由时路径重写，比如将 `/api/user` 转发给后端时去掉 `/api`。

---

### 🔒 **安全与认证类（Security, Authentication）**

用于加强访问控制和身份验证：

- **BasicAuth / DigestAuth**：分别实现 HTTP 基本认证和摘要认证。
- **ForwardAuth**：将认证委托给外部服务（如 OAuth2 Proxy）。
- **IPAllowList**：只允许特定 IP 或 IP 段访问。
- **Headers**：设置或删除请求/响应头（如 CSP、HSTS 等安全头）。
- **PassTLSClientCert**：将客户端 TLS 证书信息以 Header 形式传递给后端。

> 常用于保护敏感接口、实现零信任架构或集成企业认证系统。

---

### 🔄 **请求生命周期管理（Request Lifecycle）**

影响请求如何被处理、转发或限制：

- **Buffering**：缓冲请求体和响应体，避免流式传输问题。
- **CircuitBreaker**：当后端服务失败率过高时自动熔断，防止雪崩。
- **Errors**：自定义错误页面（如 500、502 页面）。
- **InFlightReq**：限制同一时间处理的并发请求数。
- **RateLimit**：限制客户端请求频率（防刷、防爆破）。
- **RedirectScheme / RedirectRegex**：根据协议（HTTP→HTTPS）或正则规则重定向。
- **Retry**：在请求失败时自动重试（可配置次数和条件）。

> 提升系统稳定性、用户体验和抗压能力。

---

### 📦 **内容处理类（Content Modifier）**

直接操作响应内容：

- **Compress**：对响应启用 Gzip/Brotli 压缩，减少带宽。

---

### 🧩 **其他（Misc）**

- **Chain**：将多个中间件组合成一个逻辑单元，便于复用。
- **ContentType**：自动检测并设置 `Content-Type` 响应头（基于文件扩展名等）。

---

### 使用建议

- 中间件可按需组合，顺序很重要（例如先认证再限流）。
- 在 Kubernetes IngressRoute、Docker Label 或静态配置中均可声明。
- 安全类中间件（如 IPAllowList + BasicAuth）常用于内部管理接口。

如果你有具体场景（比如“如何把 /old 路由重定向到 /new”或“如何限制 API 每秒最多 10 次调用”），我可以给出对应的中间件配置示例。