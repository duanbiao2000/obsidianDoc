---
aliases:
  - 2周独立开发协议
date: 2025-12-07 20:42
tags:
source:
update:
rating:
related:
  - "[[为开源项目贡献核心代码]]"
  - "[[2025-12-13-后端仓库分类型阅读策略]]"
  - "[[2025-12-03-specs开发阶段]]"
view-count: 14
---

## 1. 宏观对齐与本地化 (D1-D2)

### A. 索要核心文档 (Source of Truth)
- [ ] 架构图 (Architecture) & 依赖图 (Dependency Map)
- [ ] API 文档 (Swagger/OpenAPI)
- [ ] DB Schema & 迁移指南
- [ ] 团队规范 (Coding Standards)

### B. 服务映射 (Mapping)
```bash
# 目标：画出拓扑图
[API Gateway] -> [User Svc] -> [Postgres]
               -> [Order Svc] -> [Kafka] -> [Payment Svc]
```

### C. 启动主服务 (Local Setup)
1. **识别入口**: `ls | grep -E "Dockerfile|docker-compose|Makefile"`
2. **启动命令**: 
   - `docker-compose up -d`
   - `make setup && make run`
3. **验证**: `curl localhost:8000/health`

### D. 结构扫描 (Structure Scan)
- **代码布局**: `tree -L 2 -I 'venv|node_modules'`
- **启动点**: 检查 `main.py`, `app.py` 或 `server.py`
- **配置**: 检查 `config.py` 或 `.env`

---

## 2. 业务流追踪 (D3-D5)

### A. 完整链路追踪 (Case Study: Create Order)
1. **Entry**: 查找 `@router.post("/orders")`
2. **Logic**: 进入 `services/order_service.py`
3. **Model**: 检查 `models/order.py`
4. **Integration**: 查找跨服务调用 (`httpx.post` 或 `grpc`)
5. **Async**: 查找事件发布 (`publish_event`)

### B. 测试与迁移协议
- **运行测试**: `pytest -v` 或 `make test`
- **查看 Mock**: 检查 `tests/conftest.py`
- **DB 迁移**:
  - `alembic current` (查看版本)
  - `alembic upgrade head` (升级)
  - `alembic revision -m "msg"` (新建迁移)

---

## 3. 专项深化 (D6-D10)

### A. 基础设施矩阵
| 领域 | 追踪动作 | 关键问题 (Why) |
| :--- | :--- | :--- |
| **缓存** | `grep -r "cache\|redis"` | TTL 是多少？有无预热？ |
| **异常** | `find . -name "exceptions.py"` | 错误响应格式是否统一？ |
| **安全** | `grep -r "jwt\|oauth"` | Token 何时过期？权限在哪层校验？ |
| **异步** | `grep -r "kafka\|celery"` | 消息幂等性如何保证？有无 DLQ？ |

### B. 监控与日志
- **日志**: `grep -r "logging"` (检查有无 Trace-ID)
- **指标**: `curl localhost:8000/metrics` (Prometheus 格式)

---

## 4. 工业级提效工具 `toolbox`

```bash
# 快速定位业务逻辑
grep -r "def create_" app/services/ --include="*.py"

# 查找环境变量配置
grep -r "os.environ\|config\." app/ | sort | uniq

# 监控本地容器日志
docker logs -f --tail 100 <service_name>
```

---

## 5. 故障排查协议 `troubleshooting`

| 现象 | 排查动作 |
| :--- | :--- |
| **Connection Refused** | 检查 `docker ps`；确认环境变量 `SVC_URL` 正确性。 |
| **DB Error** | 确认测试库已创建；运行 `alembic upgrade head`。 |
| **Timeout** | 检查网络拓扑；在调用点增加 DEBUG 日志追踪延迟。 |

---

## 6. 完工定义 (Definition of Done)
- [ ] 产出主要业务流程图 (Mermaid/Excalidraw)
- [ ] 建立服务端口/负责人速查表
- [ ] **提交第一个 PR**: (修复文档 / 增加缺失日志 / 补全单测)

**最后更新: 2026-01-01**