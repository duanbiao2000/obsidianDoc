---
date: 2025-05-19 13:58
tags:
view-count: 8
---
# 领域驱动设计 (DDD)：极简架构指南

---

### 一、 核心本质
**业务模型驱动代码**。
目标：将**核心业务逻辑**与**技术细节**彻底解耦，使代码结构即业务语义。

### 二、 四层架构模型 (Layered Architecture)

| 层级 | 职责 | 关注点 | 依赖方向 |
| :--- | :--- | :--- | :--- |
| **1. Interface (接口层)** | 协议转换、DTO 封装 | Web/RPC/MQ 适配 | ↓ 调用 App |
| **2. Application (应用层)** | 用例编排、事务、权限 | 业务流程 (无业务规则) | ↓ 调用 Domain |
| **3. Domain (领域层)** | ★ 实体、VO、聚合、规则 | **业务核心 (无技术依赖)** | 核心 |
| **4. Infrastructure (基础层)** | DB、缓存、MQ 实现 | 技术细节 (Repository 实现) | ↑ 支撑全层 |

### 三、 领域对象矩阵

| 对象 | 唯一标识 (ID) | 状态 | 行为 | 例子 |
| :--- | :--- | :--- | :--- | :--- |
| **Entity (实体)** | 有 | 可变，有生命周期 | 包含核心业务逻辑 | 用户、订单 |
| **Value Object (VO)** | 无 (属性即身份) | **不可变** | 包含校验/计算逻辑 | 货币、地址 |
| **Aggregate (聚合)** | 聚合根 ID | 一致性边界 | 守卫内部一致性 | 订单+订单项 |

### 四、 核心模式：Repository vs. Mapper

- **Repository (领域层接口)**：面向**聚合根**。定义“我要什么数据”，隐藏存储细节。
- **Mapper (基础层实现)**：面向**数据表**。处理 SQL 映射、DO 转换。
- **本质区别**：Repository 是业务契约，Mapper 是技术实现。

### 五、 协作逻辑流 (Logic Flow)
1. **Application** 接收请求 $\rightarrow$ 
2. 通过 **Repository** 加载 **Aggregate** $\rightarrow$ 
3. 执行 **Aggregate/Entity** 内部行为 (业务规则) $\rightarrow$ 
4. 通过 **Repository** 保存状态。

### 六、 避坑指南 (Anti-Patterns)
- ❗ **贫血模型**：只有 Getter/Setter 的实体。**药方**：逻辑移回实体。
- ❗ **胖应用服务**：在 Application 层写业务规则。**药方**：逻辑移入 Domain。
- ❗ **技术侵入**：Domain 层引用了 Spring/MyBatis。**药方**：通过 Repository 接口解耦。
- ❗ **聚合过大**：将整个 DB 连成一个大聚合。**药方**：以事务一致性为最小边界。

### 七、 极简金句
**逻辑在 Domain，流程在 App，技术在 Infra；代码不只是运行的机器，更是业务的说明书。**