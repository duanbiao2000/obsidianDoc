---
view-count: 10
update: 2026-01-07 00:25
related:
  - "[[2025-12-04-系统设计文档与 PRD、Spec]]"
  - "[[RFC战略框架]]"
  - "[[文档化Planning]]"
---

# 技术文档：极简矩阵

| 特性     | RFC / 设计文档         | ADR (决策记录)   | 技术设计方案       | 部署计划 / 运维手册   |
| :----- | :----------------- | :----------- | :----------- | :------------ |
| **核心** | **为什么**做 & **做什么** | **为什么**这样选   | **如何**实现细节   | **如何**上线 & 回滚 |
| **范围** | 跨团队大型变更            | 关键决策点        | 单个功能/服务      | 具体的发布流程       |
| **时机** | 项目最早期              | 选型确定后        | 开发前          | 部署前           |
| **重量** | **重** (达成共识)       | **轻** (记录背景) | **中** (指导开发) | **重** (操作精确)  |
| **目标** | 战略对齐               | 历史溯源         | 消除实现歧义       | 安全发布          |

---

# 实例演示：实时协作功能

### 1. [[RFC战略框架]]

**标题：引入实时协作引擎**

- **摘要**：实现类似 Google Docs 的多人编辑，提升协作效率。
- **动机**：当前数据覆盖冲突严重，竞品已支持。
- **目标**：延迟 < 200ms；并发连接 > 10,000。
- **方案**：
  - **方案 A (推荐)**：自研 WebSocket + OT 算法。控权强，复杂度高。
  - **方案 B**：第三方 SDK (LiveBlocks)。上线快，成本高。
- **风险**：OT 算法实现难度大。

### 2. ADR (决策快照)

**标题：ADR-005: 采用 WebSocket 协议**

- **状态**：已接受
- **背景**：需在 WebSocket 与 Long-Polling 间选型。
- **决策**：使用 WebSocket。
- **理由**：
  - 全双工通信，延迟极低。
  - 节省服务器连接开销。
- **后果**：
  - 需配置网关 (Nginx) 支持。
  - 客户端需实现断线重连逻辑。

### 3. 技术设计方案 (逻辑细节)

**标题：实时评论模块实现**

- **接口**：
  - WS: `join_task` / `new_comment`。
  - REST: `POST /comments` (数据持久化)。
- **前端**：监听 `new_comment` 事件 $\rightarrow$ 动态插入 DOM。
- **后端**：
  - 维护 `task_id` $\rightarrow$ `connections` 映射。
  - DB 写入成功 $\rightarrow$ 检索数据 $\rightarrow$ 广播房间成员。

### 4. 部署计划 (上线操作)

**标题：实时协作服务 v1.0 上线**

- **窗口**：2026-01-15 02:00 - 03:00 AM
- **步骤**：
  1. 开启维护模式。
  2. 备份数据库。
  3. 执行 `V3.2.1` SQL 迁移。
  4. 部署 `collab-service`。
  5. 部署 `main-app`。
- **验证**：Pod 运行状态 $\rightarrow$ 测试账号实测 $\rightarrow$ 监控连接数。
- **回滚**：5xx 报错 $\rightarrow$ 回退代码版本 $\rightarrow$ 缩容新服务 $\rightarrow$ 执行数据库回滚脚本。
-

---
