---
date: 2025-05-17 12:58
tags:
  - System/DG/Seedling
source: >-
  https://www.bilibili.com/video/BV1UJc2ezEFU/?spm_id_from=333.1387.upload.video_card.click&vd_source=7038f96b6bb3b14743531b102b109c43
update: 2025-05-17 13:19
---

**TLDR**: 图展示“分布式集群”页面，列出 Nacos、OpenFeign、Sentinel、Gateway 和 Seata 五种微服务治理工具，分别支持服务发现、远程调用、流量控制、网关管理和分布式事务。

---

![image.png](https://cdn.jsdelivr.net/gh/duanbiao2000/BlogGallery@main/picutre/20250517125918154.png)
![image.png](https://cdn.jsdelivr.net/gh/duanbiao2000/BlogGallery@main/picutre/20250517130030070.png)

### 详细讲解（简洁版，符合 TLDR 风格）

#### 1. **图示内容**

- 页面标题“分布式集群”，展示 5 个微服务治理工具：Nacos、OpenFeign、Sentinel、Gateway、Seata。

#### 2. **工具解析**

##### 1. **Nacos**

- **功能**：服务注册与发现、配置中心。
- **特点**：支持动态服务发现（类似 Consul），集成配置管理，适合 Spring Cloud。
- **关键点**：心跳检测（默认 5 秒），支持多租户。

##### 2. **OpenFeign**

- **功能**：声明式服务调用。
- **特点**：简化 HTTP 调用，集成 Spring Cloud，类似 gRPC 但更轻量。
- **关键点**：支持负载均衡（结合 Ribbon），需配置超时（默认 1 秒）。

##### 3. **Sentinel**

- **功能**：流量控制与熔断降级。
- **特点**：提供限流、断路器（类似 Resilience4j），支持动态规则。
- **关键点**：QPS 限流（建议 1000），熔断窗口（10 次，50% 失败）。

##### 4. **Gateway**

- **功能**：API 网关（如 Spring Cloud Gateway）。
- **特点**：路由转发、过滤，支持限流和认证。
- **关键点**：集成 Sentinel 限流，配置路由规则（需正则优化）。

##### 5. **Seata**

- **功能**：分布式事务管理。
- **特点**：支持 AT、TCC 模式，解决微服务事务一致性。
- **关键点**：AT 模式性能高（1000 TPS），需配置事务日志表。

#### 3. **优缺点分析**

- **优点**：
  - 各工具专注单一职责，组合使用覆盖微服务治理全链路。
  - 开源成熟，社区支持强。
- **缺点**：
  - 集成复杂，需调优（如 Sentinel 规则）。
  - 学习曲线高，需熟悉 Spring Cloud 生态。

#### 4. **未来展望**

- 截至 2025年5月16日09:56 PM MST，微服务治理工具正向 AI 驱动（如 Sentinel 智能限流）和零信任安全演进。
- 适用于分布式系统（如新闻分类任务）。

如需代码实现，告诉我！

## 微服务与分布式

分布式和微服务是**相关但不等价**的两个概念，它们之间有交集但关注点不同。可以这样理解：

---

## ✅ 一句话区分：

> **分布式系统** 是一种**架构部署方式**，而\
> **微服务架构** 是一种**应用设计模式**。

---

## 🔍 概念解析

### 1. **分布式系统（Distributed System）**

- 指：将应用程序运行在多台物理/虚拟机器上，每台机器处理整体功能的一部分。

- 核心关注：**系统可用性、容错、网络通信、一致性、分布式存储、任务协调等**

- 举例：

  - 分布式文件系统（HDFS）

  - 分布式数据库（Cassandra）

  - MapReduce 计算模型

  - ZooKeeper 协调服务

---

### 2. **微服务架构（Microservices Architecture）**

- 指：将大型应用拆分为多个小服务，每个服务负责单一业务功能，**自治部署、独立扩展、独立开发**。

- 核心关注：**业务解耦、快速迭代、服务自治、可观察性、部署灵活性**

- 举例：

  - 订单服务、支付服务、用户服务分别独立

  - 每个服务有自己的数据库和 REST/gRPC 接口

  - 可以由不同团队使用不同语言开发（Polyglot）

---

## 🔁 它们的关系

| 项    | 描述                                                            |
| ---- | ------------------------------------------------------------- |
| 关系   | 微服务 **通常** 部署在分布式系统上（但也可以本地模拟）                                |
| 区别点  | 分布式更偏重**系统层面**，微服务更偏重**软件架构设计**                               |
| 依赖性  | 微服务是构建**分布式系统的一种方式**                                          |
| 实现要求 | 微服务需要基础设施支持如**服务注册、网关、配置中心、服务发现、负载均衡、分布式事务**等，这些正是分布式系统所提供的能力 |

---

## ✅ 举个例子：

如果你有一个用户系统 + 商品系统 + 订单系统，分布式表示它们部署在不同机器或节点上；

而微服务表示你把这三个业务模块拆成三个独立服务，分别开发、部署、演进。

> 💡你可以开发微服务但部署在同一台机器上（非分布式），也可以用单体系统部署在分布式环境中。

---

## 🔮 趋势与融合

- 现代微服务几乎都运行在分布式环境（如 Kubernetes）

- 云原生架构中，**微服务是分布式系统的默认实现方式**

- 微服务需要：

  - **服务网格（如 Istio）**

  - **容器编排（Kubernetes）**

  - **链路追踪（OpenTelemetry）**

  - **配置中心（Spring Cloud Config）**

  - **容错机制（Resilience4j）**

---

## ✅ 总结图示：

```
分布式系统
├── 微服务架构（常见形式）
├── 单体应用的集群部署
├── 分布式数据库
├── 分布式缓存
└── 任务调度与一致性管理

微服务架构
├── 基于分布式部署（一般如此）
├── 拆分服务 & 独立开发
└── 构建在分布式系统能力之上
```

---

如你想进一步探索：

- **单体 → 微服务的演进过程**

- **微服务在 AI 系统中的应用设计**

- **Serverless 和微服务的对比**

我可以继续展开。是否需要？


## 🚨 Sentinel vs Hystrix vs Resilience4j

| 特性     | Sentinel | Hystrix | Resilience4j |
| ------ | -------- | ------- | ------------ |
| 限流     | ✅ 强      | ❌ 无     | ⚠️ 有限        |
| 熔断降级   | ✅ 支持     | ✅ 支持    | ✅ 支持         |
| 控制台    | ✅ 内置 UI  | ❌ 无     | ❌ 无原生        |
| 扩展性    | ✅ SPI 插拔 | ⚠️ 低    | ✅ Java 原生    |
| 当前维护状态 | ✅ 活跃     | ❌ 停止维护  | ✅ 活跃         |

## Gateway
![image.png](https://cdn.jsdelivr.net/gh/duanbiao2000/BlogGallery@main/picutre/20250517210022920.png)

在分布式系统中，**Gateway（API 网关）** 是整个架构中至关重要的一环，主要充当 **客户端和后端微服务之间的“入口”**。它起着统一接入、请求转发、安全控制、流量治理等作用，常见于微服务架构中，如 Spring Cloud Gateway、Kong、Nginx、Envoy 等。

---

## 🧭 Gateway 的主要作用

|功能|说明|
|---|---|
|🔀 路由转发|将客户端请求路由到正确的微服务|
|🔐 安全认证|接入 OAuth 2.0、JWT 等统一认证|
|📊 请求监控|日志记录、追踪、监控接口调用情况|
|🚦 限流/熔断|控制请求频率，保护下游服务|
|🧱 协议转换|如 HTTP ↔ gRPC|
|🧹 参数/头部处理|添加/移除/修改请求头或参数|
|🧪 A/B 测试、灰度发布|动态流量分发|

---

# Saga 模式详解

---

## 1. 什么是 Saga 模式？

Saga 模式是一种用于管理分布式事务的 **柔性事务解决方案**，它将一个分布式事务拆分成一系列局部事务（子事务），每个局部事务都可以独立提交。

- 每个局部事务成功执行后，Saga 会继续执行下一个局部事务。
    
- 如果某个局部事务失败，Saga 会依次执行已经成功局部事务对应的**补偿事务**，用以撤销之前的操作。
    

**目标是通过业务层补偿实现最终一致性，而不是依赖数据库的锁和回滚机制。**

---

## 2. Saga 的工作流程

假设有3个子事务T1, T2, T3：

1. 执行 T1，成功
    
2. 执行 T2，成功
    
3. 执行 T3，失败 → 触发补偿流程
    
4. 执行 T2 的补偿事务
    
5. 执行 T1 的补偿事务
    
6. 整个 Saga 事务回滚完成，业务状态回到初始状态或可接受的状态
    

---

## 3. 实现方式

### 3.1 编排型 Saga（Orchestration-Based）

- 有一个中心协调器（编排者）负责管理事务执行顺序和补偿事务调用。
    
- 中心协调器告诉各个服务执行具体的本地事务或补偿事务。
    
- 优点：事务流程明确，易于监控和管理。
    
- 缺点：中心点可能成为瓶颈，单点故障需考虑。
    

### 3.2 协作型 Saga（Choreography-Based）

- 没有中心协调器，服务之间通过事件驱动异步通信完成事务执行和补偿。
    
- 服务自己监听事件，触发下游事务或补偿。
    
- 优点：去中心化，系统耦合度低，扩展性好。
    
- 缺点：复杂的事件链难以监控和管理，容易产生状态不一致。
    

---

## 4. Saga 模式的优势

- **避免分布式锁和全局事务**，提升系统吞吐量和可用性。
    
- 支持 **跨数据库、跨系统、跨语言** 的分布式事务。
    
- **异步执行**，适合长事务和复杂业务流程。
    
- 适合 **微服务架构** 下的业务场景，提升服务解耦。
    

---

## 5. Saga 模式的挑战和不足

- **补偿事务设计复杂**，需要业务层深刻理解业务流程和状态转换。
    
- **补偿失败的处理**：补偿操作也可能失败，需要额外机制保证最终一致。
    
- **事务状态管理复杂**，需要专门的 Saga 管理组件或框架。
    
- **无法保证严格的强一致性**，只保证最终一致性。
    

---

## 6. Saga 与传统分布式事务（2PC）对比

|维度|传统两阶段提交（2PC）|Saga 模式|
|---|---|---|
|一致性保障|强一致性（原子性）|最终一致性|
|事务锁|持有资源锁直到全局事务完成|不持锁，异步补偿|
|性能|较低，受锁和协调影响|较高，非阻塞异步|
|容错能力|低，协调器故障会导致阻塞或不一致|高，支持异步补偿和重试机制|
|复杂度|较低，事务由数据库保证|较高，业务层需设计补偿逻辑|

---

## 7. Saga 模式应用场景示例

- 电商订单服务：下单、扣库存、支付三个服务跨多个数据库或系统，需要保证最终一致。
    
- 旅行预订：机票、酒店、租车预订需要分布式协调，若某环节失败，前面服务需要补偿。
    
- 金融支付链路：多机构、多账本操作的业务流程控制。
    

---

## 8. 相关技术栈和框架

- **Seata 的 SAGA 模式**：支持 Saga 编排，结合 TCC 和补偿机制。
    
- **Axon Framework**：基于事件驱动的 Saga 实现。
    
- **Eventuate Tram Saga**：基于事件溯源的分布式 Saga。
    
- **Camunda** 和 **Zeebe**：工作流引擎，支持 Saga 事务管理。
    

---

## 5So


**基于笔记内容的起始点：**
这篇笔记详细介绍了构建分布式微服务系统的关键技术和工具，包括服务发现、服务调用、流量控制、API网关、分布式事务等，并辨析了分布式与微服务的概念。

**So what? (所以呢？)**

1.  **So what? (1st So)**
    *   **问题：** 理解并掌握这些Spring Cloud治理工具（Nacos, Feign, Sentinel, Gateway, Seata）以及分布式与微服务的区别，对我有什么直接的意义？
    *   **答案：** 这意味着我获得了构建现代、具备弹性、可伸缩的微服务应用所需的核心技术栈知识。我能够理解每个组件的作用，并知道如何将它们组合起来解决分布式系统中的具体问题，如服务间的通信、流量管理和数据一致性。

2.  **So what? (2nd So)**
    *   **问题：** 能够构建具备弹性、可伸缩的微服务应用，这又带来了什么更深层的好处？
    *   **答案：** 这使我能够开发和维护能够应对高并发、复杂业务逻辑和持续变化需求的系统。这些系统不容易崩溃，可以根据负载自动扩展，并且不同的业务模块可以独立迭代和部署，极大地提高了开发效率和系统稳定性。

3.  **So what? (3rd So)**
    *   **问题：** 开发和维护这种高效稳定的大型分布式系统，对我的技术能力和职业发展意味着什么？
    *   **答案：** 这证明了我具备处理复杂系统架构、理解系统间交互和分布式难题的能力。这种能力是当前许多大型互联网公司、云计算平台以及需要处理海量数据和复杂业务场景的组织所急需的。掌握这些技术让我成为市场上有竞争力的高级技术人才。

4.  **So what? (4th So)**
    *   **问题：** 成为市场上有竞争力的高级技术人才，能够处理大型复杂系统，这最终会导向什么结果？
    *   **答案：** 这会带来更广阔的职业机会，能够参与更具挑战性和影响力的项目（包括笔记中提到的潜在AI/LLM微服务系统），获得更高的薪资和职业晋升空间，甚至有机会在技术团队中担任架构师或技术领导者的角色。

5.  **So what? (5th So)**
    *   **问题：** 最终能够在技术领域获得更高的地位和更大的影响力，解决大规模复杂问题，这对于我个人而言，意味着什么？
    *   **答案：** 这不仅仅是个人物质回报的提升，更意味着能够将我的技术能力转化为实际的价值输出，参与到推动技术发展、解决行业痛点甚至社会问题的过程中。我能够通过构建健壮可靠的系统，影响更多的用户或开发者，实现更大的个人成就感和价值。

通过这5个“So what?”的追问，我们可以从笔记表面的技术工具列表，一步步深入到掌握这些技术对个人能力、职业发展乃至更大范围影响的潜在价值。