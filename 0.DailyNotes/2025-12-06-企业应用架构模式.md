---
view-count: 3
---
# [[2025-12-06-企业应用架构模式]]：极简版

## 核心公式
**简单逻辑 = 事务脚本 (Transaction Script)**
**复杂业务 = 领域模型 (Domain Model)**
**数据同步 = 工作单元 (Unit of Work) + 映射器 (Mapper)**

---

## 1. 业务逻辑组织

| 模式 | 定义 | 适用场景 |
|:--- |:--- |:--- |
| **事务脚本** | 一个过程处理一个请求。 | 逻辑简单、快速交付。 |
| **领域模型** | 富对象封装状态与行为。 | 业务极其复杂、需长期维护。 |
| **表模块** | 一个类处理一张表的所有逻辑。 | 介于脚本与模型之间。 |
| **服务层** | 定义应用的边界与逻辑入口。 | 解耦表现层，微服务 API 雏形。 |

---

## 2. 数据源桥接 (ORM 核心)

- **Data Mapper |** 对象与数据库完全解耦（MyBatis/Hibernate 模式）。*现代主流。*
- **Active Record |** 对象自带 CRUD 逻辑（Rails/PHP 常用）。*适合简单 CRUD。*
- **Repository |** 将数据库伪装成内存集合。*DDD 核心。*
- **Unit of Work |** 维护变更清单，一次性提交事务。*减少 DB 往返。*
- **Identity Map |** 确保同一 ID 在内存中只有一个实例。*防止数据冲突。*

---

## 3. 并发与解耦工具

### I. 并发控制
- **乐观锁 |** 依靠版本号 ($@Version$)。适用于冲突少的场景。
- **悲观锁 |** 依靠数据库行锁 ($SELECT\ FOR\ UPDATE$)。适用于关键金额扣减。

### II. 数据流转
- **DTO |** 跨进程传输的纯数据包。防止暴露领域模型内部细节。
- **Value Object |** 无身份、不可变的描述性对象（如 Money 类，解决浮点误差）。
- **Separated Interface |** 接口与实现分离，支持插件化扩展。

---

## 4. 架构诊断三步法

1. **评估复杂度 |** 如果 $if-else$ 超过三层且多处重复，立即从脚本转向模型。
2. **定义分层 |** 确保表现层不写 SQL，领域层不处理 HTTP 请求。
3. **选择映射器 |** 追求极致解耦选 Data Mapper；追求极速开发选 Active Record。

---

## 5. 实践自检
- [ ] 核心业务是否被“贫血模型”（只有 getter/setter）架空？
- [ ] 关联对象是否使用了 **Lazy Load**（延迟加载）以优化性能？
- [ ] 跨团队接口是否使用了 **DTO** 进行隔离？

---

## 黄金法则
**不要为了架构而架构：逻辑简单时，脚本就是最高效的模式。**

---
**关联笔记：** [[2025-12-07-系统架构分类框架]] | [[2025-12-05-Python学习套件]]