å˜¿ï¼Œæ¥äº†ä¸ªå¥½é—®é¢˜ï¼reacté‡Œè¯·æ±‚ç¼“å­˜è¿™äº‹å„¿ï¼Œç¡®å®æŒºæœ‰æ„æ€ï¼Œæ¶‰åŠåˆ°å‰ç«¯æ¶æ„å’Œæ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒç‚¹ã€‚å’±ä»¬æ¥èŠèŠï¼Œåƒè€æœ‹å‹å” æŠ€æœ¯å—‘ä¸€æ ·ï¼Œå°½é‡è®²å¾—æ¸…æ¥šåˆä¸è£…ã€‚

é¦–å…ˆï¼Œreactæœ¬èº«ä½œä¸ºä¸€ä¸ªuiåº“ï¼Œå…¶å®å¹¶ä¸ç›´æ¥è´Ÿè´£è¯·æ±‚ç¼“å­˜è¿™ç§â€œåå‹¤â€å·¥ä½œã€‚å®ƒæ›´å…³å¿ƒç»„ä»¶æ¸²æŸ“ã€çŠ¶æ€ç®¡ç†å•¥çš„ã€‚è¯·æ±‚ç¼“å­˜é€šå¸¸æ˜¯ä½ åœ¨æ›´é«˜å±‚æ¬¡çš„æ¶æ„é‡Œå»å¤„ç†ï¼Œæ¯”å¦‚æ•°æ®è·å–å±‚ã€ç½‘ç»œå±‚ï¼Œç”šè‡³æ˜¯çŠ¶æ€ç®¡ç†åº“ã€‚æ‰€ä»¥ï¼Œè°æ¥å¤„ç†è¯·æ±‚ç¼“å­˜ï¼Ÿå¾—çœ‹ä½ çš„é¡¹ç›®å’‹æ­çš„ã€‚æˆ‘æ¥ç»™ä½ æ°å¼€è®²è®²å‡ ç§å¸¸è§åœºæ™¯ï¼Œç»“åˆç‚¹æˆ‘è‡ªå·±çš„ç»éªŒã€‚

### 1. ç”±æ•°æ®è·å–å±‚å¤„ç†ï¼ˆæ¯”å¦‚axiosã€fetchåŒ…è£…ï¼‰
æœ€å¸¸è§çš„åšæ³•æ˜¯æŠŠç¼“å­˜é€»è¾‘å¡åˆ°æ•°æ®è·å–å±‚ã€‚reactç»„ä»¶é‡Œåªç®¡è§¦å‘è¯·æ±‚ï¼Œç¼“å­˜çš„äº‹å„¿äº¤ç»™åº•å±‚çš„httpå®¢æˆ·ç«¯ã€‚æ¯”å¦‚æˆ‘ä¹‹å‰å¼„ä¸€ä¸ªç”µå•†é¡¹ç›®ï¼Œå•†å“æ•°æ®è€æ˜¯é‡å¤è¯·æ±‚ï¼ŒæœåŠ¡å™¨å‹åŠ›å¤§ä¸è¯´ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿå¡ã€‚äºæ˜¯æˆ‘åœ¨axiosä¸ŠåŒ…äº†ä¸€å±‚ç¼“å­˜é€»è¾‘ï¼Œç”¨ä¸ªmapå­˜è¯·æ±‚çš„urlå’Œç»“æœï¼Œå¸¦ä¸Šæ—¶é—´æˆ³ï¼Œ5åˆ†é’Ÿå†…é‡å¤è¯·æ±‚ç›´æ¥è¿”ç¼“å­˜ã€‚ä»£ç å¤§æ¦‚è¿™æ ·ï¼š

```js
const cache = new Map();
const getWithCache = async (url) => {
  if (cache.has(url)) {
    const { data, timestamp } = cache.get(url);
    if (Date.now() - timestamp < 5 * 60 * 1000) return data; // 5åˆ†é’Ÿæœ‰æ•ˆ
  }
  const response = await axios.get(url);
  cache.set(url, { data: response.data, timestamp: Date.now() });
  return response.data;
};
```

ç„¶ååœ¨reactç»„ä»¶é‡Œç›´æ¥è°ƒç”¨è¿™ä¸ªgetwithcacheï¼Œç»„ä»¶åªç®¡æ‹¿æ•°æ®æ¸²æŸ“ï¼Œä¸ç”¨æ“å¿ƒç¼“å­˜ã€‚è¿™ç§æ–¹å¼å¥½å¤„æ˜¯è·Ÿreactè§£è€¦ï¼Œå¤ç”¨æ€§å¼ºï¼Œå•¥æ¡†æ¶éƒ½èƒ½ç”¨ã€‚ç¼ºç‚¹æ˜¯ä½ å¾—è‡ªå·±ç»´æŠ¤ç¼“å­˜é€»è¾‘ï¼Œæ¯”å¦‚æ¸…ç†è¿‡æœŸç¼“å­˜å•¥çš„ã€‚

### 2. çŠ¶æ€ç®¡ç†åº“æ¥ç®¡ï¼ˆreduxã€zustandç­‰ï¼‰
å¦‚æœä½ ç”¨reduxã€zustandæˆ–è€…mobxè¿™ç§çŠ¶æ€ç®¡ç†åº“ï¼Œè¯·æ±‚ç¼“å­˜å¯ä»¥ç›´æ¥æ‰”åˆ°çŠ¶æ€å±‚ã€‚æ¯”å¦‚æˆ‘ä¹‹å‰æäº†ä¸ªå®æ—¶èŠå¤©appï¼Œç”¨zustandç®¡ç†çŠ¶æ€ï¼Œæ¯æ¬¡æ‹‰æ¶ˆæ¯åˆ—è¡¨éƒ½å¾—è¯·æ±‚åç«¯ï¼Œä½†ç”¨æˆ·è€æ˜¯åˆ‡æ¥åˆ‡å»ï¼Œé‡å¤è¯·æ±‚å¤ªæµªè´¹ã€‚äºæ˜¯æˆ‘åœ¨zustand storeé‡Œå­˜äº†ä¸ªmessagesç¼“å­˜ï¼Œkeyæ˜¯chatidï¼Œvalueæ˜¯æ¶ˆæ¯åˆ—è¡¨å’Œæ—¶é—´æˆ³ã€‚ç»„ä»¶é‡Œç”¨useeffectè§¦å‘actionï¼Œstoreé‡Œå…ˆæŸ¥ç¼“å­˜ï¼Œæœ‰å°±ç›´æ¥è¿”ï¼Œæ²¡æœ‰æ‰è¯·æ±‚ã€‚zustandçš„å†™æ³•å¤§æ¦‚è¿™æ ·ï¼š

```js
import create from 'zustand';

const useStore = create((set, get) => ({
  messages: {},
  fetchMessages: async (chatId) => {
    const cached = get().messages[chatId];
    if (cached && Date.now() - cached.timestamp < 5 * 60 * 1000) {
      return cached.data;
    }
    const response = await api.get(`/messages/${chatId}`);
    set((state) => ({
      messages: {
        ...state.messages,
        [chatId]: { data: response.data, timestamp: Date.now() },
      },
    }));
    return response.data;
  },
}));
```

è¿™ç§æ–¹å¼é€‚åˆå…¨å±€çŠ¶æ€ç®¡ç†ï¼Œç¼“å­˜é€»è¾‘è·Ÿä¸šåŠ¡é€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿæ–¹ä¾¿ã€‚reactç»„ä»¶åªç®¡ä»storeæ‹¿æ•°æ®ï¼Œå¹²å‡€å¾—å¾ˆã€‚ä¸è¿‡è¦æ˜¯é¡¹ç›®å°ï¼Œå•çº¯çš„apiè°ƒç”¨ï¼Œå¼•å…¥çŠ¶æ€ç®¡ç†åº“å¯èƒ½æœ‰ç‚¹é‡ã€‚

### 3. ç”¨react queryæˆ–swrè¿™æ ·çš„ä¸“ç”¨åº“
è¯´å®è¯ï¼Œç°ä»£reacté¡¹ç›®é‡Œï¼Œè¯·æ±‚ç¼“å­˜æˆ‘æ›´æ¨èç›´æ¥ä¸Šreact queryï¼ˆç°åœ¨å«tanstack queryï¼‰æˆ–è€…swrã€‚è¿™ä¿©åº“å¤©ç”Ÿå°±æ˜¯ä¸ºæ•°æ®è·å–å’Œç¼“å­˜è®¾è®¡çš„ï¼Œçœå¿ƒçœåŠ›ã€‚æ¯”å¦‚æˆ‘æœ€è¿‘æäº†ä¸ªdashboardï¼Œæ•°æ®å®æ—¶æ›´æ–°ï¼Œç”¨react queryï¼Œç¼“å­˜ã€è‡ªåŠ¨é‡è¯•ã€å¤±æ•ˆæ—¶é—´å•¥çš„å…¨éƒ½å†…ç½®ï¼Œç»„ä»¶é‡Œå‡ è¡Œä»£ç å°±æå®šï¼š

```jsx
import { useQuery } from '@tanstack/react-query';

const fetchData = async () => {
  const response = await axios.get('/api/data');
  return response.data;
};

function MyComponent() {
  const { data, isLoading } = useQuery(['data'], fetchData, {
    staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿç¼“å­˜
  });
  if (isLoading) return <div>loading...</div>;
  return <div>{data.name}</div>;
}
```

react queryä¼šè‡ªåŠ¨ç¼“å­˜è¯·æ±‚ï¼Œkeyæ˜¯query keyï¼Œé‡å¤è¯·æ±‚ç›´æ¥èµ°ç¼“å­˜ï¼Œè¿˜èƒ½è®¾ç½®staletimeã€cachetimeå•¥çš„ï¼Œçµæ´»å¾—ä¸€æ‰¹ã€‚swrä¹Ÿå·®ä¸å¤šï¼Œè¯­æ³•æ›´ç®€æ´ï¼Œé€‚åˆè½»é‡é¡¹ç›®ã€‚å¥½å¤„æ˜¯è¿™äº›åº“æŠŠç¼“å­˜é€»è¾‘æŠ½è±¡å¾—å¾ˆå¥½ï¼Œreactç»„ä»¶åªç®¡ç”¨ï¼Œåå¤„æ˜¯å¾—å­¦ä¸€ä¸‹apiï¼Œç¨å¾®æœ‰ç‚¹å­¦ä¹ æˆæœ¬ã€‚

### 4. ç»„ä»¶å±‚è‡ªå·±æï¼ˆä¸æ¨èï¼‰
ä½ ä¹Ÿå¯ä»¥åœ¨reactç»„ä»¶é‡Œç”¨usememoæˆ–è€…usestateè‡ªå·±å­˜è¯·æ±‚ç»“æœï¼Œæ¯”å¦‚ç”¨usememoç¼“å­˜fetchçš„ç»“æœã€‚ä½†è€å®è¯´ï¼Œè¿™æ‹›æˆ‘åŸºæœ¬ä¸ç”¨ã€‚ä¸ºå•¥ï¼Ÿå› ä¸ºç¼“å­˜é€»è¾‘æ•£è½åœ¨ç»„ä»¶é‡Œï¼Œå¤ªä¹±äº†ï¼Œå¤ç”¨æ€§å·®ã€‚è€Œä¸”ç»„ä»¶å¸è½½ï¼Œç¼“å­˜å°±æ²¡äº†ï¼Œè·¨ç»„ä»¶å…±äº«ä¹Ÿéº»çƒ¦ã€‚æˆ‘è¯•è¿‡ä¸€æ¬¡ï¼Œå†™äº†ä¸ªå¤æ‚è¡¨å•ï¼Œæ•°æ®ç¼“å­˜å…¨å¡åœ¨usememoé‡Œï¼Œç»“æœç»„ä»¶ä¸€å¤šï¼Œç»´æŠ¤èµ·æ¥è·Ÿå™©æ¢¦ä¼¼çš„ã€‚

### æˆ‘çš„ç»éªŒå’Œå»ºè®®
- å°é¡¹ç›®ï¼šç›´æ¥åœ¨axios/fetchå±‚æä¸ªç®€å•ç¼“å­˜ï¼Œå¤Ÿç”¨åˆè½»ä¾¿ã€‚
- ä¸­å¤§é¡¹ç›®ï¼šä¸Šreact queryæˆ–swrï¼Œä¸“ä¸šçš„äº‹äº¤ç»™ä¸“ä¸šå·¥å…·ï¼Œçœå¿ƒè¿˜é«˜æ•ˆã€‚
- å…¨å±€çŠ¶æ€å¤æ‚ï¼šç”¨çŠ¶æ€ç®¡ç†åº“ï¼Œç¼“å­˜é€»è¾‘è·ŸçŠ¶æ€é€»è¾‘ä¸€èµ·ç®¡ï¼Œé€‚åˆéœ€è¦è·¨ç»„ä»¶å…±äº«çš„åœºæ™¯ã€‚
- åˆ«åœ¨ç»„ä»¶å±‚ç¡¬æï¼šé™¤éæ˜¯è¶…çº§ä¸´æ—¶çš„hackï¼Œä¸ç„¶ç»´æŠ¤æˆæœ¬å¤ªé«˜ã€‚

è¿˜æœ‰ä¸ªå‘å¾—æé†’ä½ ï¼šç¼“å­˜æ—¶é—´å¾—è°ƒå¥½ï¼Œå¤ªé•¿ç”¨æˆ·å¯èƒ½çœ‹åˆ°æ—§æ•°æ®ï¼Œå¤ªçŸ­ç¼“å­˜æ²¡å•¥ç”¨ã€‚æˆ‘ä¹‹å‰è®¾äº†ä¸ª10åˆ†é’Ÿç¼“å­˜ï¼Œç»“æœç”¨æˆ·è€æŠ±æ€¨æ•°æ®ä¸æ›´æ–°ï¼Œåæ¥æ”¹æˆ2åˆ†é’Ÿ+æ‰‹åŠ¨å¤±æ•ˆï¼Œä½“éªŒå¥½å¤šäº†ã€‚

ä½ ç°åœ¨é¡¹ç›®é‡Œå’‹å¤„ç†è¯·æ±‚ç¼“å­˜çš„ï¼Ÿæ˜¯ç”¨å•¥åº“è¿˜æ˜¯è‡ªå·±æ‰‹å†™ï¼Ÿæœ‰å•¥å…·ä½“åœºæ™¯æƒ³ä¼˜åŒ–ä¸ï¼Ÿåˆ†äº«ä¸‹å‘—ï¼Œå’±ä»¬å¯ä»¥å†æŒ–æŒ–ç»†èŠ‚ï¼ğŸ˜

å˜¿ï¼æŠŠcontextå’Œusereducerç»“åˆæ¥ç®¡ç†ä»»åŠ¡çŠ¶æ€ï¼Œè¿™æ‹›å„¿å¾ˆç¡¬æ ¸ï¼Œé€‚åˆéœ€è¦å¤æ‚çŠ¶æ€é€»è¾‘çš„åœºæ™¯ï¼å°±åƒä½ æƒ³è®©ä»»åŠ¡ç®¡ç†æ›´æœ‰æ¡ç†ï¼ŒåŠ¨ä½œä¸€ç›®äº†ç„¶ï¼Œcontextç®¡å…¨å±€å…±äº«ï¼Œusereducerç®¡çŠ¶æ€æ›´æ–°é€»è¾‘ï¼Œç®€ç›´æ˜¯å¤©ä½œä¹‹åˆã€‚å’±ä»¬æ¥èŠèŠå’‹æï¼Œåƒå¹³æ—¶èŠæŠ€æœ¯é‚£æ ·ï¼Œæ¥åœ°æ°”åˆå¹²è´§æ»¡æ»¡ï¼Œé¡ºä¾¿åˆ†äº«ç‚¹æˆ‘è¸©è¿‡çš„å‘ã€‚

### ä¸ºä»€ä¹ˆç”¨context + usereducerï¼Ÿ
contextè´Ÿè´£æŠŠçŠ¶æ€å’Œæ“ä½œå¹¿æ’­ç»™æ‰€æœ‰ç»„ä»¶ï¼Œusereduceråˆ™æŠŠçŠ¶æ€æ›´æ–°é€»è¾‘é›†ä¸­èµ·æ¥ï¼Œåƒä¸ªâ€œçŠ¶æ€æœºå™¨â€ï¼Œæ¯”usestateæ›´é€‚åˆå¤æ‚çš„ä»»åŠ¡ç®¡ç†é€»è¾‘ã€‚æ¯”å¦‚ä»»åŠ¡appé‡Œï¼Œå¢åˆ æ”¹æŸ¥ã€è¿‡æ»¤ã€æ‰¹é‡æ“ä½œå•¥çš„ï¼Œusereducerèƒ½è®©ä»£ç æ›´æ¸…æ™°ï¼Œå¯ç»´æŠ¤æ€§ä¹Ÿå¼ºã€‚æˆ‘ä¹‹å‰å†™äº†ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œç”¨è¿™ç»„åˆï¼ŒçŠ¶æ€é€»è¾‘æ•´å¾—è·Ÿå†™æ•…äº‹ä¸€æ ·é¡ºç•…ã€‚

### å®ç°ï¼šç”¨context + usereducerç®¡ç†ä»»åŠ¡çŠ¶æ€
æˆ‘ä»¥ä¸€ä¸ªtodo appä¸ºä¾‹ï¼Œä»»åŠ¡çŠ¶æ€åŒ…æ‹¬ä»»åŠ¡åˆ—è¡¨ã€å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œç”¨contextå¹¿æ’­ï¼Œusereducerå¤„ç†é€»è¾‘ã€‚ä¸€æ­¥æ­¥æ¥ï¼Œä»£ç å°½é‡ç®€æ´ï¼Œè®²æ¸…æ¥šæ¯æ­¥ã€‚

#### 1. åˆ›å»ºreducerå’Œcontext
å…ˆå†™reducerï¼Œå®šä¹‰ä»»åŠ¡çŠ¶æ€çš„æ›´æ–°è§„åˆ™ã€‚å‡è®¾ä»»åŠ¡æœ‰idã€textã€completedå±æ€§ï¼Œæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€åˆ‡æ¢å®ŒæˆçŠ¶æ€ã€‚reduceré•¿è¿™æ ·ï¼š

```jsx
const initialState = {
  tasks: [
    { id: 1, text: 'å­¦context', completed: false },
    { id: 2, text: 'æå®šreducer', completed: true },
  ],
};

function taskReducer(state, action) {
  switch (action.type) {
    case 'ADD_TASK':
      return {
        ...state,
        tasks: [...state.tasks, { id: Date.now(), text: action.payload, completed: false }],
      };
    case 'DELETE_TASK':
      return {
        ...state,
        tasks: state.tasks.filter((task) => task.id !== action.payload),
      };
    case 'TOGGLE_TASK':
      return {
        ...state,
        tasks: state.tasks.map((task) =>
          task.id === action.payload ? { ...task, completed: !task.completed } : task
        ),
      };
    default:
      return state;
  }
}
```

reducerå°±æ˜¯ä¸ªçº¯å‡½æ•°ï¼Œæ¥æ”¶stateå’Œactionï¼Œåå‡ºæ–°çŠ¶æ€ã€‚action.typeå‘Šè¯‰å®ƒå¹²å•¥ï¼Œpayloadå¸¦å…·ä½“æ•°æ®ã€‚

ç„¶ååˆ›å»ºcontextå’Œproviderï¼Œç”¨usereducerç®¡ç†çŠ¶æ€ï¼š

```jsx
import { createContext, useContext, useReducer } from 'react';

const TaskContext = createContext();

function TaskProvider({ children }) {
  const [state, dispatch] = useReducer(taskReducer, initialState);

  return (
    <TaskContext.Provider value={{ state, dispatch }}>
      {children}
    </TaskContext.Provider>
  );
}
```

è¿™é‡ŒprovideræŠŠstateï¼ˆä»»åŠ¡åˆ—è¡¨ï¼‰å’Œdispatchï¼ˆè§¦å‘actionçš„å‡½æ•°ï¼‰ä¼ ç»™æ‰€æœ‰å­ç»„ä»¶ã€‚

#### 2. åœ¨appé‡ŒåŒ…è£¹provider
è·Ÿæ™®é€šcontextä¸€æ ·ï¼ŒæŠŠappåŒ…åœ¨provideré‡Œï¼Œç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½èƒ½è®¿é—®contextï¼š

```jsx
function App() {
  return (
    <TaskProvider>
      <TaskList />
      <AddTaskForm />
    </TaskProvider>
  );
}
```

#### 3. åœ¨ç»„ä»¶é‡Œç”¨contextå’Œdispatch
ç»„ä»¶é€šè¿‡usecontextæ‹¿åˆ°stateå’Œdispatchï¼Œç„¶åç”¨dispatchè§¦å‘actionã€‚æ¯”å¦‚ä»»åŠ¡åˆ—è¡¨å’Œæ·»åŠ ä»»åŠ¡è¡¨å•ï¼š

```jsx
// ä»»åŠ¡åˆ—è¡¨ç»„ä»¶
function TaskList() {
  const { state, dispatch } = useContext(TaskContext);

  return (
    <ul>
      {state.tasks.map((task) => (
        <li key={task.id}>
          <span
            style={{ textDecoration: task.completed ? 'line-through' : 'none' }}
            onClick={() => dispatch({ type: 'TOGGLE_TASK', payload: task.id })}
          >
            {task.text}
          </span>
          <button onClick={() => dispatch({ type: 'DELETE_TASK', payload: task.id })}>
            åˆ é™¤
          </button>
        </li>
      ))}
    </ul>
  );
}

// æ·»åŠ ä»»åŠ¡è¡¨å•
function AddTaskForm() {
  const [input, setInput] = useState('');
  const { dispatch } = useContext(TaskContext);

  const handleSubmit = (e) => {
    e.preventDefault();
    if (input.trim()) {
      dispatch({ type: 'ADD_TASK', payload: input });
      setInput('');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        value={input}
        onChange={(e) => setInput(e.target.value)}
        placeholder="è¾“å…¥æ–°ä»»åŠ¡"
      />
      <button type="submit">æ·»åŠ </button>
    </form>
  );
}
```

ç»„ä»¶é‡Œç›´æ¥dispatch actionï¼Œæ¯”å¦‚{ type: 'ADD_TASK', payload: 'æ–°ä»»åŠ¡' }ï¼Œreduceræ”¶åˆ°åæ›´æ–°çŠ¶æ€ï¼Œç»„ä»¶è‡ªåŠ¨é‡æ¸²æŸ“ï¼Œç®€å•ç²—æš´ã€‚

### ä¼˜åŒ–ï¼šé¿å…æ€§èƒ½é—®é¢˜
context + usereducerä¹Ÿæœ‰å‘ï¼Œå°¤å…¶contextä¼šè®©ç”¨å®ƒçš„ç»„ä»¶å…¨é‡æ¸²æŸ“ã€‚æˆ‘ä¹‹å‰å†™äº†ä¸ªä»»åŠ¡çœ‹æ¿ï¼Œä»»åŠ¡ä¸€å¤šï¼Œç‚¹ä¸€ä¸‹å…¨åˆ·ï¼Œå¡å¾—è¦å‘½ã€‚å’‹ä¼˜åŒ–ï¼Ÿå¯ä»¥ç»“åˆusememoå’Œusecontextçš„ç»†ç²’åº¦æ‹†åˆ†ï¼š

#### 1. ç”¨usememoç¨³å®šcontext value
providerçš„valueå¯¹è±¡æ¯æ¬¡æ¸²æŸ“éƒ½å¯èƒ½æ˜¯æ–°å¯¹è±¡ï¼Œè§¦å‘ä¸å¿…è¦æ¸²æŸ“ã€‚ç”¨usememoåŒ…ä¸€ä¸‹ï¼š

```jsx
function TaskProvider({ children }) {
  const [state, dispatch] = useReducer(taskReducer, initialState);

  const value = useMemo(() => ({ state, dispatch }), [state]);

  return <TaskContext.Provider value={value}>{children}</TaskContext.Provider>;
}
```

#### 2. æ‹†åˆ†context
å¦‚æœä¸åŒç»„ä»¶åªå…³å¿ƒstateçš„æŸéƒ¨åˆ†ï¼Œå¯ä»¥ç”¨å¤šä¸ªcontextåˆ†å¼€ç®¡ç†ã€‚æ¯”å¦‚ä»»åŠ¡åˆ—è¡¨å’Œç»Ÿè®¡æ•°æ®åˆ†å¼€ï¼š

```jsx
const TasksContext = createContext();
const StatsContext = createContext();

function TaskProvider({ children }) {
  const [state, dispatch] = useReducer(taskReducer, initialState);

  const stats = useMemo(() => ({
    total: state.tasks.length,
    completed: state.tasks.filter((t) => t.completed).length,
  }), [state.tasks]);

  return (
    <TasksContext.Provider value={{ tasks: state.tasks, dispatch }}>
      <StatsContext.Provider value={stats}>
        {children}
      </StatsContext.Provider>
    </TasksContext.Provider>
  );
}
```

ç„¶åç»„ä»¶é‡Œåˆ†åˆ«ç”¨ï¼š

```jsx
function TaskList() {
  const { tasks, dispatch } = useContext(TasksContext);
  // ...
}

function TaskStats() {
  const { total, completed } = useContext(StatsContext);
  return <div>å…± {total} æ¡ï¼Œå®Œæˆ {completed} æ¡</div>;
}
```

è¿™æ ·taskstatsåªåœ¨statså˜æ—¶é‡æ¸²æŸ“ï¼Œæ•ˆç‡é«˜ä¸å°‘ã€‚

### æ‰©å±•ï¼šåŠ ç‚¹å¤æ‚é€»è¾‘
å¦‚æœä»»åŠ¡çŠ¶æ€éœ€è¦è·Ÿåç«¯åŒæ­¥ï¼Œæˆ–è€…åŠ è¿‡æ»¤ã€æ‰¹é‡æ“ä½œï¼Œå¯ä»¥åœ¨reduceré‡Œæ‰©å±•ã€‚æ¯”å¦‚æˆ‘ä¹‹å‰æäº†ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œreduceré‡ŒåŠ äº†å¼‚æ­¥é€»è¾‘ï¼š

```jsx
function taskReducer(state, action) {
  switch (action.type) {
    case 'FETCH_TASKS_SUCCESS':
      return { ...state, tasks: action.payload, isLoading: false };
    case 'FETCH_TASKS_START':
      return { ...state, isLoading: true };
    case 'TOGGLE_ALL':
      return {
        ...state,
        tasks: state.tasks.map((task) => ({ ...task, completed: action.payload })),
      };
    // å…¶ä»–case...
    default:
      return state;
  }
}
```

ç„¶åç”¨useeffectè§¦å‘å¼‚æ­¥actionï¼š

```jsx
function TaskLoader() {
  const { dispatch } = useContext(TaskContext);

  useEffect(() => {
    async function fetchTasks() {
      dispatch({ type: 'FETCH_TASKS_START' });
      const response = await api.get('/tasks');
      dispatch({ type: 'FETCH_TASKS_SUCCESS', payload: response.data });
    }
    fetchTasks();
  }, [dispatch]);

  return null;
}
```

### æˆ‘çš„ç»éªŒå’Œè¸©è¿‡çš„å‘
1. **reduceré€»è¾‘åˆ«å¤ªå¤æ‚**ï¼šæˆ‘æœ‰æ¬¡æŠŠæ‰€æœ‰é€»è¾‘éƒ½å¡reduceré‡Œï¼ŒåŒ…æ‹¬å¤æ‚çš„è¿‡æ»¤å’Œæ’åºï¼Œç»“æœreduceré•¿å¾—è·Ÿå°è¯´ä¼¼çš„ï¼Œè°ƒè¯•èµ·æ¥æƒ³å“­ã€‚å»ºè®®å¤æ‚è®¡ç®—æ”¾usememoï¼Œreduceråªç®¡æ ¸å¿ƒçŠ¶æ€æ›´æ–°ã€‚
2. **actionå‘½åè¦æ¸…æ™°**ï¼štypeå†™æ¨¡ç³Šäº†ï¼Œæ¯”å¦‚'TOGGLE'ï¼Œåæ¥åŠ åŠŸèƒ½åˆ†ä¸æ¸…æ˜¯toggleå•¥ï¼Œæ”¹æˆ'TOGGLE_TASK'ã€'TOGGLE_ALL'çœä¸å°‘å¿ƒã€‚
3. **å¼‚æ­¥å¤„ç†éº»çƒ¦**ï¼šusereduceræœ¬èº«ä¸é€‚åˆå¼‚æ­¥ï¼Œå»ºè®®ç”¨thunkä¸­é—´ä»¶ï¼ˆåƒredux-thunkï¼‰æˆ–è€…ç›´æ¥ä¸Šreact queryå¤„ç†å¼‚æ­¥è¯·æ±‚ã€‚æˆ‘ä¹‹å‰çº¯reducerç¡¬å†™å¼‚æ­¥ï¼Œä»£ç ä¹±å¾—åƒæ‚è´§é“ºã€‚
4. **contextèŒƒå›´æ§åˆ¶å¥½**ï¼šåˆ«æŠŠæ‰€æœ‰ç»„ä»¶éƒ½åŒ…åœ¨provideré‡Œï¼ŒåªåŒ…éœ€è¦ä»»åŠ¡çŠ¶æ€çš„éƒ¨åˆ†ï¼Œä¸ç„¶æ— å…³ç»„ä»¶ä¹Ÿå¯èƒ½é‡æ¸²æŸ“ã€‚

### ä½ å’‹æƒ³çš„ï¼Ÿ
ä½ ç°åœ¨å’‹ç”¨contextå’Œusereducerçš„ï¼Ÿä»»åŠ¡çŠ¶æ€å¤æ‚ä¸ï¼Ÿæ¯”å¦‚æœ‰æ²¡æ‰¹é‡æ“ä½œã€è¿‡æ»¤ã€åç«¯åŒæ­¥å•¥çš„ï¼Ÿåˆ†äº«ä¸‹å‘—ï¼Œæˆ‘å¯ä»¥å¸®ä½ çœ‹çœ‹å’‹ä¼˜åŒ–ã€‚é¡ºä¾¿é—®ä¸€å¥ï¼Œä½ é¡¹ç›®é‡Œä»»åŠ¡çŠ¶æ€æ›´æ–°é¢‘ç¹ä¸ï¼Ÿæœ‰æ²¡é‡åˆ°å•¥å¡é¡¿é—®é¢˜ï¼ŸğŸ˜
