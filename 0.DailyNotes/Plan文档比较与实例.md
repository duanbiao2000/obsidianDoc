
### 文档比较

为了清晰地展示它们的区别，我将用一个表格来比较这四种文档的核心焦点、范围、使用时机和“重量级”。

| 特性 | RFC / 设计文档 (Design Doc) | ADR / 架构决策记录 | 技术设计方案 (Technical Spec) | 部署计划 / 运维手册 (Runbook) |
| :--- | :--- | :--- | :--- | :--- |
| **核心焦点** | **为什么**要做 & **做什么** (战略与方向) | **为什么**这样选 (决策的理由) | **如何**去做 (具体的实现细节) | **如何**上线 & **如何**应对失败 (操作步骤) |
| **范围** | 跨团队、跨系统的大型变更 | 单一、重要的架构决策点 | 单个功能模块或服务 | 一次具体的上线发布过程 |
| **使用时机** | 项目启动或重大重构的**最早期** | 做出关键技术选型**之后** | 功能开发**之前** | 系统部署**之前** |
| **“重量级”** | **最重**。需要广泛评审，凝聚共识。 | **最轻**。通常是一个简短的Markdown文件。 | **中等**。团队内部评审，细节详尽。 | **重**。细节必须精确，不容出错。 |
| **解决的问题** | “我们走的方向对吗？” | “我们未来不会忘记当初为何这么选。” | “我们清楚要写的每一行代码的意图吗？” | “我们能安全、可控地发布并快速处理故障吗？” |

---

### 文档实例

为了让例子更连贯，我们假设正在为一个项目管理工具（类似Jira或Trello）开发一个全新的“实时协作”功能。

#### 1. RFC / 设计文档 (Design Doc) 实例

**标题：RFC: 为 ProjectHub 引入实时协作编辑引擎**

- **1. 摘要 (Abstract)**
  - 本文档提议为 ProjectHub 设计并实现一个全新的实时协作引擎，允许用户像在 Google Docs 中一样，同时编辑任务描述、评论和看板。这将显著提升团队协作效率，是我们下一季度的核心战略目标。

- **2. 背景与动机 (Background and Motivation)**
  - 当前，当两个用户同时编辑一个任务时，后保存的用户会覆盖前者的修改，导致数据丢失和用户挫败感。竞品 A 和 B 均已支持实时协作。

- **3. 目标 (Goals)**
  - 支持多人同时编辑任务详情。
  - 编辑延迟低于 200ms。
  - 系统可水平扩展以支持 10,000 个并发连接。

- **4. 方案设计 (Technical Proposal)**
  - **方案A (推荐): 自研 WebSocket + OT 算法服务**
    - 我们将构建一个独立的 WebSocket 微服务，负责处理客户端连接和消息广播。后端采用 Operational Transformation (OT) 算法来解决编辑冲突。
    - *优点*: 完全可控，性能最优。
    - *缺点*: 研发周期长，技术复杂度高。
  - **方案B: 采用第三方服务 (如 LiveBlocks)**
    - 集成 LiveBlocks SDK，将协作逻辑外包。
    - *优点*: 实现速度快。
    - *缺点*: 依赖外部服务，长期成本高，定制性差。

- **5. 风险与开放问题 (Risks and Open Questions)**
  - 方案A的 OT 算法实现难度大，是否存在更简单的 CRDT 算法可以替代？
  - 该变更将对现有的“任务服务”和“通知服务”产生影响，需要相关团队介入评审。

#### 2. ADR / 架构决策记录 实例

**标题：ADR-005: 选用 WebSocket 替代 Long-Polling 作为实时通信协议**

- **状态**: 已接受
- **日期**: 2025-12-04
- **背景 (Context)**
  - 在设计“实时协作引擎”(见RFC-012)时，我们需要选择一种客户端与服务器间的双向通信技术。
- **决策 (Decision)**
  - 我们决定采用 WebSocket 作为标准的实时通信协议。
- **理由 (Rationale)**
  - **性能**: WebSocket 提供全双工通信，相比 Long-Polling，延迟更低，开销更小。
  - **可扩展性**: 更容易在服务端管理大量持久连接。
  - **行业标准**: 它是现代实时应用的事实标准，社区支持成熟。
  - 我们评估了 Long-Polling，虽然实现简单，但在大规模并发下对服务器压力巨大，无法满足我们的性能目标。
- **后果 (Consequences)**
  - 我们的基础设施需要支持 WebSocket 协议，Nginx 等网关需要进行相应配置。
  - 客户端代码需要处理 WebSocket 的连接生命周期（连接、断开、重连）。

#### 3. 技术设计方案 (Technical Spec) 实例

**标题：技术方案: 任务详情页的实时评论功能**

- **1. 概述**
  - 本方案描述“实时协作”功能中的“实时评论”模块的具体实现。当用户在一个任务下发表评论时，所有正在查看该任务的用户将无需刷新页面，实时看到新评论。

- **2. API 接口设计**
  - **WebSocket 消息格式**
    - 客户端加入房间: `{ "action": "join_task", "task_id": "TASK-123" }`
    - 服务端广播新评论: `{ "event": "new_comment", "data": { "comment_id": "CMT-456", "author": "Alice", "content": "这个设计很棒！" } }`
  - **REST API (用于持久化)**
    - `POST /api/v1/tasks/{task_id}/comments`
    - Body: `{ "content": "这个设计很棒！" }`

- **3. 数据模型**
  - `comments` 表无需修改。

- **4. 前端实现逻辑**
  - 进入任务页面时，初始化 WebSocket 连接并发送 `join_task` 消息。
  - 监听 `new_comment` 事件，收到后将新评论动态插入到评论列表的底部。
  - 用户提交评论时，同时调用 REST API 并通过 WebSocket 发送消息。

- **5. 后端实现逻辑**
  - WebSocket 服务维护一个 `task_id -> [client_connections]` 的映射。
  - 收到 `POST` 请求保存评论到数据库后，从数据库获取完整的评论信息，并通过 WebSocket 广播给该 `task_id` 房间内的所有客户端。

#### 4. 部署计划 (Deployment Plan) / 运维手册 (Runbook) 实例

**标题：部署计划: 实时协作服务 v1.0 上线**

- **发布窗口**: 2026-01-15 02:00 - 03:00 AM (UTC)
- **负责人**: Ops: Bob, Dev: Carol

- **前置检查 (Pre-flight Checks)**
  - [ ] 确认数据库迁移脚本已在预生产环境测试通过。
  - [ ] 确认新的 WebSocket 服务的 K8s 配置已准备就緒。
  - [ ] 确认监控仪表盘（并发连接数、消息延迟）已创建。

- **部署步骤 (Deployment Steps)**
  1.  **02:00**: 启用系统维护模式。
  2.  **02:05**: 备份 `tasks` 和 `comments` 数据库。
  3.  **02:15**: 执行数据库迁移脚本 `V3.2.1__add_collab_features.sql`。
  4.  **02:30**: 部署新的 `collab-service-v1.0`。
  5.  **02:45**: 部署主应用 `main-app-v5.8`。
  6.  **02:50**: 禁用系统维护模式。

- **验证步骤 (Verification)**
  - [ ] Ops 团队确认 `collab-service` Pod 正常运行。
  - [ ] Dev 团队使用测试账号，验证实时评论功能是否正常。
  - [ ] 监控团队观察仪表盘，确认并发连接数指标正常，无异常错误日志。

- **回滚计划 (Rollback Plan)**
  - **触发条件**: 验证步骤失败，或上线后5分钟内出现大量5xx错误。
  - **回滚步骤**:
    1.  立即启用维护模式。
    2.  将主应用回滚至 `main-app-v5.7`。
    3.  将 `collab-service` 缩容至0。
    4.  执行数据库回滚脚本。
    5.  禁用维护模式。
    6.  立即通知所有相关方，宣布发布失败。