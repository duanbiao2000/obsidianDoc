# Bç«™æ¨èç³»ç»Ÿ 3å¤©æ·±åº¦çªç ´æ–¹æ¡ˆ

## ç›®æ ‡ï¼šè®¾è®¡å®Œæ•´çš„æ¨èç³»ç»Ÿæ¶æ„ + å·¥ç¨‹çº§ç®—æ³•å®ç°

---

# ğŸ“‹ 3å¤©æ€»ä½“è§„åˆ’

|å¤©æ•°|æ—¶é—´|é‡ç‚¹|è¾“å‡º|
|---|---|---|---|
|**ç¬¬1å¤©**|8h|æ¨èç³»ç»ŸåŸºç¡€ + éœ€æ±‚åˆ†æ|ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ + æ•°æ®æ¨¡å‹|
|**ç¬¬2å¤©**|8h|æ¨èç®—æ³•å®ç° + ç¦»çº¿è®¡ç®—|å¯è¿è¡Œçš„ç®—æ³• Demo|
|**ç¬¬3å¤©**|8h|ç³»ç»Ÿæ¶æ„ + å®æ—¶æœåŠ¡ + é¢è¯•å‡†å¤‡|å®Œæ•´æ¶æ„è®¾è®¡ + ç­”é¢˜æ¨¡æ¿|

---

# ğŸŒ… ç¬¬1å¤©ï¼šæ¨èç³»ç»ŸåŸºç¡€ä¸éœ€æ±‚åˆ†æï¼ˆ8å°æ—¶ï¼‰

## æ—¶é—´åˆ†é…

- é˜¶æ®µ 1aï¼šæ¨èç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µï¼ˆ1.5hï¼‰
- é˜¶æ®µ 1bï¼šBç«™æ¨èçš„ä¸šåŠ¡éœ€æ±‚ï¼ˆ1.5hï¼‰
- é˜¶æ®µ 1cï¼šç³»ç»Ÿè®¾è®¡ä¸å®¹é‡è¯„ä¼°ï¼ˆ2hï¼‰
- é˜¶æ®µ 1dï¼šæ•°æ®æ¨¡å‹ä¸å­˜å‚¨ï¼ˆ2hï¼‰
- é˜¶æ®µ 1eï¼šå¼€å‘ç¯å¢ƒæ­å»ºï¼ˆ1hï¼‰

---

## é˜¶æ®µ 1aï¼šæ¨èç³»ç»Ÿæ ¸å¿ƒæ¦‚å¿µï¼ˆ1.5å°æ—¶ï¼‰

### æ¨èç³»ç»Ÿçš„æœ¬è´¨

```
æ¨èç³»ç»Ÿ = åŒ¹é…é—®é¢˜

é—®é¢˜é™ˆè¿°ï¼š
  ç»™å®šï¼šç”¨æˆ· Uï¼Œè§†é¢‘åº“å­˜ Vï¼ˆç™¾ä¸‡çº§ï¼‰
  æ‰¾åˆ°ï¼šTop K è§†é¢‘ï¼ˆK=30ï¼‰ï¼Œæœ€ç¬¦åˆç”¨æˆ·åå¥½çš„
  
æŒ‘æˆ˜ï¼š
  1. å¬å›å›°éš¾ï¼šä» 100 ä¸‡è§†é¢‘æ‰¾å‡ºæœ€ç›¸å…³çš„ 1000 ä¸ª
  2. æ’åºå›°éš¾ï¼šä» 1000 ä¸ªæ’å‡ºæœ€æœ‰å¸å¼•åŠ›çš„ 30 ä¸ª
  3. å®æ—¶å›°éš¾ï¼šç§’çº§å“åº”ï¼Œ10000 QPS
  4. å†·å¯åŠ¨å›°éš¾ï¼šæ–°ç”¨æˆ·æ²¡æœ‰å†å²è¡Œä¸ºæ•°æ®
```

### æ¨èç³»ç»Ÿçš„ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ç”¨æˆ·è¯·æ±‚ï¼ˆç§’çº§ï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   æ’åºå±‚(Rank)   â”‚  â† ä¸ªæ€§åŒ–æ’åºï¼ˆ200-500msï¼‰
        â”‚ DNN æ¨¡å‹é¢„æµ‹CTR  â”‚    æ¨¡å‹è°ƒç”¨ï¼Œè€ƒè™‘ä¸Šä¸‹æ–‡
        â”‚ è€ƒè™‘ç”¨æˆ·ç‰¹å¾     â”‚    è¾“å‡ºæ’åºåˆ†æ•°
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å¬å›å±‚(Recall)    â”‚  â† ç²—æ’å¬å›ï¼ˆ50-100msï¼‰
        â”‚ ååŒè¿‡æ»¤/å†…å®¹å¬å›  â”‚    å¿«é€Ÿæ‰¾å‡ºå€™é€‰é›†
        â”‚ ä» 100wâ†’1000     â”‚    ä½¿ç”¨ç´¢å¼•åŠ é€Ÿ
        â”‚ (å¤šè·¯å¬å›èåˆ)    â”‚    
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   ç¦»çº¿è®¡ç®—å±‚(Offline)          â”‚
        â”‚ Spark/Flink è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦    â”‚  â† å°æ—¶çº§åˆ«
        â”‚ ç‰¹å¾å¤„ç†ä¸æ¨¡å‹è®­ç»ƒ             â”‚    åå° Job
        â”‚ ç»“æœå­˜å‚¨åˆ° Redis/ES           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æ¦‚å¿µé€Ÿè§£

#### **1. å¬å› vs æ’åº**

|ç»´åº¦|å¬å›(Recall)|æ’åº(Rank)|
|---|---|---|
|**ç›®æ ‡**|å¿«é€Ÿç­›å‡ºå€™é€‰|ç²¾å‡†æ’åº|
|**æ—¶é—´**|50-100ms|200-500ms|
|**è®¡ç®—é‡**|ä½ï¼ˆç´¢å¼•æŸ¥è¯¢ï¼‰|é«˜ï¼ˆæ¨¡å‹æ¨ç†ï¼‰|
|**å‡†ç¡®ç‡**|ç²—ç³™ï¼ˆå¯ç”¨å³å¯ï¼‰|ç²¾å‡†ï¼ˆæ ¸å¿ƒæŒ‡æ ‡ï¼‰|
|**ä½•æ—¶æ›´æ–°**|ç¦»çº¿å°æ—¶çº§|å®æ—¶å¯ç”¨|
|**ä¾‹å­**|ååŒè¿‡æ»¤ 1000 æ¡|DNN é¢„æµ‹è¿™ 1000 æ¡çš„ CTR|

**ç›´è§‚ç†è§£**ï¼š

- å¬å› = æµ·é€‰ï¼šä» 100 ä¸‡äººä¸­å¿«é€Ÿæ‰¾å‡º 1000 ä¸ªå¯èƒ½çš„å€™é€‰
- æ’åº = ç²¾é€‰ï¼šä» 1000 äººä¸­ç²¾å¿ƒæ’å‡ºæœ€ä½³çš„ 30 äºº

#### **2. ååŒè¿‡æ»¤(Collaborative Filtering)**

```
æ ¸å¿ƒæ€æƒ³ï¼š
  å¦‚æœç”¨æˆ· A å’Œç”¨æˆ· B å–œæ¬¢ç›¸åŒçš„è§†é¢‘ï¼Œ
  é‚£ä¹ˆ A å–œæ¬¢çš„å…¶ä»–è§†é¢‘ï¼ŒB å¾ˆå¯èƒ½ä¹Ÿä¼šå–œæ¬¢

æ•°å­¦æ¨¡å‹ï¼ˆUser-Based CFï¼‰ï¼š
  sim(A, B) = å…±åŒå–œæ¬¢çš„è§†é¢‘æ•° / ç”¨æˆ·Açš„å–œæ¬¢è§†é¢‘æ•°
  
  æ¨èåˆ†æ•° = Î£(sim(A, B) Ã— B å¯¹è§†é¢‘ v çš„è¯„åˆ†)

é—®é¢˜ï¼š
  - ç”¨æˆ·æ•°é‡å¤§æ—¶ï¼Œè®¡ç®—å¤æ‚åº¦é«˜ O(nÂ²)
  - å†·å¯åŠ¨ï¼šæ–°ç”¨æˆ·æ²¡æœ‰è¯„åˆ†è®°å½•
  
æ”¹è¿›ï¼šItem-Based CF
  - è®¡ç®—è§†é¢‘ç›¸ä¼¼åº¦ï¼ˆè€Œéç”¨æˆ·ç›¸ä¼¼åº¦ï¼‰
  - å¯¹äºç”¨æˆ· Aï¼Œæ‰¾ä»–çœ‹è¿‡çš„è§†é¢‘çš„ç›¸ä¼¼è§†é¢‘
  - æ¨èç»™ A ä»–æ²¡çœ‹è¿‡çš„
```

#### **3. CTR é¢„ä¼°(Click-Through Rate)**

```
é—®é¢˜ï¼šç»™å®šè§†é¢‘ï¼Œç”¨æˆ·ç‚¹å‡»çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Ÿ

P(click|user, video, context)

ä½¿ç”¨æœºå™¨å­¦ä¹ æ¨¡å‹ï¼š
  è¾“å…¥ç‰¹å¾ï¼š
    - ç”¨æˆ·ç‰¹å¾ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€è¿‡å¾€å…´è¶£ï¼‰
    - è§†é¢‘ç‰¹å¾ï¼ˆåˆ†ç±»ã€çƒ­åº¦ã€æ—¶é•¿ï¼‰
    - ä¸Šä¸‹æ–‡ç‰¹å¾ï¼ˆæ—¶é—´ã€è®¾å¤‡ã€ä½ç½®ï¼‰
  
  è¾“å‡ºï¼š0-1 ä¹‹é—´çš„ç‚¹å‡»æ¦‚ç‡

æ¨¡å‹é€‰æ‹©ï¼š
  ç®€å•ç‰ˆï¼šé€»è¾‘å›å½’ LRï¼ˆå¿«é€Ÿï¼Œå¯è§£é‡Šï¼‰
  ä¸­ç­‰ç‰ˆï¼šDNNï¼ˆå‰é¢è®²ï¼‰
  å¤æ‚ç‰ˆï¼šæ·±åº¦å­¦ä¹ ï¼ˆä½†å·¥ç¨‹å¤æ‚ï¼‰
  
  æ¨èï¼šä¸­ç­‰ç‰ˆ DNNï¼ˆå¹³è¡¡æ€§èƒ½ä¸å‡†ç¡®ç‡ï¼‰
```

### YAGNI åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨

```
ä¸éœ€è¦å­¦ï¼š
âŒ çŸ©é˜µåˆ†è§£çš„æ•°å­¦æ¨å¯¼ï¼ˆå¥‡å¼‚å€¼åˆ†è§£ã€ç‰¹å¾å€¼ï¼‰
âŒ æ·±åº¦å­¦ä¹ æ¡†æ¶è¯¦è§£ï¼ˆTensorFlow/PyTorch ç»†èŠ‚ï¼‰
âŒ å·¥ä¸šçº§ç‰¹å¾å·¥ç¨‹çš„æ‰€æœ‰æŠ€å·§
âŒ å®Œæ•´çš„æ¨èç³»ç»Ÿå·¥ç¨‹ï¼ˆå¤ªå¤æ‚äº†ï¼‰

åªéœ€è¦å­¦ï¼š
âœ… ä¸‰å±‚æ¶æ„æ€ä¹ˆå·¥ä½œçš„
âœ… ååŒè¿‡æ»¤çš„ç›´è§‚åŸç†
âœ… æ€ä¹ˆç”¨ DNN åš CTR é¢„ä¼°
âœ… æ€ä¹ˆé›†æˆè¿™äº›æ¨¡å—æˆä¸€ä¸ªç³»ç»Ÿ
âœ… æ€§èƒ½ç“¶é¢ˆå’Œä¼˜åŒ–æ–¹å‘
```

---

## é˜¶æ®µ 1bï¼šBç«™æ¨èçš„ä¸šåŠ¡éœ€æ±‚ï¼ˆ1.5å°æ—¶ï¼‰

### Bç«™æ¨èçš„ç‹¬ç‰¹ç‰¹ç‚¹

Bç«™å’Œå…¶ä»–å¹³å°ï¼ˆYouTubeã€Netflixï¼‰çš„åŒºåˆ«ï¼š

```
YouTubeï¼š
  - ç”¨æˆ·ç‚¹å‡»ï¼ˆWatchï¼‰å³äº¤äº’
  - å¹¿å‘Šå¯¼å‘ï¼Œæœ€å¤§åŒ–æ’­æ”¾æ—¶é•¿
  - æ¯ä¸ªç”¨æˆ·çœ‹çš„è§†é¢‘æ•° > 100

Bç«™ï¼š
  - ç”¨æˆ·äº’åŠ¨ä¸°å¯Œï¼ˆç‚¹å‡»ã€å®Œæ’­ã€ç‚¹èµã€è¯„è®ºã€æ”¶è—ï¼‰
  - å†…å®¹å¯¼å‘ï¼Œéœ€è¦ä¿æŠ¤å°ä¼—å†…å®¹
  - ç”¨æˆ·çœ‹çš„è§†é¢‘æ•° < 30ï¼ˆä½†ç²˜æ€§é«˜ï¼‰
  
Netflixï¼š
  - å†…å®¹åº“å°ï¼ˆå‡ åƒéƒ¨ç”µå½±ï¼‰
  - ç”¨æˆ·åå¤çœ‹åŒä¸€éƒ¨ï¼ˆæ²¡æœ‰å†·å¯åŠ¨ï¼‰
  - å¼ºè°ƒ"çœ‹å®Œæ•´éƒ¨"

Bç«™æ¨èçš„å…³é”®ï¼š
1. å¤šç»´åº¦äº¤äº’ä¿¡å·ï¼ˆä¸ä»…æ˜¯ç‚¹å‡»ï¼‰
2. å†·å¯åŠ¨ï¼ˆæ¯å¤©æ–°ä¸Šä¼  10 ä¸‡+ è§†é¢‘ï¼‰
3. ç¤¾åŒºç”Ÿæ€ï¼ˆç‚¹èµã€è¯„è®ºã€æ”¶è—çš„ä»·å€¼ï¼‰
```

### Bç«™é¦–é¡µæ¨èçš„éœ€æ±‚

```
ç”¨æˆ·åœºæ™¯ï¼š
  ç”¨æˆ·æ‰“å¼€ B ç«™ï¼Œçœ‹åˆ°é¦–é¡µæ¨è
  æœŸæœ›ï¼š30 æ¡è§†é¢‘ï¼ŒåŒ…å«ï¼š
    - é«˜ç›¸å…³æ€§è§†é¢‘ï¼ˆä»–å¯èƒ½æ„Ÿå…´è¶£ï¼‰
    - å¤šæ ·åŒ–è§†é¢‘ï¼ˆä¸åŒåˆ†ç±»ã€åˆ›ä½œè€…ï¼‰
    - çƒ­ç‚¹è§†é¢‘ï¼ˆæ—¶æ•ˆæ€§ï¼‰
    - æ–°è§†é¢‘ï¼ˆå‘ç°æ–°ä½œå“ï¼‰

ç³»ç»Ÿè¦æ±‚ï¼š
  ååé‡ï¼š100 ä¸‡æ—¥æ´» â†’ å³°å€¼ 10000 QPS
  å»¶è¿Ÿï¼šP99 < 500ms
  å¯ç”¨æ€§ï¼š99.9%
  å‡†ç¡®ç‡ï¼šCTR é¢„ä¼°è¯¯å·® < 5%
  å¤šæ ·æ€§ï¼šæ¨èè§†é¢‘æ¥è‡ª > 10 ä¸ªåˆ†ç±»
```

### å…³é”®ä¸šåŠ¡æŒ‡æ ‡

```
ç¦»çº¿æŒ‡æ ‡ï¼ˆA/B æµ‹è¯•ç”¨ï¼‰ï¼š
  1. CTRï¼ˆç‚¹å‡»ç‡ï¼‰
     = ç‚¹å‡»æ¨èè§†é¢‘çš„ç”¨æˆ·æ•° / çœ‹åˆ°æ¨èçš„ç”¨æˆ·æ•°
     = è¡¡é‡ç›¸å…³æ€§çš„ç›´æ¥æŒ‡æ ‡
     ç›®æ ‡ï¼šæå‡ 2-5%
  
  2. å®Œæ’­ç‡ï¼ˆCompletion Rateï¼‰
     = å®Œæ•´çœ‹å®Œè§†é¢‘çš„ç”¨æˆ·æ•° / ç‚¹å‡»çš„ç”¨æˆ·æ•°
     = è¡¡é‡å†…å®¹è´¨é‡çš„æŒ‡æ ‡
     ç›®æ ‡ï¼šä¿æŒä¸ä¸‹é™
  
  3. ç‚¹èµç‡ï¼ˆLike Rateï¼‰
     = ç‚¹èµç”¨æˆ·æ•° / ç‚¹å‡»ç”¨æˆ·æ•°
     = è¡¡é‡ç”¨æˆ·æ»¡æ„åº¦
     ç›®æ ‡ï¼šé€å‘¨å¢é•¿ 1%
  
  4. æ¨èå¤šæ ·æ€§ï¼ˆDiversityï¼‰
     = æ¨èè§†é¢‘çš„åˆ†ç±»æ•°é‡ / æ€»åˆ†ç±»æ•°
     = é¿å…æ¨èé‡å¤åˆ†ç±»
     ç›®æ ‡ï¼š> 0.8ï¼ˆ80% çš„åˆ†ç±»éƒ½æœ‰è¦†ç›–ï¼‰
  
  5. æ–°å†…å®¹åˆ†å‘ç‡ï¼ˆNew Content Rateï¼‰
     = ä¸Šçº¿ 24 å°æ—¶å†…æ¨èçš„è§†é¢‘æ•° / æ€»æ¨èæ•°
     = è¡¡é‡æ–°è§†é¢‘å‘ç°èƒ½åŠ›
     ç›®æ ‡ï¼š> 10%

åœ¨çº¿å®æ—¶æŒ‡æ ‡ï¼š
  - è¯·æ±‚å»¶è¿Ÿï¼ˆP50ã€P99ã€P999ï¼‰
  - æ¨èè¦†ç›–ç‡ï¼ˆå¤šå°‘ç”¨æˆ·æœ‰æ¨èç»“æœï¼‰
  - ç³»ç»Ÿå¯ç”¨æ€§ï¼ˆæˆåŠŸç‡ï¼‰
```

### ç³»ç»Ÿçº¦æŸæ¡ä»¶

```
ä¸šåŠ¡çº¦æŸï¼š
  - ä¸èƒ½æ¨èå·²çœ‹è¿‡çš„è§†é¢‘
  - ä¸èƒ½æ¨èç”¨æˆ·å±è”½çš„åˆ›ä½œè€…è§†é¢‘
  - æ•æ„Ÿå†…å®¹ï¼ˆè‰²æƒ…ã€æš´åŠ›ï¼‰è¦è¿‡æ»¤
  - ä¸èƒ½è¿‡åº¦ä¸ªæ€§åŒ–ï¼ˆæ–°ç”¨æˆ·éœ€è¦æ³›åŒ–æ¨èï¼‰

æŠ€æœ¯çº¦æŸï¼š
  - Python + Flask ä¸»æ¡†æ¶
  - ç¦»çº¿è®¡ç®—ï¼šSpark/Pandas
  - å®æ—¶å­˜å‚¨ï¼šRedis
  - æ¨¡å‹æœåŠ¡ï¼šTensorFlow/ONNX
  - æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafka/RabbitMQ
  - ç‰¹å¾å­˜å‚¨ï¼šClickHouse æˆ– HBase

æˆæœ¬çº¦æŸï¼š
  - è®¡ç®—èµ„æºæœ‰é™ï¼ˆä¸èƒ½è®­ç»ƒè¶…å¤§æ¨¡å‹ï¼‰
  - å­˜å‚¨ç©ºé—´æœ‰é™ï¼ˆä¸èƒ½å­˜å‚¨æ‰€æœ‰ç”¨æˆ·-è§†é¢‘äº¤äº’ï¼‰
  - æ¨ç†å»¶è¿Ÿæœ‰é™ï¼ˆä¸èƒ½åšè¶…å¤æ‚è®¡ç®—ï¼‰
```

---

## é˜¶æ®µ 1cï¼šç³»ç»Ÿè®¾è®¡ä¸å®¹é‡è¯„ä¼°ï¼ˆ2å°æ—¶ï¼‰

### å®¹é‡è®¡ç®—

```
å‡è®¾è§„æ¨¡ï¼š
  - æ—¥æ´»ç”¨æˆ·ï¼ˆDAUï¼‰ï¼š1000 ä¸‡
  - æ´»è·ƒè§†é¢‘åº“ï¼š500 ä¸‡
  - å¹³å‡ç”¨æˆ·çœ‹è§†é¢‘æ•°ï¼š10 æ¡/å¤©
  - å³°å€¼ QPSï¼š10000

å­˜å‚¨è®¡ç®—ï¼š
  ç”¨æˆ·äº¤äº’æ•°æ®ï¼š
    - æ¯ä¸ªäº¤äº’è®°å½• 200 bytesï¼ˆuser_id, video_id, action, timeï¼‰
    - æ—¥æ–°å¢äº¤äº’ï¼š1000 ä¸‡ Ã— 10 = 1 äº¿æ¡
    - 1 äº¿ Ã— 200 bytes = 20GB/å¤©
    - ä¿ç•™ 90 å¤©æ•°æ® = 1.8TBï¼ˆå¯æ¥å—ï¼‰
  
  ç”¨æˆ·ç”»åƒï¼ˆembeddingï¼‰ï¼š
    - æ¯ä¸ªç”¨æˆ· embedding å¤§å°ï¼š256 ç»´ Ã— 4 bytes = 1KB
    - 1000 ä¸‡ç”¨æˆ· = 10GBï¼ˆå¯æ¥å—ï¼‰
  
  è§†é¢‘ç‰¹å¾ï¼š
    - æ¯ä¸ªè§†é¢‘ç‰¹å¾ 500 bytes
    - 500 ä¸‡è§†é¢‘ = 2.5GBï¼ˆå¯æ¥å—ï¼‰
  
  æ¨èç»“æœç¼“å­˜ï¼š
    - æ¯ä¸ªç”¨æˆ·æ¨è 30 æ¡è§†é¢‘ ID
    - 1000 ä¸‡ç”¨æˆ· Ã— 30 Ã— 8 bytes = 2.4GB
    - TTL 1 å°æ—¶ï¼ˆç”¨æˆ·ä¼šé‡æ–°è¯·æ±‚ï¼‰

è®¡ç®—ååé‡ï¼š
  ç¦»çº¿æ¨èè®¡ç®—ï¼š
    - æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡æ¨è
    - ååŒè¿‡æ»¤ï¼šO(nÂ²) å¤æ‚åº¦ï¼Œ1000 ä¸‡ç”¨æˆ·éœ€è¦ 100+ å°æ—¶
    - ä¼˜åŒ–ï¼šåªè®¡ç®—æ´»è·ƒç”¨æˆ· 100 ä¸‡ï¼Œ1 å°æ—¶è¶³å¤Ÿ
  
  å®æ—¶æ’åºï¼š
    - å³°å€¼ 10000 QPS
    - æ¯ä¸ªè¯·æ±‚ DNN æ¨ç†ï¼š10ms
    - éœ€è¦ 100 ä¸ªå¹¶å‘æ¨ç†å¼•æ“
    - å¯ä»¥ç”¨ Tensor Serving æˆ– Triton æœåŠ¡
```

### é«˜å±‚æ¶æ„è®¾è®¡

```
                     ç”¨æˆ·è¯·æ±‚ï¼ˆApp/Webï¼‰
                            â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                     â”‚  API Gateway â”‚  é™æµã€èº«ä»½è®¤è¯
                     â”‚   LB (Nginx) â”‚
                     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ çƒ­ç‚¹æ¨èç¼“å­˜ â”‚  â”‚ ä¸ªæ€§åŒ–æ¨è  â”‚  â”‚ æœç´¢æ¨è     â”‚
    â”‚ (Redis)     â”‚  â”‚ æœåŠ¡        â”‚  â”‚ æœåŠ¡         â”‚
    â”‚ (TTL 1h)    â”‚  â”‚ (ä¸ªæ€§åŒ–å¬å›)â”‚  â”‚              â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                     â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  æ’åºå±‚(Rank)     â”‚            â”‚  ç‰¹å¾è·å–å±‚      â”‚
    â”‚  DNN CTR é¢„ä¼°    â”‚            â”‚  (Feature Store) â”‚
    â”‚  TensorFlow      â”‚            â”‚  Redis/HBase     â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
    â”‚                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
    â”‚  â”‚ å¬å›å±‚      â”‚  â”‚ ç”¨æˆ·ç‰¹å¾ç¼“å­˜   â”‚â”‚
    â”‚  â”‚ ååŒè¿‡æ»¤    â”‚  â”‚ (HBase/Redis)  â”‚â”‚
    â”‚  â”‚ å†…å®¹å¬å›    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
    â”‚  â”‚ çƒ­ç‚¹è§†é¢‘    â”‚                    â”‚
    â”‚  â”‚ (ES/Redis)  â”‚                    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
    â”‚                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ç¦»çº¿è®¡ç®—å±‚           â”‚
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚ â”‚ ç”¨æˆ·ç›¸ä¼¼åº¦è®¡ç®—    â”‚ â”‚  æ¯å°æ—¶è¿è¡Œ
         â”‚ â”‚ (Spark)          â”‚ â”‚  ååŒè¿‡æ»¤
         â”‚ â”‚ â†’ Redis          â”‚ â”‚
         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚ â”‚ ç‰¹å¾å·¥ç¨‹ä¸æå–    â”‚ â”‚  æ¯å¤©è¿è¡Œ
         â”‚ â”‚ (Spark/Pandas)   â”‚ â”‚  å¤„ç†åŸå§‹æ•°æ®
         â”‚ â”‚ â†’ ClickHouse     â”‚ â”‚
         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
         â”‚ â”‚ æ¨¡å‹è®­ç»ƒ          â”‚ â”‚  æ¯å‘¨è¿è¡Œ
         â”‚ â”‚ (DNN CTR é¢„ä¼°)   â”‚ â”‚  LR/DNN
         â”‚ â”‚ â†’ æ¨¡å‹ä»“åº“       â”‚ â”‚
         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  æ•°æ®ä»“åº“ + æ•°æ®åº“    â”‚
         â”‚  Kafka (äº‹ä»¶æµ)      â”‚
         â”‚  MySQL (ç”¨æˆ·ã€è§†é¢‘)  â”‚
         â”‚  ClickHouse (ç»Ÿè®¡)   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é˜¶æ®µ 1dï¼šæ•°æ®æ¨¡å‹ä¸å­˜å‚¨ï¼ˆ2å°æ—¶ï¼‰

### æ ¸å¿ƒæ•°æ®è¡¨

```python
# ç”¨æˆ·è¡¨
users:
  user_id (PK)
  username
  age_group
  gender
  registration_date
  last_login_date
  preferences (JSON: å…´è¶£åˆ†ç±»)

# è§†é¢‘è¡¨
videos:
  video_id (PK)
  creator_id (FK)
  title
  description
  category_id
  tags (JSON)
  duration
  publish_date
  view_count
  like_count
  comment_count

# ç”¨æˆ·-è§†é¢‘äº¤äº’è¡¨ï¼ˆæœ€é‡è¦ï¼‰
user_video_interactions:
  interaction_id (PK)
  user_id (FK, ç´¢å¼•)
  video_id (FK, ç´¢å¼•)
  action_type: ENUM('view', 'like', 'comment', 'favorite', 'dislike')
  action_value: 
    - view: å®Œæ’­æ¯”ä¾‹ 0-1
    - like: 1 or 0
    - comment: è¯„è®ºæ•°
    - favorite: 1 or 0
  timestamp
  device_type
  (composite index on user_id, timestamp)

# æ¨èç»“æœè¡¨ï¼ˆç¼“å­˜ç”¨æˆ·æœ€æ–°æ¨èï¼‰
recommendation_results:
  user_id (PK)
  recommended_video_ids (JSON Array, TOP 30)
  recommendation_time
  click_count (äº‹åç»Ÿè®¡)
  (TTL: 1 hour)
```

### ç‰¹å¾å­˜å‚¨è®¾è®¡

```
åœ¨çº¿ç‰¹å¾ï¼ˆå®æ—¶è·å–ï¼‰ï¼š
  ç”¨æˆ·ä¸´æ—¶ç‰¹å¾ï¼š
    - ä»Šå¤©çœ‹äº†å¤šå°‘è§†é¢‘ï¼ˆ0-100ï¼‰
    - æœ€åçœ‹è§†é¢‘çš„æ—¶é—´ï¼ˆè·ç¦»ç°åœ¨å¤šå°‘åˆ†é’Ÿï¼‰
    - ä»Šå¤©é¦–æ¬¡æ‰“å¼€æ—¶é—´ï¼ˆæ—©ä¸­æ™šï¼‰
  
  è§†é¢‘ä¸´æ—¶ç‰¹å¾ï¼š
    - å‘å¸ƒæ—¶é—´ï¼ˆè·ç¦»ç°åœ¨å¤šå°‘å°æ—¶ï¼‰
    - æœ€è¿‘ 1 å°æ—¶çš„ç‚¹å‡»æ•°ï¼ˆçƒ­åº¦ä¿¡å·ï¼‰
    - å½“å‰æ’­æ”¾äººæ•°ï¼ˆåŒæ—¶åœ¨çœ‹çš„äººæ•°ï¼‰

ç¦»çº¿ç‰¹å¾ï¼ˆæ¯å°æ—¶/æ¯å¤©æ›´æ–°ï¼‰ï¼š
  ç”¨æˆ·é•¿æœŸç‰¹å¾ï¼š
    - ç”¨æˆ· embeddingï¼ˆ256 ç»´ï¼Œé€šè¿‡ååŒè¿‡æ»¤å­¦åˆ°ï¼‰
    - ç”¨æˆ·å…´è¶£åˆ†å¸ƒï¼ˆåˆ†ç±»åˆ†å¸ƒï¼Œtop 5ï¼‰
    - å¹³å‡è§‚çœ‹æ—¶é•¿
    - å¹³å‡å®Œæ’­ç‡
  
  è§†é¢‘é™æ€ç‰¹å¾ï¼š
    - è§†é¢‘ embeddingï¼ˆ256 ç»´ï¼‰
    - è§†é¢‘çƒ­åº¦æŒ‡æ•°ï¼ˆæ€»æ’­æ”¾é‡å¯¹æ•°ï¼‰
    - è§†é¢‘è´¨é‡åˆ†æ•°ï¼ˆå®Œæ’­ç‡ Ã— ç‚¹èµç‡ï¼‰
    - åˆ›ä½œè€…ç­‰çº§

ç‰¹å¾å­˜å‚¨æ–¹æ¡ˆï¼š
  åœ¨çº¿ç‰¹å¾ â†’ Redis/HBaseï¼ˆæ¯«ç§’çº§è®¿é—®ï¼‰
  ç¦»çº¿ç‰¹å¾ â†’ Redis ä¸­ Hash ç»“æ„ï¼Œå®šæœŸæ›´æ–°
  
  ç¤ºä¾‹ï¼ˆRedisï¼‰ï¼š
    user:1000:features = {
      "embedding": "...",  # 256 ç»´
      "interest_dist": "...",
      "avg_watch_time": 120,
      "avg_completion_rate": 0.85
    }
    
    video:5000:features = {
      "embedding": "...",
      "hotness_index": 8.5,
      "quality_score": 0.92,
      "creator_level": "gold"
    }
```

---

## é˜¶æ®µ 1eï¼šå¼€å‘ç¯å¢ƒæ­å»ºï¼ˆ1å°æ—¶ï¼‰

### ä¾èµ–å®‰è£…

```bash
# æ ¸å¿ƒä¾èµ–
pip install flask numpy pandas scikit-learn

# æ¨èç®—æ³•
pip install scipy  # ç”¨äºç›¸ä¼¼åº¦è®¡ç®—

# æ·±åº¦å­¦ä¹ 
pip install torch torchvision  # æˆ– tensorflow

# æ•°æ®å¤„ç†
pip install pyspark  # ç¦»çº¿è®¡ç®—

# ç¼“å­˜ä¸å­˜å‚¨
pip install redis  # å®æ—¶ç¼“å­˜
pip install pymysql  # æ•°æ®åº“

# ç‰¹å¾å·¥ç¨‹
pip install pandas numpy scikit-learn

# æ¨¡å‹æœåŠ¡
pip install onnx onnxruntime  # æ¨¡å‹æ¨ç†

# ç›‘æ§ä¸æ—¥å¿—
pip install prometheus-client

# æµ‹è¯•
pip install pytest
```

### é¡¹ç›®ç»“æ„

```
bilibili_recommendation/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py          # é…ç½®å‚æ•°
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user_model.py        # ç”¨æˆ·æ¨¡å‹
â”‚   â”œâ”€â”€ video_model.py       # è§†é¢‘æ¨¡å‹
â”‚   â””â”€â”€ interaction_model.py # äº¤äº’æ¨¡å‹
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ feature_extractor.py # ç‰¹å¾æå–
â”‚   â””â”€â”€ feature_store.py     # ç‰¹å¾å­˜å‚¨ï¼ˆRedisï¼‰
â”œâ”€â”€ algorithms/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ collaborative_filtering.py  # ååŒè¿‡æ»¤
â”‚   â”œâ”€â”€ content_based.py            # å†…å®¹å¬å›
â”‚   â””â”€â”€ ranking_model.py            # CTR é¢„ä¼°æ¨¡å‹
â”œâ”€â”€ offline/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ user_cf_job.py       # ç¦»çº¿ CF è®¡ç®—
â”‚   â”œâ”€â”€ feature_extraction.py # ç¦»çº¿ç‰¹å¾æå–
â”‚   â””â”€â”€ model_training.py    # æ¨¡å‹è®­ç»ƒ
â”œâ”€â”€ online/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ recall_service.py    # å¬å›æœåŠ¡
â”‚   â”œâ”€â”€ ranking_service.py   # æ’åºæœåŠ¡
â”‚   â””â”€â”€ api_service.py       # API æœåŠ¡
â”œâ”€â”€ cache/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ redis_cache.py       # Redis ç¼“å­˜ç®¡ç†
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger.py
â”‚   â”œâ”€â”€ metrics.py           # æŒ‡æ ‡è®¡ç®—
â”‚   â””â”€â”€ constants.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_algorithms.py
â”œâ”€â”€ app.py                   # Flask ä¸»åº”ç”¨
â””â”€â”€ requirements.txt
```

---

# ğŸ“ ç¬¬1å¤©æ€»ç»“

å®Œæˆç¬¬ 1 å¤©åï¼Œä½ åº”è¯¥ç†è§£ï¼š

âœ… **æ¦‚å¿µæ¸…æ™°**

- å¬å›ä¸æ’åºçš„åŒºåˆ«ä¸æµç¨‹
- ååŒè¿‡æ»¤çš„åŸºæœ¬åŸç†
- B ç«™æ¨èçš„ç‹¬ç‰¹ç‰¹ç‚¹ï¼ˆå¤šä¿¡å·ã€å†·å¯åŠ¨ã€å¤šæ ·æ€§ï¼‰
- ä¸‰å±‚æ¶æ„å¦‚ä½•å·¥ä½œ

âœ… **è®¾è®¡æ¸…æ™°**

- ç³»ç»Ÿå®¹é‡è¯„ä¼°æ–¹æ³•
- æ¨èç³»ç»Ÿçš„é«˜å±‚æ¶æ„
- æ•°æ®æ¨¡å‹çš„è®¾è®¡
- åŠŸèƒ½æ¨¡å—çš„åˆ’åˆ†

âœ… **å‡†å¤‡å°±ç»ª**

- ç¯å¢ƒå·²æ­å»º
- é¡¹ç›®ç»“æ„å·²è®¾è®¡
- åšå¥½è¿›å…¥ç¬¬ 2 å¤©ï¼ˆç®—æ³•å®ç°ï¼‰çš„å‡†å¤‡

---

# ç¬¬2å¤©ï¼šæ¨èç®—æ³•å®ç° + ç¦»çº¿è®¡ç®—ï¼ˆ8å°æ—¶ï¼‰

## ç›®æ ‡ï¼šå®ç°ååŒè¿‡æ»¤ + DNN æ’åºæ¨¡å‹ï¼Œå®Œæˆå¯è¿è¡Œçš„ Demo

---

# ğŸ“‹ ç¬¬2å¤©æ—¶é—´åˆ†é…

|æ—¶é—´æ®µ|å†…å®¹|è¾“å‡º|
|---|---|---|
|**8:00-9:30**|ååŒè¿‡æ»¤ç®—æ³•è¯¦è§£ + ä»£ç å®ç°|å¯è¿è¡Œçš„ CF ç®—æ³•|
|**9:30-11:00**|ç”¨æˆ·ç›¸ä¼¼åº¦è®¡ç®—ä¸ä¼˜åŒ–|ä¼˜åŒ–åçš„ç›¸ä¼¼åº¦çŸ©é˜µ|
|**11:00-12:30**|å†…å®¹å¬å›ä¸å¤šè·¯å¬å›èåˆ|å¤šè·¯å¬å› Demo|
|**12:30-14:00**|åˆä¼‘ + å°ç»“|-|
|**14:00-15:30**|DNN CTR é¢„ä¼°æ¨¡å‹è®¾è®¡|æ¨¡å‹æ¶æ„ä»£ç |
|**15:30-17:00**|ç‰¹å¾å·¥ç¨‹ä¸æ•°æ®å‡†å¤‡|ç‰¹å¾å·¥ç¨‹ Pipeline|
|**17:00-18:30**|æ¨¡å‹è®­ç»ƒä¸è¯„ä¼°|è®­ç»ƒå¥½çš„æ¨¡å‹|
|**18:30-20:00**|ç«¯åˆ°ç«¯é›†æˆä¸å‹æµ‹|å¯è¿è¡Œçš„å®Œæ•´ Demo|

---

# ğŸ”´ æ—¶æ®µ1ï¼šååŒè¿‡æ»¤ç®—æ³•è¯¦è§£ + ä»£ç å®ç°ï¼ˆ1.5å°æ—¶ï¼‰

## ååŒè¿‡æ»¤çš„æ•°å­¦åŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰

### æ ¸å¿ƒæ€æƒ³

```
å‡è®¾åœºæ™¯ï¼š
  ç”¨æˆ· A çœ‹äº†è§†é¢‘ 1, 2, 3
  ç”¨æˆ· B çœ‹äº†è§†é¢‘ 1, 2, 4
  ç”¨æˆ· C çœ‹äº†è§†é¢‘ 1, 3, 5

è§‚å¯Ÿï¼šA å’Œ B æœ‰ 67% ç›¸ä¼¼åº¦ï¼ˆå…±åŒè§†é¢‘ 2/3ï¼‰

æ¨è®ºï¼šæ—¢ç„¶ Aã€B å–œæ¬¢ç±»ä¼¼çš„è§†é¢‘ï¼Œ
      é‚£ä¹ˆ B å–œæ¬¢çš„å…¶ä»–è§†é¢‘ï¼ˆ4ï¼‰ï¼ŒA å¾ˆå¯èƒ½ä¹Ÿä¼šå–œæ¬¢

æ¨èç»™ Aï¼šè§†é¢‘ 4ï¼ˆåŸºäºä¸ B çš„ç›¸ä¼¼æ€§ï¼‰
```

### User-Based CF çš„è®¡ç®—æ­¥éª¤

```
ç¬¬1æ­¥ï¼šæ„å»ºç”¨æˆ·-è§†é¢‘äº¤äº’çŸ©é˜µ
       v1  v2  v3  v4  v5
  u1   1   1   1   0   0    (ç”¨æˆ· A çš„äº¤äº’)
  u2   1   1   0   1   0    (ç”¨æˆ· B çš„äº¤äº’)
  u3   1   0   1   0   1    (ç”¨æˆ· C çš„äº¤äº’)

ç¬¬2æ­¥ï¼šè®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦ï¼ˆä½¿ç”¨ Jaccard æˆ– Cosineï¼‰
  
  Jaccard(A, B) = |A âˆ© B| / |A âˆª B| = 2/4 = 0.5
  Cosine(A, B)  = (A Â· B) / (||A|| Ã— ||B||)
                = 2 / (âˆš3 Ã— âˆš3) = 2/3 â‰ˆ 0.67

ç¬¬3æ­¥ï¼šä¸ºç”¨æˆ· A æ‰¾å‡º Top N ç›¸ä¼¼ç”¨æˆ·
  Top 3: B(0.67), C(0.67), ...

ç¬¬4æ­¥ï¼šæ”¶é›†è¿™äº›ç›¸ä¼¼ç”¨æˆ·çœ‹è¿‡ä½† A æ²¡çœ‹è¿‡çš„è§†é¢‘
  B çœ‹äº† 4, A æ²¡çœ‹ â†’ åˆ†æ•° = 0.67
  C çœ‹äº† 5, A æ²¡çœ‹ â†’ åˆ†æ•° = 0.67

ç¬¬5æ­¥ï¼šæ’åºè¿™äº›è§†é¢‘ï¼Œæ¨è Top K
  æ¨èï¼š[è§†é¢‘ 4, è§†é¢‘ 5]
```

### Item-Based CFï¼ˆå·¥ä¸šç•Œæ›´å¸¸ç”¨ï¼‰

```
ä¸ºä»€ä¹ˆ Item-Based æ¯” User-Based å¥½ï¼Ÿ

User-Based é—®é¢˜ï¼š
  - ç”¨æˆ·æ•°å¤šï¼ˆ1000 ä¸‡ï¼‰ï¼Œè®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µå¤æ‚åº¦ O(nÂ²) = 100 ä¸‡äº¿
  - å¤ªæ…¢ï¼ˆæ— æ³•å®æ—¶ï¼‰
  - å†…å­˜å ç”¨å·¨å¤§

Item-Based ä¼˜åŠ¿ï¼š
  - è§†é¢‘æ•°å°‘ï¼ˆ500 ä¸‡ï¼‰ï¼Œè®¡ç®—ç›¸ä¼¼åº¦ O(mÂ²) = 2500 ä¸‡
  - å¯ä»¥ç¦»çº¿é¢„è®¡ç®—
  - æ¨ç†å¿«ï¼ˆæŸ¥ç´¢å¼•ï¼‰

åŸç†ï¼š
  ç›¸ä¼¼çš„è§†é¢‘ï¼š
    - è¢«åŒä¸€ç”¨æˆ·çœ‹è¿‡ï¼ˆå…±åŒç”¨æˆ·ï¼‰
    - åˆ†ç±»ç›¸åŒï¼ˆå†…å®¹ç›¸ä¼¼ï¼‰
    - æ ‡ç­¾ç›¸åŒ
  
  æ¨èæµç¨‹ï¼š
    1. æ‰¾å‡ºç”¨æˆ· A çœ‹è¿‡çš„è§†é¢‘é›†åˆ
    2. æ‰¾å‡ºè¿™äº›è§†é¢‘çš„ç›¸ä¼¼è§†é¢‘
    3. æ’åºå¹¶æ¨è Top K
```

## ä»£ç å®ç°ï¼šUser-Based CF

```python
# algorithms/collaborative_filtering.py
import numpy as np
from scipy.sparse import csr_matrix
from sklearn.metrics.pairwise import cosine_similarity
import pandas as pd
from typing import Dict, List, Tuple
from collections import defaultdict

class UserBasedCF:
    """
    User-Based ååŒè¿‡æ»¤
    
    ç”¨äºæ¼”ç¤ºï¼Œå·¥ä¸šçº§åº”è¯¥ç”¨ Item-Based
    """
    
    def __init__(self, min_common_items: int = 2):
        """
        Args:
            min_common_items: è®¡ç®—ç›¸ä¼¼åº¦çš„æœ€å°‘å…±åŒè§†é¢‘æ•°
        """
        self.min_common_items = min_common_items
        self.user_item_matrix = None
        self.user_similarity = None
        self.user_id_map = {}
        self.item_id_map = {}
        self.reverse_user_map = {}
        self.reverse_item_map = {}
    
    def build_matrix(self, interactions_df: pd.DataFrame):
        """
        æ„å»ºç”¨æˆ·-è§†é¢‘äº¤äº’çŸ©é˜µ
        
        interactions_df:
            user_id, video_id, interaction_value
        """
        # ID æ˜ å°„ï¼ˆè¿ç»­åŒ–ï¼‰
        unique_users = interactions_df['user_id'].unique()
        unique_videos = interactions_df['video_id'].unique()
        
        self.user_id_map = {uid: idx for idx, uid in enumerate(unique_users)}
        self.item_id_map = {vid: idx for idx, vid in enumerate(unique_videos)}
        
        self.reverse_user_map = {v: k for k, v in self.user_id_map.items()}
        self.reverse_item_map = {v: k for k, v in self.item_id_map.items()}
        
        # æ„å»ºçŸ©é˜µ
        num_users = len(unique_users)
        num_videos = len(unique_videos)
        
        row = interactions_df['user_id'].map(self.user_id_map).values
        col = interactions_df['video_id'].map(self.item_id_map).values
        data = interactions_df['interaction_value'].values
        
        self.user_item_matrix = csr_matrix(
            (data, (row, col)),
            shape=(num_users, num_videos)
        )
        
        print(f"[*] æ„å»ºçŸ©é˜µæˆåŠŸ: {num_users} ç”¨æˆ· Ã— {num_videos} è§†é¢‘")
        print(f"[*] ç¨€ç–åº¦: {1 - len(interactions_df) / (num_users * num_videos):.4f}")
    
    def compute_user_similarity(self):
        """
        è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦çŸ©é˜µ (Cosine)
        
        å…¬å¼ï¼šsim(u1, u2) = (u1 Â· u2) / (||u1|| Ã— ||u2||)
        
        æ³¨æ„ï¼šå¯¹äºå¤§è§„æ¨¡ç”¨æˆ·ï¼Œè¿™ä¸€æ­¥æ˜¯æ€§èƒ½ç“¶é¢ˆ
        """
        print("[*] è®¡ç®—ç”¨æˆ·ç›¸ä¼¼åº¦çŸ©é˜µ...")
        
        # è½¬æ¢ä¸ºå¯†é›†çŸ©é˜µè®¡ç®—ï¼ˆå°æ•°æ®é›†ï¼‰
        # å¦‚æœç”¨æˆ·æ•° > 100ä¸‡ï¼Œéœ€è¦ä½¿ç”¨è¿‘ä¼¼ç®—æ³•æˆ–åˆ†å¸ƒå¼è®¡ç®—
        self.user_similarity = cosine_similarity(self.user_item_matrix)
        
        # å¯¹è§’çº¿è®¾ä¸º 0ï¼ˆç”¨æˆ·ä¸è‡ªå·±ä¸è®¡ç®—ç›¸ä¼¼åº¦ï¼‰
        np.fill_diagonal(self.user_similarity, 0)
        
        print(f"[*] ç”¨æˆ·ç›¸ä¼¼åº¦çŸ©é˜µå½¢çŠ¶: {self.user_similarity.shape}")
        print(f"[*] å¹³å‡ç›¸ä¼¼åº¦: {self.user_similarity[self.user_similarity > 0].mean():.4f}")
    
    def get_similar_users(self, user_id: int, top_n: int = 10) -> List[Tuple[int, float]]:
        """è·å–ç”¨æˆ·çš„ç›¸ä¼¼ç”¨æˆ·"""
        user_idx = self.user_id_map.get(user_id)
        if user_idx is None:
            return []
        
        similarities = self.user_similarity[user_idx]
        top_indices = np.argsort(similarities)[-top_n:][::-1]
        
        result = [
            (self.reverse_user_map[idx], float(similarities[idx]))
            for idx in top_indices
            if similarities[idx] > 0
        ]
        return result
    
    def recommend(self, user_id: int, top_k: int = 30, 
                  top_similar_users: int = 10) -> List[Tuple[int, float]]:
        """
        æ¨èè§†é¢‘ç»™ç”¨æˆ·
        
        Args:
            user_id: ç›®æ ‡ç”¨æˆ·
            top_k: æ¨èè§†é¢‘æ•°
            top_similar_users: æ‰¾å‡ºçš„ç›¸ä¼¼ç”¨æˆ·æ•°
        
        Returns:
            [(video_id, score), ...]
        """
        user_idx = self.user_id_map.get(user_id)
        if user_idx is None:
            print(f"[!] ç”¨æˆ· {user_id} ä¸å­˜åœ¨")
            return []
        
        # ç¬¬1æ­¥ï¼šæ‰¾å‡ºç›¸ä¼¼ç”¨æˆ·
        similar_users = self.get_similar_users(user_id, top_similar_users)
        if not similar_users:
            print(f"[!] ç”¨æˆ· {user_id} æ²¡æœ‰ç›¸ä¼¼ç”¨æˆ·")
            return []
        
        # ç¬¬2æ­¥ï¼šæ”¶é›†ç›¸ä¼¼ç”¨æˆ·çœ‹è¿‡çš„è§†é¢‘åŠè¯„åˆ†
        video_scores = defaultdict(float)
        user_watched = set(self.user_item_matrix[user_idx].nonzero()[1])
        
        for sim_user_id, similarity in similar_users:
            sim_user_idx = self.user_id_map[sim_user_id]
            
            # ç›¸ä¼¼ç”¨æˆ·çœ‹è¿‡çš„è§†é¢‘
            sim_user_videos = self.user_item_matrix[sim_user_idx].nonzero()[1]
            
            for video_idx in sim_user_videos:
                # è·³è¿‡ç”¨æˆ·å·²çœ‹è¿‡çš„
                if video_idx in user_watched:
                    continue
                
                video_id = self.reverse_item_map[video_idx]
                
                # åŠ æƒè¯„åˆ† = ç›¸ä¼¼åº¦ Ã— è§†é¢‘è¯„åˆ†
                video_score = self.user_item_matrix[sim_user_idx, video_idx]
                video_scores[video_id] += similarity * video_score
        
        # ç¬¬3æ­¥ï¼šæ’åºå¹¶è¿”å› Top K
        recommendations = sorted(
            video_scores.items(),
            key=lambda x: x[1],
            reverse=True
        )[:top_k]
        
        return recommendations


class ItemBasedCF:
    """
    Item-Based ååŒè¿‡æ»¤ï¼ˆå·¥ä¸šç•Œæ ‡å‡†ï¼‰
    
    ä¼˜åŠ¿ï¼š
    - è§†é¢‘æ•°å°‘ï¼Œå¯ç¦»çº¿é¢„è®¡ç®—ç›¸ä¼¼åº¦
    - æ¨ç†å¿«
    - æ›´ç¨³å®š
    """
    
    def __init__(self):
        self.item_item_similarity = {}  # è§†é¢‘ç›¸ä¼¼åº¦ç´¢å¼•
        self.user_item_dict = {}         # ç”¨æˆ·çœ‹è¿‡çš„è§†é¢‘
        self.item_popularity = {}        # è§†é¢‘çƒ­åº¦
    
    def build_from_interactions(self, interactions_df: pd.DataFrame):
        """
        ä»äº¤äº’æ•°æ®æ„å»º Item-Based CF
        """
        print("[*] æ„å»º Item-Based CF...")
        
        # æ„å»ºç”¨æˆ·-è§†é¢‘æ˜ å°„
        for _, row in interactions_df.iterrows():
            user_id = row['user_id']
            video_id = row['video_id']
            value = row['interaction_value']
            
            if user_id not in self.user_item_dict:
                self.user_item_dict[user_id] = []
            
            self.user_item_dict[user_id].append((video_id, value))
        
        # è®¡ç®—è§†é¢‘çƒ­åº¦
        video_counts = interactions_df.groupby('video_id').size()
        self.item_popularity = video_counts.to_dict()
        
        # è®¡ç®—è§†é¢‘ç›¸ä¼¼åº¦
        self._compute_item_similarity(interactions_df)
    
    def _compute_item_similarity(self, interactions_df: pd.DataFrame):
        """
        è®¡ç®—è§†é¢‘ç›¸ä¼¼åº¦
        
        ä¸¤ä¸ªè§†é¢‘ç›¸ä¼¼ âŸº è¢«åŒä¸€æ‰¹ç”¨æˆ·çœ‹è¿‡
        
        å…¬å¼ï¼šsim(v1, v2) = |users(v1) âˆ© users(v2)| / 
                            sqrt(|users(v1)| Ã— |users(v2)|)
        """
        print("[*] è®¡ç®—è§†é¢‘ç›¸ä¼¼åº¦...")
        
        # æ„å»ºè§†é¢‘-ç”¨æˆ·åå‘ç´¢å¼•
        video_users = defaultdict(set)
        for _, row in interactions_df.iterrows():
            video_users[row['video_id']].add(row['user_id'])
        
        videos = list(video_users.keys())
        n_videos = len(videos)
        
        # è®¡ç®—ç›¸ä¼¼åº¦ï¼ˆåªå­˜å‚¨é«˜ç›¸ä¼¼åº¦çš„ï¼‰
        for i, v1 in enumerate(videos):
            if i % 1000 == 0:
                print(f"[*] è¿›åº¦: {i}/{n_videos}")
            
            users_v1 = video_users[v1]
            
            for v2 in videos:
                if v1 >= v2:  # é¿å…é‡å¤è®¡ç®—
                    continue
                
                users_v2 = video_users[v2]
                
                # Jaccard ç›¸ä¼¼åº¦
                intersection = len(users_v1 & users_v2)
                union = len(users_v1 | users_v2)
                
                similarity = intersection / union if union > 0 else 0
                
                # åªå­˜å‚¨ç›¸ä¼¼åº¦ > 0.1 çš„å…³ç³»
                if similarity > 0.1:
                    if v1 not in self.item_item_similarity:
                        self.item_item_similarity[v1] = {}
                    self.item_item_similarity[v1][v2] = similarity
                    
                    if v2 not in self.item_item_similarity:
                        self.item_item_similarity[v2] = {}
                    self.item_item_similarity[v2][v1] = similarity
    
    def recommend(self, user_id: int, top_k: int = 30) -> List[Tuple[int, float]]:
        """
        æ¨èè§†é¢‘ç»™ç”¨æˆ·
        
        æµç¨‹ï¼š
        1. æ‰¾å‡ºç”¨æˆ·çœ‹è¿‡çš„è§†é¢‘
        2. æ‰¾å‡ºè¿™äº›è§†é¢‘çš„ç›¸ä¼¼è§†é¢‘
        3. æ’åºå¹¶æ¨è
        """
        user_watched = self.user_item_dict.get(user_id, [])
        if not user_watched:
            print(f"[!] ç”¨æˆ· {user_id} æ²¡æœ‰çœ‹è¿‡è§†é¢‘")
            return []
        
        # æ”¶é›†å€™é€‰è§†é¢‘åŠè¯„åˆ†
        video_scores = defaultdict(float)
        
        for watched_video, watch_value in user_watched:
            similar_videos = self.item_item_similarity.get(watched_video, {})
            
            for sim_video, similarity in similar_videos.items():
                # å·²çœ‹è¿‡çš„è§†é¢‘ä¸æ¨è
                if sim_video in [v for v, _ in user_watched]:
                    continue
                
                # åŠ æƒè¯„åˆ† = åŸè§†é¢‘è¯„åˆ† Ã— ç›¸ä¼¼åº¦
                score = watch_value * similarity
                video_scores[sim_video] += score
        
        # æ’åº
        recommendations = sorted(
            video_scores.items(),
            key=lambda x: x[1],
            reverse=True
        )[:top_k]
        
        return recommendations
```

---

# ğŸŸ¡ æ—¶æ®µ2ï¼šç”¨æˆ·ç›¸ä¼¼åº¦è®¡ç®—ä¸ä¼˜åŒ–ï¼ˆ1.5å°æ—¶ï¼‰

## é—®é¢˜åˆ†æ

```
User-Based CF çš„ç“¶é¢ˆï¼š

è§„æ¨¡ï¼š100 ä¸‡ç”¨æˆ· Ã— 100 ä¸‡ç”¨æˆ·çš„ç›¸ä¼¼åº¦çŸ©é˜µ
è®¡ç®—é‡ï¼šO(nÂ²) = 1 ä¸‡äº¿æ¬¡æ¯”è¾ƒ
å†…å­˜ï¼š100 ä¸‡ Ã— 100 ä¸‡ Ã— 4 bytes = 400GBï¼ˆæ— æ³•å­˜å‚¨ï¼‰

è§£å†³æ–¹æ¡ˆï¼š
1. åªä¿å­˜ Top ç›¸ä¼¼ç”¨æˆ·ï¼ˆå¦‚æ¯ä¸ªç”¨æˆ·åªä¿å­˜ Top 100ï¼‰
2. ä½¿ç”¨è¿‘ä¼¼ç®—æ³•ï¼ˆLocality Sensitive Hashingï¼‰
3. åˆ†å¸ƒå¼è®¡ç®—ï¼ˆSparkï¼‰
```

## ä¼˜åŒ–å®ç°ï¼šLSH + ç¦»çº¿è®¡ç®—

```python
# algorithms/similarity_optimization.py
import numpy as np
from collections import defaultdict
from typing import Dict, List
import hashlib

class MinHashSimilarity:
    """
    MinHashï¼šå¿«é€Ÿä¼°è®¡ Jaccard ç›¸ä¼¼åº¦çš„è¿‘ä¼¼ç®—æ³•
    
    ä¼˜åŠ¿ï¼š
    - æ—¶é—´å¤æ‚åº¦å¤§å¹…é™ä½
    - é€‚åˆ Spark åˆ†å¸ƒå¼è®¡ç®—
    - ç²¾åº¦å¯æ§
    """
    
    def __init__(self, num_hashes: int = 128):
        """
        Args:
            num_hashes: Hash å‡½æ•°æ•°é‡ï¼ˆè¶Šå¤šè¶Šç²¾ç¡®ï¼Œä½†è¶Šæ…¢ï¼‰
        """
        self.num_hashes = num_hashes
        self.hash_funcs = self._init_hash_functions(num_hashes)
    
    def _init_hash_functions(self, num_hashes: int):
        """åˆå§‹åŒ– Hash å‡½æ•°"""
        return [
            lambda x, seed=i: hash((x, seed)) % (2**32)
            for i in range(num_hashes)
        ]
    
    def get_minhash_signature(self, user_watched_videos: set) -> np.ndarray:
        """
        ä¸ºç”¨æˆ·ç”Ÿæˆ MinHash ç­¾å
        
        ç­¾åï¼šé•¿åº¦ä¸º num_hashes çš„å‘é‡
        æ¯ä¸ªä½ç½® i æ˜¯å¯¹åº” hash å‡½æ•°çš„æœ€å°å“ˆå¸Œå€¼
        """
        if not user_watched_videos:
            return np.full(self.num_hashes, float('inf'))
        
        signature = np.full(self.num_hashes, float('inf'))
        
        for video_id in user_watched_videos:
            for i, hash_func in enumerate(hash_funcs):
                hash_value = hash_func(video_id)
                signature[i] = min(signature[i], hash_value)
        
        return signature
    
    def estimate_similarity(self, sig1: np.ndarray, sig2: np.ndarray) -> float:
        """
        ä½¿ç”¨ MinHash ç­¾åä¼°è®¡ä¸¤ä¸ªé›†åˆçš„ Jaccard ç›¸ä¼¼åº¦
        
        åŸç†ï¼šç›¸åŒçš„ MinHash ä½ç½® / æ€»ä½ç½®æ•° â‰ˆ Jaccard ç›¸ä¼¼åº¦
        """
        if len(sig1) == 0 or len(sig2) == 0:
            return 0.0
        
        matches = np.sum(sig1 == sig2)
        return matches / len(sig1)


class LocalitySensitiveHashing:
    """
    LSHï¼šå¿«é€Ÿæ‰¾å‡ºç›¸ä¼¼ç”¨æˆ·
    
    åŸç†ï¼šå°†ç›¸ä¼¼çš„ç”¨æˆ·æ˜ å°„åˆ°åŒä¸€ä¸ª bucketï¼Œç„¶ååªæ¯”è¾ƒåŒ bucket çš„ç”¨æˆ·
    """
    
    def __init__(self, num_buckets: int = 100, band_width: int = 8):
        """
        Args:
            num_buckets: æ¡¶æ•°é‡
            band_width: æ¯ä¸ª band çš„ hash è¡Œæ•°
        """
        self.num_buckets = num_buckets
        self.band_width = band_width
        self.buckets = defaultdict(list)
        self.user_signatures = {}
    
    def add_user(self, user_id: int, signature: np.ndarray):
        """å°†ç”¨æˆ·åŠå…¶ç­¾ååŠ å…¥ LSH"""
        self.user_signatures[user_id] = signature
        
        # å°†ç­¾ååˆ†æˆè‹¥å¹² bandï¼Œæ¯ä¸ª band å“ˆå¸Œåˆ°ä¸€ä¸ª bucket
        num_bands = len(signature) // self.band_width
        
        for band_idx in range(num_bands):
            start = band_idx * self.band_width
            end = start + self.band_width
            
            band = signature[start:end]
            
            # å°† band è½¬æ¢ä¸ºå¯å“ˆå¸Œçš„æ ¼å¼
            band_hash = hash(tuple(band)) % self.num_buckets
            
            self.buckets[band_hash].append(user_id)
    
    def find_similar_users(self, user_id: int) -> List[int]:
        """æ‰¾å‡ºä¸ç”¨æˆ·åœ¨åŒä¸€ bucket çš„å…¶ä»–ç”¨æˆ·"""
        signature = self.user_signatures.get(user_id)
        if signature is None:
            return []
        
        similar_candidates = set()
        num_bands = len(signature) // self.band_width
        
        for band_idx in range(num_bands):
            start = band_idx * self.band_width
            end = start + self.band_width
            
            band = signature[start:end]
            band_hash = hash(tuple(band)) % self.num_buckets
            
            # åŒ bucket çš„æ‰€æœ‰ç”¨æˆ·éƒ½æ˜¯å€™é€‰
            for candidate_id in self.buckets[band_hash]:
                if candidate_id != user_id:
                    similar_candidates.add(candidate_id)
        
        return list(similar_candidates)


class UserSimilarityComputer:
    """
    å®Œæ•´çš„ç”¨æˆ·ç›¸ä¼¼åº¦è®¡ç®—ç³»ç»Ÿ
    
    å·¥ä½œæµï¼š
    1. ç”Ÿæˆ MinHash ç­¾å
    2. ä½¿ç”¨ LSH å¿«é€Ÿæ‰¾å‡ºå€™é€‰ç›¸ä¼¼ç”¨æˆ·
    3. ç²¾ç¡®è®¡ç®— Jaccard ç›¸ä¼¼åº¦
    4. ä¿å­˜ Top ç›¸ä¼¼ç”¨æˆ·
    """
    
    def __init__(self, num_minhash: int = 128, num_lsh_buckets: int = 100):
        self.minhash = MinHashSimilarity(num_minhash)
        self.lsh = LocalitySensitiveHashing(num_lsh_buckets)
        self.user_watched_videos = {}
        self.user_top_similar = {}  # æ¯ä¸ªç”¨æˆ·çš„ Top 100 ç›¸ä¼¼ç”¨æˆ·
    
    def build(self, interactions_df):
        """æ„å»ºç”¨æˆ·ç›¸ä¼¼åº¦ç´¢å¼•"""
        print("[*] ç”Ÿæˆ MinHash ç­¾å...")
        
        # ç¬¬1æ­¥ï¼šç”Ÿæˆç­¾å
        for _, row in interactions_df.iterrows():
            user_id = row['user_id']
            video_id = row['video_id']
            
            if user_id not in self.user_watched_videos:
                self.user_watched_videos[user_id] = set()
            
            self.user_watched_videos[user_id].add(video_id)
        
        # ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆç­¾å
        user_signatures = {}
        for user_id, videos in self.user_watched_videos.items():
            sig = self.minhash.get_minhash_signature(videos)
            user_signatures[user_id] = sig
            self.lsh.add_user(user_id, sig)
        
        print("[*] ä½¿ç”¨ LSH æ‰¾å€™é€‰ç›¸ä¼¼ç”¨æˆ·...")
        
        # ç¬¬2æ­¥ï¼šä½¿ç”¨ LSH æ‰¾å€™é€‰
        all_users = list(self.user_watched_videos.keys())
        
        for i, user_id in enumerate(all_users):
            if i % 10000 == 0:
                print(f"[*] è¿›åº¦: {i}/{len(all_users)}")
            
            candidates = self.lsh.find_similar_users(user_id)
            
            # ç¬¬3æ­¥ï¼šç²¾ç¡®è®¡ç®—å€™é€‰çš„ç›¸ä¼¼åº¦
            similarities = []
            for candidate_id in candidates:
                jaccard = self._compute_jaccard(
                    self.user_watched_videos[user_id],
                    self.user_watched_videos[candidate_id]
                )
                similarities.append((candidate_id, jaccard))
            
            # æ’åºå¹¶ä¿å­˜ Top 100
            similarities.sort(key=lambda x: x[1], reverse=True)
            self.user_top_similar[user_id] = similarities[:100]
    
    @staticmethod
    def _compute_jaccard(set1: set, set2: set) -> float:
        """è®¡ç®— Jaccard ç›¸ä¼¼åº¦"""
        intersection = len(set1 & set2)
        union = len(set1 | set2)
        return intersection / union if union > 0 else 0.0
    
    def get_similar_users(self, user_id: int) -> List[tuple]:
        """è·å–ç”¨æˆ·çš„ç›¸ä¼¼ç”¨æˆ·"""
        return self.user_top_similar.get(user_id, [])
```

---

# ğŸŸ¢ æ—¶æ®µ3ï¼šå†…å®¹å¬å›ä¸å¤šè·¯å¬å›èåˆï¼ˆ1.5å°æ—¶ï¼‰

## å¤šè·¯å¬å›ç­–ç•¥

```
ä¸€ä¸ªæ¨èç³»ç»Ÿé€šå¸¸æœ‰å¤šä¸ªå¬å›é€šé“ï¼š

1. ååŒè¿‡æ»¤å¬å›
   - åŸºäºç”¨æˆ·-è§†é¢‘äº¤äº’å†å²
   - æ•æ‰ç”¨æˆ·åå¥½

2. å†…å®¹å¬å›
   - åŸºäºè§†é¢‘ç‰¹å¾ï¼ˆåˆ†ç±»ã€æ ‡ç­¾ã€æè¿°ï¼‰
   - ç”¨äºå†·å¯åŠ¨ï¼ˆæ–°è§†é¢‘æ²¡æœ‰äº¤äº’æ•°æ®ï¼‰

3. çƒ­ç‚¹å¬å›
   - åŸºäºå®æ—¶çƒ­åº¦ï¼ˆç‚¹å‡»æ•°ã€è¯„è®ºæ•°ï¼‰
   - æ•æ‰æ—¶æ•ˆæ€§

4. åˆ›ä½œè€…å¬å›
   - åŸºäºç”¨æˆ·å…³æ³¨çš„åˆ›ä½œè€…
   - é«˜ç²˜æ€§

5. å…´è¶£æ ‡ç­¾å¬å›
   - åŸºäºç”¨æˆ·æ ‡è®°çš„å…´è¶£æ ‡ç­¾
   - æ˜ç¡®çš„æ„å›¾ä¿¡å·

æ¯ä¸ªé€šé“ç‹¬ç«‹è®¡ç®—ï¼Œç„¶åèåˆ
```

## ä»£ç å®ç°

```python
# algorithms/recall_strategies.py
from typing import List, Dict, Set
import numpy as np
from collections import defaultdict

class ContentBasedRecall:
    """
    åŸºäºè§†é¢‘å†…å®¹ç‰¹å¾çš„å¬å›
    
    é€‚ç”¨äºï¼š
    - å†·å¯åŠ¨ï¼ˆæ–°è§†é¢‘ï¼‰
    - ç”¨æˆ·æ²¡æœ‰çœ‹è¿‡çš„åˆ†ç±»
    """
    
    def __init__(self):
        self.video_features = {}  # è§†é¢‘ç‰¹å¾å‘é‡
        self.video_categories = {}  # è§†é¢‘åˆ†ç±»
        self.video_tags = defaultdict(set)  # è§†é¢‘æ ‡ç­¾
    
    def build(self, videos_df):
        """æ„å»ºå†…å®¹ç‰¹å¾ç´¢å¼•"""
        for _, row in videos_df.iterrows():
            video_id = row['video_id']
            
            self.video_categories[video_id] = row['category_id']
            
            # æ ‡ç­¾ï¼ˆå‡è®¾æ˜¯é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼‰
            tags = str(row.get('tags', '')).split(',')
            self.video_tags[video_id] = set(tags)
    
    def find_similar_videos(self, video_id: int, top_k: int = 100) -> List[int]:
        """æ‰¾å‡ºä¸ç»™å®šè§†é¢‘ç›¸ä¼¼çš„è§†é¢‘"""
        if video_id not in self.video_categories:
            return []
        
        target_category = self.video_categories[video_id]
        target_tags = self.video_tags[video_id]
        
        similarities = []
        
        for other_vid, category in self.video_categories.items():
            if other_vid == video_id:
                continue
            
            score = 0.0
            
            # ç›¸åŒåˆ†ç±» +1 åˆ†
            if category == target_category:
                score += 1.0
            
            # å…±åŒæ ‡ç­¾ +0.5 åˆ†
            common_tags = len(target_tags & self.video_tags[other_vid])
            score += common_tags * 0.5
            
            if score > 0:
                similarities.append((other_vid, score))
        
        similarities.sort(key=lambda x: x[1], reverse=True)
        return [vid for vid, _ in similarities[:top_k]]
    
    def recommend_by_interest(self, user_interests: List[int], 
                             top_k: int = 100) -> List[int]:
        """
        æ ¹æ®ç”¨æˆ·å…´è¶£æ ‡ç­¾æ¨èè§†é¢‘
        
        ç”¨æˆ·å…´è¶£ = ç”¨æˆ·æ ‡è®°çš„æ ‡ç­¾
        """
        interest_set = set(user_interests)
        video_scores = defaultdict(float)
        
        for video_id, tags in self.video_tags.items():
            common_tags = len(interest_set & tags)
            if common_tags > 0:
                video_scores[video_id] = common_tags
        
        sorted_videos = sorted(
            video_scores.items(),
            key=lambda x: x[1],
            reverse=True
        )
        
        return [vid for vid, _ in sorted_videos[:top_k]]


class HotVideoRecall:
    """
    åŸºäºå®æ—¶çƒ­åº¦çš„å¬å›
    
    çƒ­åº¦æ¥æºï¼š
    - ç‚¹å‡»æ•°
    - è¯„è®ºæ•°
    - ç‚¹èµæ•°ï¼ˆåŠ æƒï¼‰
    - å‘å¸ƒæ—¶é—´ï¼ˆæ–°è§†é¢‘åŠ æƒï¼‰
    """
    
    def __init__(self):
        self.video_hotness = {}  # è§†é¢‘çƒ­åº¦åˆ†æ•°
    
    def build(self, videos_df, interactions_df):
        """è®¡ç®—è§†é¢‘çƒ­åº¦"""
        # è·å–è§†é¢‘çš„å„é¡¹æŒ‡æ ‡
        video_stats = interactions_df.groupby('video_id').agg({
            'user_id': 'count'  # ç‚¹å‡»æ•°
        }).rename(columns={'user_id': 'clicks'})
        
        for video_id, row in videos_df.iterrows():
            clicks = video_stats.get(row['video_id'], 0)
            
            # çƒ­åº¦å…¬å¼ = log(ç‚¹å‡»æ•° + 1) + å…¶ä»–å› ç´ 
            # è¿™é‡Œ
```