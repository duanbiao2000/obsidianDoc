# ä¸‰ç§åç«¯ä»“åº“ç±»å‹çš„æ·±åº¦å­¦ä¹ æŒ‡å—

> **æ ¸å¿ƒæ€æƒ³**ï¼šåç«¯ä»“åº“çœ‹ä¼¼ç›¸ä¼¼ï¼Œä½†ä¸‰ç§ç±»å‹çš„**æ¶æ„ç»´åº¦ã€å­¦ä¹ åˆ‡å…¥ç‚¹ã€æ ¸å¿ƒäº’åŠ¨æ–¹å¼å·®å¼‚å·¨å¤§**ã€‚ æŒæ¡è¿™äº›åŒºåˆ«ï¼Œèƒ½é¿å… 80% çš„å­¦ä¹ å¼¯è·¯ã€‚

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸‰ç§åç«¯ä»“åº“çš„æœ¬è´¨åŒºåˆ«

### 1. åç«¯æ¡†æ¶ä»“åº“ï¼ˆBackend Frameworkï¼‰

**å…¸å‹ä¾‹å­**ï¼š`django/django`, `fastapi/fastapi`, `rails/rails`

**æœ¬è´¨**ï¼šæä¾›ç»™å¼€å‘è€…çš„ç¼–ç¨‹æ¨¡å‹å’Œå·¥å…·é›†

- ç›®æ ‡ç”¨æˆ·ï¼šåç«¯å¼€å‘è€…
- æ ¸å¿ƒèŒè´£ï¼šå®šä¹‰**å¦‚ä½•æ„å»º**åç«¯åº”ç”¨
- äº¤ä»˜ç‰©ï¼šæ¡†æ¶ä»£ç ã€æ–‡æ¡£ã€æœ€ä½³å®è·µ

**æ ¸å¿ƒæ¶æ„å±‚æ¬¡**ï¼š

```
HTTP å¤„ç†å±‚ â†’ è·¯ç”±ç³»ç»Ÿ â†’ ä¸­é—´ä»¶ â†’ ORM/æ•°æ®åº“æŠ½è±¡ â†’ è®¤è¯æˆæƒ
â†“
ä¸šåŠ¡å±‚ç”±ä½¿ç”¨è€…å®šä¹‰ï¼ˆä¸æ˜¯æ¡†æ¶çš„èŒè´£ï¼‰
```

### 2. ä¸šåŠ¡åç«¯æœåŠ¡ä»“åº“ï¼ˆBusiness Backend Serviceï¼‰

**å…¸å‹ä¾‹å­**ï¼šStripe APIï¼ˆæ”¯ä»˜ï¼‰ã€Airbnb è®¢å•ç³»ç»Ÿã€Netflix æ¨èå¼•æ“

**æœ¬è´¨**ï¼šçœŸå®è¿è¡Œçš„ä¸šåŠ¡åº”ç”¨ï¼Œè§£å†³å…·ä½“çš„å•†ä¸šé—®é¢˜

- ç›®æ ‡ç”¨æˆ·ï¼šå†…éƒ¨å›¢é˜Ÿ + å¤–éƒ¨ API æ¶ˆè´¹è€…
- æ ¸å¿ƒèŒè´£ï¼šå®ç°**å…·ä½“çš„ä¸šåŠ¡é€»è¾‘**
- äº¤ä»˜ç‰©ï¼šAPIã€å¯é æ€§ã€æ€§èƒ½

**æ ¸å¿ƒæ¶æ„å±‚æ¬¡**ï¼š

```
API å±‚ï¼ˆå¤–éƒ¨æ¥å£ï¼‰ â†’ åº”ç”¨å±‚ï¼ˆä¸šåŠ¡ç¼–æ’ï¼‰ â†’ é¢†åŸŸå±‚ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
â†“
åŸºç¡€è®¾æ–½å±‚ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
```

### 3. ä¸­é—´ä»¶/åº“ä»“åº“ï¼ˆMiddleware/Libraryï¼‰

**å…¸å‹ä¾‹å­**ï¼š`celery/celery`ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€`sqlalchemy/sqlalchemy`ï¼ˆORMï¼‰ã€`redis/redis`ï¼ˆç¼“å­˜ï¼‰

**æœ¬è´¨**ï¼šå¯å¤ç”¨çš„æŠ€æœ¯ç»„ä»¶ï¼Œè§£å†³é€šç”¨çš„æŠ€æœ¯é—®é¢˜

- ç›®æ ‡ç”¨æˆ·ï¼šå…¶ä»–å¼€å‘è€…/æ¡†æ¶å¼€å‘è€…
- æ ¸å¿ƒèŒè´£ï¼šæä¾›**ç‰¹å®šé¢†åŸŸçš„èƒ½åŠ›**ï¼ˆä»»åŠ¡è°ƒåº¦ã€æ•°æ®è®¿é—®ã€ç¼“å­˜ï¼‰
- äº¤ä»˜ç‰©ï¼šåº“ä»£ç ã€API æ–‡æ¡£ã€æ€§èƒ½æŒ‡æ ‡

**æ ¸å¿ƒæ¶æ„å±‚æ¬¡**ï¼š

```
å…¬å…± API â†’ æ ¸å¿ƒç®—æ³• â†’ é€‚é…å™¨å±‚ï¼ˆæ”¯æŒå¤šç§åç«¯ï¼‰
â†“
é©±åŠ¨å±‚ï¼ˆä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼‰
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šåç«¯æ¡†æ¶ä»“åº“çš„å­¦ä¹ ç­–ç•¥

### 1. å¿«é€Ÿè¯†åˆ«å…³é”®ç‰¹å¾

```bash
# æŸ¥çœ‹é¡¹ç›®ç»“æ„
tree -L 2 -I '__pycache__|*.egg-info' --dirsfirst

# é¢„æœŸçš„æ¡†æ¶ä»“åº“ç»“æ„
# django/
# â”œâ”€â”€ django/
# â”‚   â”œâ”€â”€ core/           # æ¡†æ¶æ ¸å¿ƒï¼ˆHTTPã€æ¨¡æ¿ã€ç¼“å­˜ï¼‰
# â”‚   â”œâ”€â”€ db/             # â­ ORM ç³»ç»Ÿï¼ˆæœ€å¤æ‚ï¼‰
# â”‚   â”‚   â”œâ”€â”€ models.py   # æ¨¡å‹å®šä¹‰
# â”‚   â”‚   â”œâ”€â”€ migrations/ # è¿ç§»ç³»ç»Ÿ
# â”‚   â”‚   â””â”€â”€ backends/   # æ•°æ®åº“é€‚é…å™¨ï¼ˆPostgreSQL, MySQL ç­‰ï¼‰
# â”‚   â”œâ”€â”€ http/           # HTTP å¤„ç†
# â”‚   â”œâ”€â”€ middleware/     # â­ ä¸­é—´ä»¶ç³»ç»Ÿ
# â”‚   â”œâ”€â”€ views/          # è§†å›¾å±‚ï¼ˆè¯·æ±‚å¤„ç†ï¼‰
# â”‚   â””â”€â”€ utils/
# â”œâ”€â”€ tests/              # â­ å¤§é‡çš„å•å…ƒå’Œé›†æˆæµ‹è¯•
# â”œâ”€â”€ docs/               # è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
# â””â”€â”€ examples/

# è¯†åˆ«ç‰¹å¾ï¼š
# 1. æœ‰å¤§é‡çš„ tests/ ç›®å½•ï¼ˆéªŒè¯æ¡†æ¶è¡Œä¸ºï¼‰
# 2. æœ‰ docs/ ç›®å½•ï¼ˆæ•™ç”¨æˆ·å¦‚ä½•ç”¨ï¼‰
# 3. æœ‰ examples/ ç›®å½•ï¼ˆå±•ç¤ºä½¿ç”¨æ¨¡å¼ï¼‰
# 4. æ ¸å¿ƒä»£ç ä¸­å……æ»¡äº†è£…é¥°å™¨ã€å…ƒç±»ã€hook ç‚¹
```

### 2. ã€å…³é”®æŠ€å·§ã€‘æ¡†æ¶çš„"æ‰©å±•ç‚¹"åœ°å›¾

```python
# ã€æœ€é‡è¦çš„è®¤è¯†ã€‘ï¼š
# æ¡†æ¶å°±æ˜¯ä¸€ä¸ª"éª¨æ¶"ï¼Œå…³é”®æ˜¯æ‰¾å‡ºæ‰€æœ‰çš„"æ‰©å±•ç‚¹"
# å¼€å‘è€…å¯ä»¥åœ¨è¿™äº›ç‚¹æ³¨å…¥è‡ªå·±çš„é€»è¾‘

# æ¡ˆä¾‹ï¼šDjango æ¡†æ¶çš„æ‰©å±•ç‚¹

# 1. ã€ä¸­é—´ä»¶ç³»ç»Ÿã€‘- åœ¨è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­æ’å…¥é€»è¾‘
# django/middleware.py

class MiddlewareBase:
    """æ‰€æœ‰ä¸­é—´ä»¶çš„åŸºç±»"""
    
    def process_request(self, request):
        """è¯·æ±‚å¤„ç†å‰"""
        # ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œï¼šè®¤è¯ã€æ—¥å¿—ã€é™æµ
        pass
    
    def process_view(self, request, view_func, view_args, view_kwargs):
        """è§†å›¾æ‰§è¡Œå‰"""
        pass
    
    def process_exception(self, request, exception):
        """å¼‚å¸¸å¤„ç†"""
        pass
    
    def process_response(self, request, response):
        """å“åº”å¤„ç†å"""
        # ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œï¼šæ·»åŠ å¤´ã€ä¿®æ”¹ body
        pass

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šå½“ä½ çœ‹åˆ°ä¸€ä¸ªæ¡†æ¶æ—¶ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š
# "æ¡†æ¶åœ¨å“ªäº›åœ°æ–¹å…è®¸æˆ‘æ³¨å…¥è‡ªå·±çš„ä»£ç ï¼Ÿ"
# è¿™äº›å°±æ˜¯å­¦ä¹ æ¡†æ¶çš„å…³é”®ç‚¹

# 2. ã€è£…é¥°å™¨ç³»ç»Ÿã€‘- å£°æ˜å¼çš„å…ƒæ•°æ®
# django/views.py

def login_required(view_func):
    """è£…é¥°å™¨ï¼šæ ‡è®°éœ€è¦ç™»å½•çš„è§†å›¾"""
    def wrapper(request, *args, **kwargs):
        if not request.user.is_authenticated:
            return redirect('login')
        return view_func(request, *args, **kwargs)
    return wrapper

@login_required
def protected_view(request):
    pass

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šè£…é¥°å™¨æ˜¯æ¡†æ¶çš„æ ¸å¿ƒè®¾è®¡æ¨¡å¼
# ç†è§£è£…é¥°å™¨å¦‚ä½•å·¥ä½œ = ç†è§£æ¡†æ¶å¦‚ä½•å·¥ä½œ

# 3. ã€ä¿¡å·ç³»ç»Ÿã€‘- äº‹ä»¶é©±åŠ¨çš„æ‰©å±•
# django/signals.py

from django.db.models.signals import post_save
from django.dispatch import receiver

@receiver(post_save, sender=User)
def user_created(sender, instance, created, **kwargs):
    """å½“ User ä¿å­˜æ—¶è‡ªåŠ¨è§¦å‘"""
    if created:
        send_welcome_email(instance)

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šä¿¡å·ç³»ç»Ÿè®©æ¡†æ¶å˜å¾—æ¾è€¦åˆå’Œå¯æ‰©å±•

# 4. ã€ç®¡ç†å™¨æ¨¡å¼ã€‘- å®šåˆ¶æŸ¥è¯¢é€»è¾‘
# django/db/models/manager.py

class CustomManager(models.Manager):
    def get_queryset(self):
        return super().get_queryset().filter(is_active=True)

class User(models.Model):
    objects = CustomManager()  # æ›¿æ¢é»˜è®¤ç®¡ç†å™¨

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šç®¡ç†å™¨è®©ä½ å®šåˆ¶æ•°æ®è®¿é—®çš„è¡Œä¸º
```

### 3. å­¦ä¹ æ¡†æ¶çš„æ­£ç¡®é¡ºåº

```
ç¬¬ä¸€æ­¥ï¼ˆ30 åˆ†é’Ÿï¼‰ï¼šç†è§£æ¡†æ¶è§£å†³çš„é—®é¢˜
â”œâ”€ æ¡†æ¶çš„å†å²èƒŒæ™¯
â”œâ”€ æ¡†æ¶çš„è®¾è®¡ç†å¿µï¼ˆä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿï¼‰
â””â”€ æ¡†æ¶çš„å¯¹æ ‡äº§å“å¯¹æ¯”

ç¬¬äºŒæ­¥ï¼ˆ1 å°æ—¶ï¼‰ï¼šå¿«é€Ÿä½¿ç”¨æ¡†æ¶
â”œâ”€ å®Œæˆå®˜æ–¹æ•™ç¨‹
â”œâ”€ æ„å»ºä¸€ä¸ªå®Œæ•´çš„å°åº”ç”¨
â””â”€ ç†è§£åŸºæœ¬æ¦‚å¿µï¼ˆæ¨¡å‹ã€è§†å›¾ã€URLï¼‰

ç¬¬ä¸‰æ­¥ï¼ˆ2 å°æ—¶ï¼‰ï¼šç†è§£æ¡†æ¶çš„æ ¸å¿ƒæŠ½è±¡
â”œâ”€ ã€ä¸­é—´ä»¶ç³»ç»Ÿã€‘å¦‚ä½•å·¥ä½œ
â”œâ”€ ã€ORMã€‘å¦‚ä½•å°† Python å¯¹è±¡æ˜ å°„åˆ°æ•°æ®åº“
â”œâ”€ ã€URL è·¯ç”±ã€‘å¦‚ä½•å°†è¯·æ±‚åˆ†å‘åˆ°è§†å›¾
â””â”€ ã€æ¨¡æ¿ç³»ç»Ÿã€‘å¦‚ä½•æ¸²æŸ“ HTML

ç¬¬å››æ­¥ï¼ˆ2 å°æ—¶ï¼‰ï¼šæ·±å…¥æ¡†æ¶çš„å®ç°ç»†èŠ‚
â”œâ”€ é€‰æ‹©ä¸€ä¸ªå…³é”®æ¨¡å—ï¼ˆå¦‚ ORMï¼‰
â”œâ”€ é˜…è¯»æºç ï¼Œç†è§£ç®—æ³•
â”œâ”€ é€šè¿‡æµ‹è¯•éªŒè¯ç†è§£
â””â”€ å†™ä¸€ä¸ªæ‰©å±•ï¼ˆè‡ªå®šä¹‰å­—æ®µç±»å‹ã€ç®¡ç†å™¨ç­‰ï¼‰

ç¬¬äº”æ­¥ï¼ˆå¯é€‰ï¼‰ï¼šä¸ºæ¡†æ¶è´¡çŒ®ä»£ç 
â”œâ”€ ä¿®å¤ bug
â”œâ”€ ä¼˜åŒ–æ€§èƒ½
â””â”€ æ·»åŠ æ–°ç‰¹æ€§
```

[[Next.js è¿›é˜¶å­¦ä¹ æŒ‡å—]]
### 4. ã€é«˜é˜¶æŠ€å·§ã€‘ORM ç³»ç»Ÿçš„æ·±åº¦ç†è§£

```python
# å¤§å¤šæ•° Web æ¡†æ¶çš„ ORMï¼ˆObject-Relational Mappingï¼‰æ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†
# ç†è§£ ORM = ç†è§£æ¡†æ¶çš„çµé­‚

# django/db/models/query.py (ç®€åŒ–ç‰ˆ)

class QuerySet:
    """
    è¿™æ˜¯ Django ORM æœ€æ ¸å¿ƒçš„ç±»
    ç†è§£è¿™ä¸ªç±»ï¼Œå°±ç†è§£äº†æ•´ä¸ª ORM
    """
    
    def __init__(self, model=None):
        self.model = model
        self._query = None  # è¿˜æ²¡æœ‰æ‰§è¡Œ SQL
    
    def filter(self, **kwargs):
        """
        å…³é”®æ´å¯Ÿï¼šè¿™é‡Œæ²¡æœ‰æ‰§è¡Œ SQLï¼
        åªæ˜¯æ„å»ºäº†ä¸€ä¸ªæŸ¥è¯¢å¯¹è±¡
        """
        clone = self._clone()
        clone._query.add_filter(kwargs)
        return clone  # è¿”å›æ–°çš„ QuerySet
    
    def exclude(self, **kwargs):
        """é“¾å¼è°ƒç”¨"""
        clone = self._clone()
        clone._query.add_exclude(kwargs)
        return clone
    
    def __iter__(self):
        """
        åªæœ‰åœ¨è¿­ä»£æ—¶ï¼ŒSQL æ‰ä¼šæ‰§è¡Œ
        è¿™å°±æ˜¯ ORM çš„"æƒ°æ€§æ±‚å€¼"ï¼ˆlazy evaluationï¼‰
        """
        if self._query is None:
            self._compile_sql()
        
        sql = self._query.as_sql()
        results = database.execute(sql)
        
        for row in results:
            yield self.model(**row)
    
    def count(self):
        """æ‰§è¡Œ COUNT SQL"""
        if self._query is None:
            self._compile_sql()
        
        sql = self._query.as_count_sql()
        return database.execute(sql)[0]['count']

# ã€é«˜é˜¶ç¤ºä¾‹ã€‘ï¼šORM æŸ¥è¯¢çš„æ€§èƒ½é™·é˜±

# âŒ N+1 æŸ¥è¯¢é—®é¢˜
users = User.objects.all()
for user in users:  # æ‰§è¡Œ 1 ä¸ªæŸ¥è¯¢
    print(user.posts)  # æ¯ä¸ª user æ‰§è¡Œ 1 ä¸ªæŸ¥è¯¢ï¼ˆN ä¸ªæŸ¥è¯¢ï¼‰
# æ€»å…±ï¼š1 + N ä¸ªæŸ¥è¯¢

# âœ… æ­£ç¡®çš„æ–¹å¼ï¼šé¢„åŠ è½½å…³è”æ•°æ®
users = User.objects.prefetch_related('posts')  # æ‰§è¡Œ 2 ä¸ªæŸ¥è¯¢
for user in users:
    print(user.posts)  # ä»å†…å­˜ä¸­è·å–ï¼Œä¸å†æ‰§è¡Œ SQL
# æ€»å…±ï¼š2 ä¸ªæŸ¥è¯¢

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šç†è§£ ORM çš„å…³é”®æ˜¯ç†è§£ï¼š
# 1. æŸ¥è¯¢çš„æ‡’åŠ è½½ï¼ˆlazy evaluationï¼‰
# 2. æŸ¥è¯¢çš„ç¼–è¯‘è¿‡ç¨‹ï¼ˆPython â†’ SQLï¼‰
# 3. å…³è”æ•°æ®çš„åŠ è½½ç­–ç•¥ï¼ˆN+1 é—®é¢˜ï¼‰
# 4. æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼ˆprefetch_related, select_relatedï¼‰
```

### 5. æ¡†æ¶å­¦ä¹ çš„éªŒè¯

```python
# scripts/understand_framework.py
# éªŒè¯ä½ æ˜¯å¦çœŸæ­£ç†è§£äº†æ¡†æ¶

class FrameworkUnderstandingTest:
    """æ¡†æ¶ç†è§£åº¦è‡ªæµ‹"""
    
    def test_1_routing(self):
        """ä½ ç†è§£äº†è·¯ç”±ç³»ç»Ÿå—ï¼Ÿ"""
        # èƒ½å¦å›ç­”è¿™äº›é—®é¢˜ï¼š
        # 1. å½“æˆ‘å®šä¹‰ @app.get("/users/{id}") æ—¶ï¼Œæ¡†æ¶å¦‚ä½•è§£æ {id}ï¼Ÿ
        # 2. å¦‚æœä¸¤ä¸ªè·¯ç”±å†²çªï¼ˆå¦‚ /users/{id} å’Œ /users/meï¼‰ï¼Œæ¡†æ¶å¦‚ä½•é€‰æ‹©ï¼Ÿ
        # 3. å¦‚ä½•åœ¨è·¯ç”±ä¸­æ·»åŠ å‰ç½®æ¡ä»¶ï¼ˆå¦‚æ£€æŸ¥æƒé™ï¼‰ï¼Ÿ
        pass
    
    def test_2_middleware(self):
        """ä½ ç†è§£äº†ä¸­é—´ä»¶ç³»ç»Ÿå—ï¼Ÿ"""
        # 1. ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ
        # 2. å¦‚ä½•åœ¨ä¸­é—´ä»¶ä¸­è®¿é—®è¯·æ±‚/å“åº”ï¼Ÿ
        # 3. å¦‚ä½•åœ¨ä¸­é—´ä»¶ä¸­ä¿®æ”¹è¯·æ±‚æˆ–å“åº”ï¼Ÿ
        # 4. ä¸ºä»€ä¹ˆéœ€è¦ä¸­é—´ä»¶è€Œä¸æ˜¯åœ¨è§†å›¾ä¸­å¤„ç†ï¼Ÿ
        pass
    
    def test_3_orm(self):
        """ä½ ç†è§£äº† ORM å—ï¼Ÿ"""
        # 1. å†™å‡ºä¸€ä¸ªæŸ¥è¯¢ï¼Œèƒ½ç»™å‡ºå¯¹åº”çš„ SQL
        # 2. è§£é‡Šä¸ºä»€ä¹ˆè¿™ä¸ªæŸ¥è¯¢æœ‰ N+1 é—®é¢˜
        # 3. å¦‚ä½•ä¼˜åŒ–è¿™ä¸ªæŸ¥è¯¢ï¼Ÿ
        # 4. ç†è§£ ORM çš„æ€§èƒ½è¾¹ç•Œ
        pass
    
    def test_4_extension(self):
        """ä½ èƒ½æ‰©å±•æ¡†æ¶å—ï¼Ÿ"""
        # 1. èƒ½å†™ä¸€ä¸ªè‡ªå®šä¹‰ä¸­é—´ä»¶å—ï¼Ÿ
        # 2. èƒ½å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰ç®¡ç†å™¨å—ï¼Ÿ
        # 3. èƒ½åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰è£…é¥°å™¨å—ï¼Ÿ
        # 4. èƒ½å®ç°ä¸€ä¸ªæ¡†æ¶çš„ hook å—ï¼Ÿ
        pass

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šèƒ½å›ç­”è¿™äº›é—®é¢˜ = çœŸæ­£ç†è§£äº†æ¡†æ¶
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸šåŠ¡åç«¯æœåŠ¡ä»“åº“çš„å­¦ä¹ ç­–ç•¥

### 1. å¿«é€Ÿè¯†åˆ«å…³é”®ç‰¹å¾

```bash
# é¢„æœŸçš„ä¸šåŠ¡åç«¯ç»“æ„
# backend-service/
# â”œâ”€â”€ src/
# â”‚   â”œâ”€â”€ api/              # â­ HTTP å…¥å£ï¼ˆå…³é”®ï¼‰
# â”‚   â”‚   â”œâ”€â”€ routes/
# â”‚   â”‚   â”œâ”€â”€ handlers/
# â”‚   â”‚   â””â”€â”€ schemas.py    # è¯·æ±‚/å“åº”æ¨¡å‹
# â”‚   â”œâ”€â”€ application/      # â­ ä¸šåŠ¡ç¼–æ’å±‚ï¼ˆå…³é”®ï¼‰
# â”‚   â”‚   â”œâ”€â”€ use_cases/
# â”‚   â”‚   â””â”€â”€ services.py
# â”‚   â”œâ”€â”€ domain/           # â­ ä¸šåŠ¡è§„åˆ™ï¼ˆæœ€å…³é”®ï¼‰
# â”‚   â”‚   â”œâ”€â”€ models/
# â”‚   â”‚   â”œâ”€â”€ values/
# â”‚   â”‚   â””â”€â”€ events.py
# â”‚   â”œâ”€â”€ infrastructure/   # æŠ€æœ¯ç»†èŠ‚
# â”‚   â”‚   â”œâ”€â”€ persistence/ (æ•°æ®åº“)
# â”‚   â”‚   â”œâ”€â”€ external/    (API è°ƒç”¨)
# â”‚   â”‚   â””â”€â”€ cache/
# â”‚   â”œâ”€â”€ config/
# â”‚   â””â”€â”€ utils/
# â”œâ”€â”€ tests/
# â”‚   â”œâ”€â”€ unit/             # å•å…ƒæµ‹è¯•ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
# â”‚   â”œâ”€â”€ integration/      # é›†æˆæµ‹è¯•ï¼ˆæœåŠ¡é—´è°ƒç”¨ï¼‰
# â”‚   â””â”€â”€ e2e/              # ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆå®Œæ•´æµç¨‹ï¼‰
# â”œâ”€â”€ migrations/           # æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
# â”œâ”€â”€ deployment/           # éƒ¨ç½²é…ç½®
# â”œâ”€â”€ docs/
# â””â”€â”€ README.md

# è¯†åˆ«ç‰¹å¾ï¼š
# 1. æœ‰æ¸…æ™°çš„å±‚çº§åˆ’åˆ†ï¼ˆAPI â†’ Application â†’ Domainï¼‰
# 2. æœ‰å¤§é‡çš„ tests/ ç›®å½•ï¼ˆéªŒè¯ä¸šåŠ¡é€»è¾‘ï¼‰
# 3. æœ‰ migrations/ ç›®å½•ï¼ˆç‰ˆæœ¬åŒ–æ•°æ®åº“ï¼‰
# 4. æœ‰ deployment/ ç›®å½•ï¼ˆDockerã€K8s é…ç½®ï¼‰
# 5. README ä¸­æœ‰ç³»ç»Ÿæ¶æ„å›¾å’Œä¸šåŠ¡æµç¨‹å›¾
```

### 2. ã€å…³é”®æŠ€å·§ã€‘ä»æ•°æ®æµè¿½è¸ªç†è§£ä¸šåŠ¡

```python
# è¿™æ˜¯ä¸šåŠ¡æœåŠ¡å­¦ä¹ çš„æ ¸å¿ƒæŠ€å·§
# é€‰æ‹©ä¸€ä¸ªå…³é”®ä¸šåŠ¡æµç¨‹ï¼Œä»å¤´åˆ°å°¾è¿½è¸ª

# æ¡ˆä¾‹ï¼šæ”¯ä»˜æœåŠ¡çš„"åˆ›å»ºè®¢å•å¹¶æ”¯ä»˜"æµç¨‹

# ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ° API å…¥å£
# src/api/routes/orders.py

@router.post("/orders")
async def create_order(
    request: CreateOrderRequest,
    db: Session = Depends(get_db),
    current_user: User = Depends(get_current_user)
):
    """
    HTTP è¯·æ±‚å…¥å£ç‚¹
    
    æ”¶åˆ°è¯·æ±‚ï¼š
    {
        "items": [{"product_id": 1, "quantity": 2}],
        "payment_method": "credit_card"
    }
    """
    # ã€è¿½è¸ªç‚¹ 1ã€‘ï¼šä¸šåŠ¡é€»è¾‘çš„å¼€å§‹
    order_service = OrderService(db)
    order = await order_service.create_order(
        user_id=current_user.id,
        items=request.items
    )
    
    return {"order_id": order.id, "total": order.total_price}

# ç¬¬äºŒæ­¥ï¼šè¿½è¸ªåˆ°åº”ç”¨å±‚ï¼ˆä¸šåŠ¡ç¼–æ’ï¼‰
# src/application/services/order_service.py

class OrderService:
    """è®¢å•åº”ç”¨æœåŠ¡ï¼šç¼–æ’å„ä¸ªä¸šåŠ¡æ“ä½œ"""
    
    def __init__(self, db: Session):
        self.db = db
        self.inventory_repo = InventoryRepository(db)
        self.order_repo = OrderRepository(db)
        self.pricing_service = PricingService()
        self.payment_service = PaymentService()
    
    async def create_order(self, user_id: int, items: List[OrderItem]):
        """
        ã€å…³é”®æ­¥éª¤ã€‘ï¼šçœ‹è¿™ä¸ªå‡½æ•°ï¼Œä½ èƒ½ç†è§£æ•´ä¸ªä¸šåŠ¡æµç¨‹
        """
        # ç¬¬ä¸€ä¸ªå…³é”®ç‚¹ï¼šéªŒè¯åº“å­˜ï¼ˆé¢†åŸŸé€»è¾‘ï¼‰
        for item in items:
            availability = self.inventory_repo.check_stock(
                item.product_id,
                item.quantity
            )
            if not availability.is_available:
                raise OutOfStockError(item.product_id)
        
        # ç¬¬äºŒä¸ªå…³é”®ç‚¹ï¼šè®¡ç®—ä»·æ ¼ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
        pricing_info = self.pricing_service.calculate_price(
            items,
            user_id  # å¯èƒ½æœ‰ç”¨æˆ·æŠ˜æ‰£
        )
        
        # ç¬¬ä¸‰ä¸ªå…³é”®ç‚¹ï¼šåˆ›å»ºè®¢å•ï¼ˆé¢†åŸŸæ“ä½œï¼‰
        order = Order.create(
            user_id=user_id,
            items=items,
            total_price=pricing_info.total,
            status=OrderStatus.PENDING
        )
        
        # ç¬¬å››ä¸ªå…³é”®ç‚¹ï¼šä¿å­˜åˆ°æ•°æ®åº“ï¼ˆåŸºç¡€è®¾æ–½ï¼‰
        saved_order = self.order_repo.save(order)
        
        # ç¬¬äº”ä¸ªå…³é”®ç‚¹ï¼šå‘èµ·æ”¯ä»˜ï¼ˆå¤–éƒ¨æœåŠ¡è°ƒç”¨ï¼‰
        try:
            payment_result = await self.payment_service.charge(
                user_id=user_id,
                amount=pricing_info.total,
                order_id=saved_order.id
            )
        except PaymentError as e:
            # æ”¯ä»˜å¤±è´¥ï¼šæ ‡è®°è®¢å•ä¸ºå¤±è´¥
            self.order_repo.update_status(saved_order.id, OrderStatus.FAILED)
            raise
        
        # ç¬¬å…­ä¸ªå…³é”®ç‚¹ï¼šæˆåŠŸåçš„ä¸šåŠ¡æ“ä½œ
        if payment_result.success:
            # é¢„ç•™åº“å­˜
            self.inventory_repo.reserve_stock(
                items,
                saved_order.id
            )
            
            # æ›´æ–°è®¢å•çŠ¶æ€
            self.order_repo.update_status(saved_order.id, OrderStatus.CONFIRMED)
            
            # ã€å¼‚æ­¥æ“ä½œã€‘å‘é€ç¡®è®¤é‚®ä»¶ï¼ˆä¸è¦åœ¨è¯·æ±‚ä¸­é˜»å¡ï¼‰
            send_order_confirmation_email.delay(saved_order.id)
            
            # ã€å‘é€é¢†åŸŸäº‹ä»¶ã€‘é€šçŸ¥å…¶ä»–ç³»ç»Ÿ
            OrderCreatedEvent(saved_order.id).publish()
        
        return saved_order

# ç¬¬ä¸‰æ­¥ï¼šè¿½è¸ªåˆ°é¢†åŸŸå±‚ï¼ˆä¸šåŠ¡è§„åˆ™ï¼‰
# src/domain/models/order.py

class Order:
    """
    è®¢å•é¢†åŸŸæ¨¡å‹
    åŒ…å«äº†ä¸šåŠ¡è§„åˆ™å’Œä¸å˜é‡
    """
    
    def __init__(
        self,
        id: str,
        user_id: int,
        items: List['OrderItem'],
        total_price: Money,
        status: OrderStatus,
        created_at: datetime
    ):
        # ã€ä¸šåŠ¡è§„åˆ™ 1ã€‘ï¼šè®¢å•å¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªé¡¹ç›®
        if not items:
            raise OrderMustHaveItemsError()
        
        # ã€ä¸šåŠ¡è§„åˆ™ 2ã€‘ï¼šæ€»ä»·ä¸èƒ½ä¸ºè´Ÿ
        if total_price.amount < 0:
            raise InvalidPriceError()
        
        # ã€ä¸šåŠ¡è§„åˆ™ 3ã€‘ï¼šåªæœ‰å¾…ç¡®è®¤çš„è®¢å•æ‰èƒ½æ”¯ä»˜
        if status != OrderStatus.PENDING:
            raise OrderAlreadyProcessedError()
        
        self.id = id
        self.user_id = user_id
        self.items = items
        self.total_price = total_price
        self.status = status
        self.created_at = created_at
    
    @staticmethod
    def create(user_id: int, items: List[OrderItem], total_price: Money):
        """å·¥å‚æ–¹æ³•ï¼šåˆ›å»ºæ–°è®¢å•"""
        return Order(
            id=uuid.uuid4(),
            user_id=user_id,
            items=items,
            total_price=total_price,
            status=OrderStatus.PENDING,
            created_at=datetime.now()
        )
    
    def confirm(self):
        """ä¸šåŠ¡æ“ä½œï¼šç¡®è®¤è®¢å•"""
        if self.status != OrderStatus.PENDING:
            raise InvalidStateTransitionError()
        
        self.status = OrderStatus.CONFIRMED
    
    def cancel(self):
        """ä¸šåŠ¡æ“ä½œï¼šå–æ¶ˆè®¢å•"""
        allowed_statuses = [OrderStatus.PENDING, OrderStatus.CONFIRMED]
        if self.status not in allowed_statuses:
            raise CannotCancelOrderError(self.status)
        
        self.status = OrderStatus.CANCELLED

# ç¬¬å››æ­¥ï¼šè¿½è¸ªåˆ°åŸºç¡€è®¾æ–½å±‚ï¼ˆæŠ€æœ¯ç»†èŠ‚ï¼‰
# src/infrastructure/persistence/order_repository.py

class OrderRepository:
    """è®¢å•æŒä¹…åŒ–ï¼šå¦‚ä½•ä¿å­˜å’Œè¯»å–è®¢å•"""
    
    def __init__(self, db: Session):
        self.db = db
    
    def save(self, order: Order) -> Order:
        """ä¿å­˜è®¢å•åˆ°æ•°æ®åº“"""
        # å°†é¢†åŸŸæ¨¡å‹è½¬æ¢ä¸ºæ•°æ®åº“æ¨¡å‹
        order_record = OrderRecord(
            id=order.id,
            user_id=order.user_id,
            total_price=order.total_price.amount,
            currency=order.total_price.currency,
            status=order.status.value,
            created_at=order.created_at
        )
        
        self.db.add(order_record)
        
        # ä¿å­˜è®¢å•é¡¹
        for item in order.items:
            item_record = OrderItemRecord(
                order_id=order.id,
                product_id=item.product_id,
                quantity=item.quantity,
                price=item.price.amount
            )
            self.db.add(item_record)
        
        self.db.commit()
        return order

# ã€é€šè¿‡è¿™ä¸ªå®Œæ•´çš„è¿½è¸ªè¿‡ç¨‹ï¼Œä½ å­¦åˆ°äº†ã€‘ï¼š
# 1. API å±‚ï¼šå¦‚ä½•æ¥æ”¶å’ŒéªŒè¯è¯·æ±‚
# 2. åº”ç”¨å±‚ï¼šå¦‚ä½•ç¼–æ’ä¸šåŠ¡æ“ä½œï¼Œè°ƒåº¦å„ä¸ªæœåŠ¡
# 3. é¢†åŸŸå±‚ï¼šä¸šåŠ¡è§„åˆ™å’Œä¸å˜é‡æ˜¯ä»€ä¹ˆ
# 4. åŸºç¡€è®¾æ–½å±‚ï¼šå¦‚ä½•å°†ä¸šåŠ¡æ¨¡å‹æŒä¹…åŒ–
# 5. é”™è¯¯å¤„ç†ï¼šåœ¨å“ªäº›å±‚å¤„ç†ä»€ä¹ˆé”™è¯¯
# 6. å¼‚æ­¥å¤„ç†ï¼šå“ªäº›æ“ä½œåº”è¯¥å¼‚æ­¥
# 7. äº‹ä»¶é©±åŠ¨ï¼šç³»ç»Ÿå¦‚ä½•é€šè¿‡äº‹ä»¶é€šä¿¡
```

### 3. ã€é«˜é˜¶æŠ€å·§ã€‘é€šè¿‡æ•°æ®åº“ Schema åæ¨ä¸šåŠ¡

```python
# scripts/analyze_database_schema.py
# ä»æ•°æ®åº“è®¾è®¡åæ¨ä¸šåŠ¡è§„åˆ™

import sqlparse

def analyze_schema(sql_migration_file):
    """
    åˆ†ææ•°æ®åº“ schema æ¥ç†è§£ä¸šåŠ¡
    """
    
    with open(sql_migration_file) as f:
        schema = sqlparse.parse(f.read())
    
    insights = {
        'entities': [],
        'relationships': [],
        'business_rules': [],
        'performance_hints': []
    }
    
    for statement in schema:
        if 'CREATE TABLE' in str(statement):
            # ã€æ´å¯Ÿ 1ã€‘ï¼šè¡¨çš„ç»“æ„åæ˜ äº†æ•°æ®æ¨¡å‹
            # CREATE TABLE orders (
            #     id UUID PRIMARY KEY,
            #     user_id BIGINT NOT NULL,  â† å¿…é¡»æœ‰ç”¨æˆ·
            #     status VARCHAR(20) NOT NULL,  â† è®¢å•å¿…é¡»æœ‰çŠ¶æ€
            #     total_price DECIMAL(10,2) NOT NULL,  â† ä»·æ ¼å¿…é¡»æœ‰
            #     created_at TIMESTAMP NOT NULL,
            #     FOREIGN KEY (user_id) REFERENCES users(id)
            # );
            # è¿™å‘Šè¯‰ä½ ï¼šè®¢å•æ˜¯æ ¸å¿ƒä¸šåŠ¡å®ä½“
            
            insights['entities'].append(parse_table_name(statement))
            
            # ã€æ´å¯Ÿ 2ã€‘ï¼šçº¦æŸåæ˜ äº†ä¸šåŠ¡è§„åˆ™
            constraints = extract_constraints(statement)
            for constraint in constraints:
                if constraint.type == 'NOT NULL':
                    # è¿™ä¸ªå­—æ®µæ˜¯å¼ºåˆ¶æ€§çš„ â†’ ä¸šåŠ¡è§„åˆ™
                    insights['business_rules'].append(
                        f"{constraint.column} is required"
                    )
                elif constraint.type == 'UNIQUE':
                    # è¿™ä¸ªå­—æ®µå¿…é¡»å”¯ä¸€ â†’ ä¸šåŠ¡è§„åˆ™
                    insights['business_rules'].append(
                        f"{constraint.column} must be unique"
                    )
            
            # ã€æ´å¯Ÿ 3ã€‘ï¼šç´¢å¼•åæ˜ äº†è®¿é—®æ¨¡å¼
            indexes = extract_indexes(statement)
            for idx in indexes:
                # ç´¢å¼•å‘Šè¯‰ä½ è¿™ä¸ªæŸ¥è¯¢å¾ˆå¸¸è§
                insights['performance_hints'].append(
                    f"Frequent query: {idx.columns}"
                )
        
        elif 'FOREIGN KEY' in str(statement):
            # ã€æ´å¯Ÿ 4ã€‘ï¼šå¤–é”®åæ˜ äº†å®ä½“é—´çš„å…³ç³»
            insights['relationships'].append(parse_foreign_key(statement))
    
    return insights

# ã€ç¤ºä¾‹è¾“å‡ºã€‘
# ä»è¿™ä¸ª schemaï¼Œä½ èƒ½æ¨æ–­ï¼š
# 1. æ ¸å¿ƒå®ä½“ï¼šOrder, OrderItem, Customer
# 2. å…³é”®å…³ç³»ï¼šOrder belongs_to Customer, has_many OrderItem
# 3. ä¸šåŠ¡è§„åˆ™ï¼š
#    - è®¢å•å¿…é¡»æœ‰ user_idï¼ˆç”¨æˆ·ï¼‰
#    - è®¢å•å¿…é¡»æœ‰ statusï¼ˆç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
#    - OrderItem çš„ä»·æ ¼å¿…é¡»æ˜¯æ­£æ•°ï¼ˆè´¢åŠ¡è§„åˆ™ï¼‰
# 4. æ€§èƒ½ç‰¹ç‚¹ï¼š
#    - ç»å¸¸æŒ‰ user_id å’Œ created_at æŸ¥è¯¢è®¢å•
#    - ç»å¸¸æŒ‰ order_id æŸ¥è¯¢è®¢å•é¡¹
```

### 4. ä¸šåŠ¡æœåŠ¡çš„å­¦ä¹ éªŒè¯

```python
# éªŒè¯ä½ æ˜¯å¦çœŸæ­£ç†è§£äº†ä¸šåŠ¡æœåŠ¡

class BusinessServiceUnderstandingTest:
    """ä¸šåŠ¡æœåŠ¡ç†è§£åº¦è‡ªæµ‹"""
    
    def test_1_business_flow(self):
        """ä½ ç†è§£äº†æ ¸å¿ƒä¸šåŠ¡æµç¨‹å—ï¼Ÿ"""
        # 1. èƒ½ç”»å‡º API â†’ Application â†’ Domain â†’ Infrastructure çš„æµç¨‹å›¾å—ï¼Ÿ
        # 2. èƒ½è§£é‡Šä¸ºä»€ä¹ˆè¦åˆ†è¿™ä¹ˆå¤šå±‚ï¼Ÿ
        # 3. èƒ½æŒ‡å‡ºæ¯ä¸€å±‚çš„èŒè´£å—ï¼Ÿ
        pass
    
    def test_2_domain_logic(self):
        """ä½ ç†è§£äº†é¢†åŸŸé€»è¾‘å—ï¼Ÿ"""
        # 1. ä¸šåŠ¡çš„æ ¸å¿ƒä¸å˜é‡æ˜¯ä»€ä¹ˆï¼Ÿ
        # 2. å“ªäº›æ“ä½œæ˜¯åŸå­çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ
        # 3. å“ªäº›æ“ä½œå¿…é¡»åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œï¼Ÿ
        pass
    
    def test_3_error_handling(self):
        """ä½ ç†è§£äº†é”™è¯¯å¤„ç†ç­–ç•¥å—ï¼Ÿ"""
        # 1. ä»€ä¹ˆæ—¶å€™åº”è¯¥è¿”å› 4xxï¼ˆå®¢æˆ·ç«¯é”™è¯¯ï¼‰ï¼Ÿ
        # 2. ä»€ä¹ˆæ—¶å€™åº”è¯¥è¿”å› 5xxï¼ˆæœåŠ¡ç«¯é”™è¯¯ï¼‰ï¼Ÿ
        # 3. ä»€ä¹ˆæ—¶å€™åº”è¯¥é‡è¯•ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ï¼Ÿ
        pass
    
    def test_4_data_consistency(self):
        """ä½ ç†è§£äº†æ•°æ®ä¸€è‡´æ€§ç­–ç•¥å—ï¼Ÿ"""
        # 1. ç³»ç»Ÿä½¿ç”¨ä»€ä¹ˆçº§åˆ«çš„ä¸€è‡´æ€§ä¿è¯ï¼Ÿï¼ˆå¼ºä¸€è‡´ vs æœ€ç»ˆä¸€è‡´ï¼‰
        # 2. ä»€ä¹ˆæ—¶å€™éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ
        # 3. å¦‚ä½•å¤„ç† saga æ¨¡å¼ï¼ˆåˆ†å¸ƒå¼é•¿äº‹åŠ¡ï¼‰ï¼Ÿ
        pass
    
    def test_5_async_handling(self):
        """ä½ ç†è§£äº†å¼‚æ­¥å¤„ç†å—ï¼Ÿ"""
        # 1. å“ªäº›æ“ä½œæ˜¯åŒæ­¥çš„ï¼Œå“ªäº›æ˜¯å¼‚æ­¥çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ
        # 2. å¦‚ä½•å¤„ç†å¼‚æ­¥æ“ä½œçš„å¤±è´¥ï¼Ÿ
        # 3. æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯é¡ºåºé‡è¦å—ï¼Ÿ
        pass

# èƒ½å›ç­”è¿™äº›é—®é¢˜ = ç†è§£äº†ä¸šåŠ¡é€»è¾‘æœ¬è´¨
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šä¸­é—´ä»¶/åº“ä»“åº“çš„å­¦ä¹ ç­–ç•¥

### 1. å¿«é€Ÿè¯†åˆ«å…³é”®ç‰¹å¾

```bash
# é¢„æœŸçš„åº“ä»“åº“ç»“æ„
# celery/
# â”œâ”€â”€ celery/
# â”‚   â”œâ”€â”€ app.py           # â­ æ ¸å¿ƒ App ç±»ï¼ˆå…³é”®ï¼‰
# â”‚   â”œâ”€â”€ worker/          # â­ Worker å®ç°ï¼ˆå…³é”®ï¼‰
# â”‚   â”œâ”€â”€ task/            # Task æŠ½è±¡ï¼ˆå…³é”®ï¼‰
# â”‚   â”œâ”€â”€ backends/        # ä¸åŒçš„ Message Broker é€‚é…å™¨
# â”‚   â”‚   â”œâ”€â”€ redis.py
# â”‚   â”‚   â”œâ”€â”€ amqp.py
# â”‚   â”‚   â””â”€â”€ memory.py
# â”‚   â”œâ”€â”€ result/          # ç»“æœå­˜å‚¨é€‚é…å™¨
# â”‚   â”‚   â”œâ”€â”€ redis.py
# â”‚   â”‚   â”œâ”€â”€ db.py
# â”‚   â”‚   â””â”€â”€ cache.py
# â”‚   â”œâ”€â”€ concurrency/     # å¹¶å‘æ¨¡å‹
# â”‚   â”‚   â”œâ”€â”€ solo.py
# â”‚   â”‚   â”œâ”€â”€ thread.py
# â”‚   â”‚   â””â”€â”€ prefork.py
# â”‚   â””â”€â”€ utils/
# â”œâ”€â”€ tests/
# â”‚   â”œâ”€â”€ unit/            # å•å…ƒæµ‹è¯•ï¼ˆéš”ç¦»æµ‹è¯•æ¯ä¸ªç»„ä»¶ï¼‰
# â”‚   â”œâ”€â”€ integration/     # é›†æˆæµ‹è¯•ï¼ˆæµ‹è¯•ä¸ Redisã€RabbitMQ çš„é›†æˆï¼‰
# â”‚   â””â”€â”€ stress/          # å‹åŠ›æµ‹è¯•ï¼ˆæ€§èƒ½å’Œå¯é æ€§ï¼‰
# â”œâ”€â”€ docs/
# â””â”€â”€ benchmarks/          # â­ æ€§èƒ½åŸºå‡†æµ‹è¯•

# è¯†åˆ«ç‰¹å¾ï¼š
# 1. æœ‰å¤§é‡çš„ backends/ï¼ˆå¤šç§å®ç°çš„æ”¯æŒï¼‰
# 2. æœ‰ tests/ ç›®å½•ï¼ˆç‰¹åˆ«æ˜¯ integration å’Œ stress æµ‹è¯•ï¼‰
# 3. æœ‰ benchmarks/ï¼ˆæ€§èƒ½æ˜¯å…³é”®ï¼‰
# 4. æ ¸å¿ƒä»£ç éå¸¸ç²¾ç®€ï¼Œå¤§éƒ¨åˆ†é€»è¾‘æ˜¯é€‚é…å™¨
# 5. README ä¸­æœ‰æ€§èƒ½æ•°æ®å’Œå¯¹æ ‡å¯¹æ¯”
```

### 2. ã€å…³é”®æŠ€å·§ã€‘åº“çš„"å¤šå®ç°"æ¶æ„

```python
# åº“ä»“åº“çš„æ ¸å¿ƒæ¶æ„ç‰¹ç‚¹æ˜¯"å¤šå®ç°"
# åŒä¸€ä¸ªæ¥å£ï¼Œå¤šä¸ªå®ç°ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©

# æ¡ˆä¾‹ï¼šCelery çš„ Message Broker è®¾è®¡

# ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æŠ½è±¡æ¥å£
# celery/kombu/abstract_broker.py

class AbstractBroker(ABC):
    """æ‰€æœ‰ Broker å®ç°çš„æ¥å£"""
    
    @abstractmethod
    def put(self, queue: str, message: dict, priority: int = 0):
        """
        å°†æ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—
        
        å‚æ•°ï¼š
        - queue: é˜Ÿåˆ—åç§°
        - message: æ¶ˆæ¯å†…å®¹ï¼ˆJSON åºåˆ—åŒ–ï¼‰
        - priority: ä¼˜å…ˆçº§
        """
        pass
    
    @abstractmethod
    def get(self, queue: str, timeout: float = None) -> dict:
        """ä»é˜Ÿåˆ—è·å–æ¶ˆæ¯"""
        pass
    
    @abstractmethod
    def delete(self, queue: str):
        """åˆ é™¤é˜Ÿåˆ—"""
        pass
    
    @abstractmethod
    def purge(self, queue: str):
        """æ¸…ç©ºé˜Ÿåˆ—ï¼ˆå±é™©æ“ä½œï¼‰"""
        pass
    
    # ã€å…³é”®ç‰¹æ€§ã€‘ï¼šè¿™äº›æ˜¯åº“å¿…é¡»æä¾›çš„ä¿è¯
    def __init__(self):
        self.max_retries = 3
        self.retry_delay = 1.0  # ç§’
        self.heartbeat_interval = 2.0  # ç§’

# ç¬¬äºŒæ­¥ï¼šå®ç° Redis ç‰ˆæœ¬
# celery/kombu/transport/redis.py

class RedisBroker(AbstractBroker):
    """
    ä½¿ç”¨ Redis ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„ Broker
    
    ç‰¹ç‚¹ï¼š
    - å¿«é€Ÿï¼ˆå†…å­˜ï¼‰
    - ç®€å•ï¼ˆå•æœºï¼‰
    - é€‚åˆï¼šå°åˆ°ä¸­å‹ç³»ç»Ÿ
    """
    
    def __init__(self, connection_string: str):
        super().__init__()
        self.redis = redis.from_url(connection_string)
    
    def put(self, queue: str, message: dict, priority: int = 0):
        """ä½¿ç”¨ Redis çš„æœ‰åºé›†åˆå®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—"""
        # å°†æ¶ˆæ¯åºåˆ—åŒ–ä¸º JSON
        serialized = json.dumps(message)
        
        if priority > 0:
            # ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼šä½¿ç”¨åˆ†æ•°ï¼ˆscoreï¼‰æ§åˆ¶é¡ºåº
            self.redis.zadd(f"queue:{queue}", {serialized: -priority})
        else:
            # æ™®é€šé˜Ÿåˆ—ï¼šFIFO
            self.redis.rpush(f"queue:{queue}", serialized)
    
    def get(self, queue: str, timeout: float = None):
        """ä» Redis è·å–æ¶ˆæ¯"""
        # ã€é«˜çº§ç‰¹æ€§ã€‘ï¼šæ”¯æŒè¶…æ—¶å’Œé˜»å¡æ“ä½œ
        if timeout:
            # é˜»å¡è·å–ï¼ˆé¿å…ç¹å¿™ç­‰å¾…ï¼‰
            result = self.redis.blpop(f"queue:{queue}", timeout=int(timeout))
        else:
            result = self.redis.lpop(f"queue:{queue}")
        
        if result:
            return json.loads(result)
        return None

# ç¬¬ä¸‰æ­¥ï¼šå®ç° RabbitMQ ç‰ˆæœ¬
# celery/kombu/transport/amqp.py

class RabbitMQBroker(AbstractBroker):
    """
    ä½¿ç”¨ RabbitMQ ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„ Broker
    
    ç‰¹ç‚¹ï¼š
    - å¯é ï¼ˆæ”¯æŒæŒä¹…åŒ–å’Œäº‹åŠ¡ï¼‰
    - å¤æ‚ï¼ˆåˆ†å¸ƒå¼ç‰¹æ€§ï¼‰
    - é€‚åˆï¼šå¤§å‹ç³»ç»Ÿï¼Œéœ€è¦é«˜å¯é æ€§
    """
    
    def __init__(self, connection_string: str):
        super().__init__()
        self.connection = amqp.Connection(connection_string)
        self.channel = self.connection.channel()
    
    def put(self, queue: str, message: dict, priority: int = 0):
        """å°†æ¶ˆæ¯å‘é€åˆ° RabbitMQ"""
        # å£°æ˜é˜Ÿåˆ—ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
        self.channel.queue_declare(
            queue=queue,
            durable=True,  # é˜Ÿåˆ—æŒä¹…åŒ–
            arguments={'x-max-priority': 10}  # æ”¯æŒä¼˜å…ˆçº§
        )
        
        # å‘é€æ¶ˆæ¯
        self.channel.basic_publish(
            exchange='',
            routing_key=queue,
            body=json.dumps(message),
            properties=amqp.BasicProperties(
                delivery_mode=2,  # æŒä¹…åŒ–æ¶ˆæ¯
                priority=priority
            )
        )
    
    def get(self, queue: str, timeout: float = None):
        """ä» RabbitMQ è·å–æ¶ˆæ¯"""
        # å£°æ˜é˜Ÿåˆ—
        self.channel.queue_declare(queue=queue, durable=True)
        
        # è·å–æ¶ˆæ¯
        method, properties, body = self.channel.basic_get(queue)
        
        if method:
            # ç¡®è®¤æ¶ˆæ¯ï¼ˆå‘Šè¯‰ RabbitMQ å·²å¤„ç†ï¼‰
            self.channel.basic_ack(method.delivery_tag)
            return json.loads(body)
        return None

# ç¬¬å››æ­¥ï¼šç”¨æˆ·ä½¿ç”¨åº“æ—¶ï¼Œé€‰æ‹©åˆé€‚çš„å®ç°
# user_code.py

# æ–¹å¼ 1ï¼šä½¿ç”¨ Redisï¼ˆå¿«é€Ÿï¼Œç®€å•ï¼‰
broker = RedisBroker("redis://localhost:6379")

# æ–¹å¼ 2ï¼šä½¿ç”¨ RabbitMQï¼ˆå¯é ï¼Œå¤æ‚ï¼‰
broker = RabbitMQBroker("amqp://localhost:5672")

# ç”¨æˆ·ä»£ç ä¸éœ€è¦æ”¹å˜ï¼
broker.put("tasks", {"task": "send_email", "user_id": 123})
message = broker.get("tasks")

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šè¿™å°±æ˜¯åº“çš„æ ¸å¿ƒä»·å€¼ï¼š
# 1. å®šä¹‰æ¸…æ™°çš„æŠ½è±¡æ¥å£
# 2. æä¾›å¤šä¸ªå®ç°ï¼ˆæ”¯æŒä¸åŒçš„åç«¯ï¼‰
# 3. ç”¨æˆ·é€‰æ‹©åˆé€‚çš„å®ç°ï¼Œä»£ç ä¸éœ€è¦æ”¹å˜

# ã€å­¦ä¹ åº“çš„å…³é”®ã€‘ï¼š
# 1. ç†è§£æŠ½è±¡æ¥å£ï¼ˆAbstractBrokerï¼‰
# 2. ç†è§£ä¸åŒå®ç°çš„æƒè¡¡ï¼ˆRedis vs RabbitMQï¼‰
# 3. ç†è§£æ€§èƒ½ç‰¹å¾ï¼ˆå“ªä¸ªæ›´å¿«ï¼Ÿå“ªä¸ªæ›´å¯é ï¼Ÿï¼‰
# 4. ç†è§£ä½•æ—¶ä½¿ç”¨å“ªä¸ªå®ç°
```

### 3. ã€é«˜é˜¶æŠ€å·§ã€‘åº“çš„æ€§èƒ½ä¼˜åŒ–ç‚¹

```python
# scripts/benchmark_library.py
# åº“çš„æ ¸å¿ƒå…³æ³¨ç‚¹ï¼šæ€§èƒ½

import time
import memory_profiler
from celery import Celery

class LibraryBenchmark:
    """åº“çš„æ€§èƒ½åŸºå‡†æµ‹è¯•"""
    
    def bench_redis_broker(self):
        """Redis Broker çš„æ€§èƒ½"""
        broker = RedisBroker("redis://localhost:6379")
        
        # ã€æŒ‡æ ‡ 1ã€‘ï¼šååé‡ï¼ˆThroughputï¼‰
        # å•ä½æ—¶é—´å†…èƒ½å¤„ç†å¤šå°‘æ¶ˆæ¯ï¼Ÿ
        start = time.time()
        for i in range(10000):
            broker.put("benchmark", {"msg": f"test_{i}"})
        elapsed = time.time() - start
        throughput = 10000 / elapsed
        print(f"Redis put throughput: {throughput:.0f} ops/sec")
        
        # ã€æŒ‡æ ‡ 2ã€‘ï¼šå»¶è¿Ÿï¼ˆLatencyï¼‰
        # å•ä¸ªæ“ä½œéœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ
        latencies = []
        for i in range(1000):
            start = time.perf_counter()
            broker.put("benchmark", {"msg": "test"})
            elapsed = time.perf_counter() - start
            latencies.append(elapsed)
        
        latencies.sort()
        print(f"Redis put latency P50: {latencies[500]*1000:.2f}ms")
        print(f"Redis put latency P99: {latencies[990]*1000:.2f}ms")
        print(f"Redis put latency P99.9: {latencies[999]*1000:.2f}ms")
        
        # ã€æŒ‡æ ‡ 3ã€‘ï¼šå†…å­˜å ç”¨
        # é˜Ÿåˆ—æœ‰å¤šå°‘æ¡æ¶ˆæ¯æ—¶ï¼Œå†…å­˜å ç”¨å¤šå°‘ï¼Ÿ
        for i in range(10000):
            broker.put("memory_test", {"data": "x" * 1000})
        
        memory = broker.redis.info()['used_memory_human']
        print(f"Redis memory for 10k messages: {memory}")
    
    def bench_rabbitmq_broker(self):
        """RabbitMQ Broker çš„æ€§èƒ½"""
        broker = RabbitMQBroker("amqp://localhost:5672")
        
        # ã€å¯¹æ ‡å¯¹æ¯”ã€‘ï¼šä¸ Redis æ¯”è¾ƒ
        # RabbitMQ æ›´å¯é ä½†æ›´æ…¢
        # Redis æ›´å¿«ä½†å¯é æ€§è¾ƒä½
        
        # è¿™å°±æ˜¯åº“ä½¿ç”¨è€…éœ€è¦ç†è§£çš„æƒè¡¡
    
    @memory_profiler.profile
    def bench_memory_efficiency(self):
        """åº“çš„å†…å­˜æ•ˆç‡"""
        # åœ¨å¤„ç†å¤§é‡æ¶ˆæ¯æ—¶ï¼Œåº“æ˜¯å¦ä¼šæœ‰å†…å­˜æ³„æ¼ï¼Ÿ
        
        broker = RedisBroker("redis://localhost:6379")
        
        # æ¨¡æ‹Ÿå¤„ç† 100 ä¸‡æ¡æ¶ˆæ¯
        for i in range(1_000_000):
            if i % 10000 == 0:
                print(f"Processed {i} messages")
            
            broker.put("stream", {"id": i})
            msg = broker.get("stream")

# ã€æ•™ç»ƒæç¤ºã€‘ï¼šåº“çš„æ€§èƒ½å¾€å¾€æ˜¯ä½¿ç”¨å†³ç­–çš„å…³é”®å› ç´ 
# å­¦ä¹ åº“æ—¶ï¼Œå¿…é¡»ç†è§£æ€§èƒ½ç‰¹å¾
```

### 4. åº“ä»“åº“çš„å­¦ä¹ è·¯å¾„

```
ç¬¬ä¸€æ­¥ï¼ˆ30 åˆ†é’Ÿï¼‰ï¼šç†è§£åº“è§£å†³çš„é—®é¢˜
â”œâ”€ åº“çš„ç”¨é€”ï¼ˆä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿï¼‰
â”œâ”€ åº“çš„å¯¹æ ‡äº§å“ï¼ˆæœ‰ä»€ä¹ˆç«äº‰è€…ï¼Ÿï¼‰
â””â”€ åº“çš„æ€§èƒ½ä¼˜åŠ£ï¼ˆç›¸æ¯”ç«äº‰è€…å¦‚ä½•ï¼Ÿï¼‰

ç¬¬äºŒæ­¥ï¼ˆ1 å°æ—¶ï¼‰ï¼šå¿«é€Ÿä½¿ç”¨åº“
â”œâ”€ å®Œæˆå®˜æ–¹æ•™ç¨‹
â”œâ”€ è¿è¡Œå®˜æ–¹ç¤ºä¾‹
â””â”€ ç†è§£åŸºæœ¬ API

ç¬¬ä¸‰æ­¥ï¼ˆ1 å°æ—¶ï¼‰ï¼šç†è§£æ ¸å¿ƒæŠ½è±¡
â”œâ”€ æ‰¾åˆ°å…³é”®çš„æ¥å£ç±»ï¼ˆå¦‚ AbstractBrokerï¼‰
â”œâ”€ ç†è§£ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™æ ·
â””â”€ ç†è§£ä¸åŒå®ç°çš„åŒºåˆ«

ç¬¬å››æ­¥ï¼ˆ2 å°æ—¶ï¼‰ï¼šæ·±å…¥å®ç°ç»†èŠ‚
â”œâ”€ é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„å®ç°ï¼ˆå¦‚ RedisBrokerï¼‰
â”œâ”€ é˜…è¯»æºç ï¼Œç†è§£ç®—æ³•
â”œâ”€ ç†è§£æ€§èƒ½ä¼˜åŒ–æŠ€å·§
â””â”€ ç†è§£è¾¹ç•Œæƒ…å†µå¤„ç†

ç¬¬äº”æ­¥ï¼ˆ1 å°æ—¶ï¼‰ï¼šæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
â”œâ”€ ç¼–å†™åŸºå‡†æµ‹è¯•
â”œâ”€ ç†è§£æ€§èƒ½ç‰¹å¾
â”œâ”€ è¯†åˆ«ç“¶é¢ˆ
â””â”€ ç†è§£ä½•æ—¶ä½¿ç”¨å“ªä¸ªå®ç°

ç¬¬å…­æ­¥ï¼ˆå¯é€‰ï¼‰ï¼šä¸ºåº“è´¡çŒ®ä»£ç 
â”œâ”€ ä¿®å¤ bug
â”œâ”€ ä¼˜åŒ–æ€§èƒ½
â”œâ”€ æ·»åŠ æ–°çš„å®ç°ï¼ˆå¦‚æ–°çš„ Brokerï¼‰
```

### 5. åº“ä»“åº“çš„å­¦ä¹ éªŒè¯

```python
class LibraryUnderstandingTest:
    """åº“ç†è§£åº¦è‡ªæµ‹"""
    
    def test_1_abstraction(self):
        """ä½ ç†è§£äº†åº“çš„æŠ½è±¡æ¥å£å—ï¼Ÿ"""
        # 1. åº“çš„æ ¸å¿ƒæ¥å£æ˜¯ä»€ä¹ˆï¼Ÿ
        # 2. ä¸ºä»€ä¹ˆè¦å®šä¹‰è¿™æ ·çš„æ¥å£ï¼Ÿ
        # 3. æ¥å£çš„å“ªäº›æ–¹æ³•æ˜¯å¼ºåˆ¶çš„ï¼Œå“ªäº›æ˜¯å¯é€‰çš„ï¼Ÿ
        pass
    
    def test_2_implementations(self):
        """ä½ ç†è§£äº†ä¸åŒçš„å®ç°å—ï¼Ÿ"""
        # 1. åº“æ”¯æŒå“ªäº›å®ç°ï¼Ÿ
        # 2. æ¯ä¸ªå®ç°çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ
        # 3. å¦‚ä½•é€‰æ‹©åˆé€‚çš„å®ç°ï¼Ÿ
        pass
    
    def test_3_performance(self):
        """ä½ ç†è§£äº†æ€§èƒ½ç‰¹å¾å—ï¼Ÿ"""
        # 1. å„ä¸ªå®ç°çš„ååé‡æ˜¯å¤šå°‘ï¼Ÿ
        # 2. å»¶è¿Ÿåˆ†å¸ƒå¦‚ä½•ï¼Ÿ
        # 3. ä»€ä¹ˆæ—¶å€™ä¼šè¾¾åˆ°æ€§èƒ½ç“¶é¢ˆï¼Ÿ
        pass
    
    def test_4_edge_cases(self):
        """ä½ ç†è§£äº†è¾¹ç•Œæƒ…å†µå—ï¼Ÿ"""
        # 1. å½“ç³»ç»Ÿè¿‡è½½æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
        # 2. ç½‘ç»œåˆ†åŒºæ—¶å¦‚ä½•å¤„ç†ï¼Ÿ
        # 3. å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ
        pass
    
    def test_5_extension(self):
        """ä½ èƒ½æ‰©å±•åº“å—ï¼Ÿ"""
        # 1. èƒ½å†™ä¸€ä¸ªæ–°çš„ Broker å®ç°å—ï¼Ÿ
        # 2. èƒ½é›†æˆåº“åˆ°ä½ çš„ç³»ç»Ÿå—ï¼Ÿ
        # 3. èƒ½ä¼˜åŒ–åº“çš„æ€§èƒ½å—ï¼Ÿ
        pass

# èƒ½å›ç­”è¿™äº›é—®é¢˜ = çœŸæ­£ç†è§£äº†åº“
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šä¸‰ç§åç«¯ä»“åº“çš„å¯¹æ¯”æ€»ç»“

|ç»´åº¦|æ¡†æ¶ä»“åº“|ä¸šåŠ¡æœåŠ¡ä»“åº“|åº“ä»“åº“|
|---|---|---|---|
|**æ ¸å¿ƒé—®é¢˜**|å¦‚ä½•è®©å¼€å‘è€…ç¼–å†™åç«¯åº”ç”¨ï¼Ÿ|å¦‚ä½•è§£å†³å…·ä½“çš„ä¸šåŠ¡é—®é¢˜ï¼Ÿ|å¦‚ä½•æä¾›é€šç”¨çš„æŠ€æœ¯èƒ½åŠ›ï¼Ÿ|
|**æ¶æ„æ ¸å¿ƒ**|ä¸­é—´ä»¶ã€ORMã€è·¯ç”±ã€è£…é¥°å™¨|API å±‚ â†’ åº”ç”¨å±‚ â†’ é¢†åŸŸå±‚ â†’ åŸºç¡€è®¾æ–½å±‚|æŠ½è±¡æ¥å£ + å¤šä¸ªå®ç°|
|**å…³é”®æ¦‚å¿µ**|æ‰©å±•ç‚¹ã€Hookã€ä¸­é—´ä»¶|ä¸šåŠ¡æµã€é¢†åŸŸè§„åˆ™ã€ç”¨ä¾‹|å¤šå®ç°ã€é€‚é…å™¨ã€æŠ½è±¡|
|**å­¦ä¹ åˆ‡å…¥**|çœ‹ examples â†’ ç†è§£ç¼–ç¨‹æ¨¡å‹ â†’ é˜…è¯»æºç |çœ‹ API æ–‡æ¡£ â†’ è¿½è¸ªä¸šåŠ¡æµ â†’ ç†è§£æ•°æ®æ¨¡å‹|çœ‹ä½¿ç”¨ç¤ºä¾‹ â†’ ç†è§£æ¥å£ â†’ å­¦ä¹ å®ç°|
|**å…³é”®æ–‡ä»¶**|routing, middleware, ORM|models, services, repositories|core interface, backends, adapters|
|**æµ‹è¯•å…³é”®**|å•å…ƒæµ‹è¯•ï¼ˆéªŒè¯æ¡†æ¶æœºåˆ¶ï¼‰|é›†æˆæµ‹è¯•ï¼ˆéªŒè¯ä¸šåŠ¡æµï¼‰|æ€§èƒ½æµ‹è¯•ï¼ˆéªŒè¯æ€§èƒ½ç‰¹å¾ï¼‰|
|**æ€§èƒ½å…³é”®**|å¯åŠ¨æ—¶é—´ã€è¯·æ±‚å»¶è¿Ÿã€ååé‡|å“åº”æ—¶é—´ã€æ•°æ®åº“æŸ¥è¯¢æ•ˆç‡ã€å¹¶å‘|ååé‡ã€å»¶è¿Ÿã€å†…å­˜æ•ˆç‡|
|**æ–‡æ¡£é‡ç‚¹**|ä½¿ç”¨æŒ‡å— + API æ–‡æ¡£|æ¶æ„æ–‡æ¡£ + API æ–‡æ¡£|æ€§èƒ½æ•°æ® + å®ç°å¯¹æ¯”|
|**ä»£ç é˜…è¯»é¡ºåº**|Examples â†’ Core â†’ Middleware â†’ Tests|README â†’ API â†’ Domain â†’ Services â†’ Tests|Examples â†’ Interface â†’ Implementations â†’ Benchmarks|
|**æ ¸å¿ƒæŒ‘æˆ˜**|è®¾è®¡æ¸…æ™°çš„æ‰©å±•ç‚¹|æ­£ç¡®çš„ä¸šåŠ¡å»ºæ¨¡|æŠ½è±¡å‡ºé€šç”¨æ¥å£|

---

## ç¬¬å…­éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹é€‰æ‹©æŒ‡å—

### å­¦ä¹ æ¡†æ¶ä»“åº“çš„æ¡ˆä¾‹

- **FastAPI** - æœ€ç°ä»£ã€ä»£ç æœ€ç®€æ´çš„æ¡†æ¶
- **Django** - æœ€å®Œæ•´ã€ç”Ÿæ€æœ€æˆç†Ÿçš„æ¡†æ¶
- **Flask** - æœ€ç®€å•ã€é€‚åˆå¿«é€Ÿå­¦ä¹ 

### å­¦ä¹ ä¸šåŠ¡æœåŠ¡ä»“åº“çš„æ¡ˆä¾‹

- **Stripe API Backend** - æ”¯ä»˜ç³»ç»Ÿçš„å…¸èŒƒ
- **Netflix æ¨èç³»ç»Ÿ** - å¤§è§„æ¨¡ç³»ç»Ÿçš„æ¶æ„
- **Shopify è®¢å•ç³»ç»Ÿ** - ç”µå•†ä¸šåŠ¡çš„æ ‡å‡†æ¨¡å¼

### å­¦ä¹ åº“ä»“åº“çš„æ¡ˆä¾‹

- **Celery** - ä»»åŠ¡é˜Ÿåˆ—ï¼Œå±•ç¤ºå¤šä¸ª Broker å®ç°
- **SQLAlchemy** - ORMï¼Œå±•ç¤ºå¤šç§æ•°æ®åº“æ”¯æŒ
- **Redis-py** - Redis å®¢æˆ·ç«¯ï¼Œå±•ç¤ºè¿æ¥æ± å’Œæ€§èƒ½ä¼˜åŒ–

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé€šç”¨çš„é«˜é˜¶å­¦ä¹ æŠ€å·§

### ã€æŠ€å·§ 1ã€‘ï¼šä» GitHub Issue å’Œ PR å­¦ä¹ 

```python
# ä¸ä»…è¦è¯»ä»£ç ï¼Œè¿˜è¦è¯» Issue å’Œ PR

# ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°å…³é”®çš„ Issue
# GitHub ä»“åº“ â†’ Issues â†’ æ ‡ç­¾ "architecture"

# ç¬¬äºŒæ­¥ï¼šé˜…è¯»è®¨è®º
# Issue ä¸­çš„è®¨è®ºä¼šæ­ç¤ºï¼š
# - è®¾è®¡å†³ç­–çš„åŸå› 
# - æƒè¡¡è€ƒè™‘
# - æœªæ¥çš„æ–¹å‘

# ç¬¬ä¸‰æ­¥ï¼šé˜…è¯»ç›¸å…³çš„ PR
# PR ä¸­çš„ä»£ç å˜åŒ–ä¼šå±•ç¤ºï¼š
# - å…·ä½“çš„å®ç°æ–¹æ¡ˆ
# - æ€§èƒ½ä¼˜åŒ–æŠ€å·§
# - æµ‹è¯•ç­–ç•¥
```

### ã€æŠ€å·§ 2ã€‘ï¼šç¼–å†™å¯¹æ¯”åˆ†æ

```markdown
# æ¡†æ¶ A vs æ¡†æ¶ B

## ç¼–ç¨‹æ¨¡å‹
- A: åŸºäºè£…é¥°å™¨
- B: åŸºäºç±»ç»§æ‰¿

## æ€§èƒ½
- A: å¯åŠ¨å¿«ï¼Œè¿è¡Œå¿«
- B: å¯åŠ¨æ…¢ï¼Œè¿è¡Œç¨³å®š

## å­¦ä¹ æ›²çº¿
- A: é™¡å³­
- B: å¹³ç¼“

## ç”Ÿæ€
- A: å°ï¼Œä¸“æ³¨
- B: å¤§ï¼Œå…¨é¢

## ä½¿ç”¨åœºæ™¯
- A: å¾®æœåŠ¡ã€API
- B: å…¨åŠŸèƒ½ Web åº”ç”¨
```

### ã€æŠ€å·§ 3ã€‘ï¼šå†™ä¸€ä¸ª"ä»é›¶å¼€å§‹"çš„å®ç°

```python
# æœ€å¥½çš„å­¦ä¹ æ–¹æ³•æ˜¯è‡ªå·±å®ç°ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬

# ä¾‹å¦‚ï¼šå­¦ä¹  FastAPI æ—¶ï¼Œè‡ªå·±å®ç°ä¸€ä¸ªè¿·ä½ æ¡†æ¶

class MiniFramework:
    def __init__(self):
        self.routes = {}
    
    def get(self, path):
        def decorator(func):
            self.route_map[path] = func
            return func
        return decorator
    
    async def __call__(self, request):
        # è°ƒç”¨å¯¹åº”çš„è·¯ç”±å¤„ç†å™¨
        handler = self.routes[request.path]
        return await handler(request)

# é€šè¿‡å®ç°ï¼Œä½ èƒ½æ·±åˆ»ç†è§£æ¡†æ¶çš„å·¥ä½œåŸç†
```

---

## ç¬¬å…«éƒ¨åˆ†ï¼šå¿«é€Ÿå†³ç­–æ ‘

**é€‰æ‹©å­¦ä¹ å“ªç§åç«¯ä»“åº“ï¼Ÿ**

```
æ˜¯æ¡†æ¶å—ï¼Ÿ
â”œâ”€ Yes â†’ å­¦ä¹ æ¡†æ¶ä»“åº“
â”‚   â”œâ”€ å…³æ³¨ï¼šæ‰©å±•ç‚¹ã€ä¸­é—´ä»¶ã€ç¼–ç¨‹æ¨¡å‹
â”‚   â””â”€ å­¦ä¹ æ–¹æ³•ï¼šç¼–å†™åº”ç”¨ + é˜…è¯»æºç 
â”‚
â”œâ”€ æ˜¯ä¸šåŠ¡æœåŠ¡å—ï¼Ÿ
â”‚   â”œâ”€ Yes â†’ å­¦ä¹ ä¸šåŠ¡æœåŠ¡ä»“åº“
â”‚   â”‚   â”œâ”€ å…³æ³¨ï¼šAPI è®¾è®¡ã€ä¸šåŠ¡æµã€æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€ å­¦ä¹ æ–¹æ³•ï¼šè¿½è¸ªæ•°æ®æµ + é˜…è¯»æµ‹è¯•
â”‚   â”‚
â”‚   â””â”€ æ˜¯åº“å—ï¼Ÿ
â”‚       â”œâ”€ Yes â†’ å­¦ä¹ åº“ä»“åº“
â”‚       â”‚   â”œâ”€ å…³æ³¨ï¼šæŠ½è±¡æ¥å£ã€å¤šå®ç°ã€æ€§èƒ½
â”‚       â”‚   â””â”€ å­¦ä¹ æ–¹æ³•ï¼šå¯¹æ¯”å®ç° + æ€§èƒ½æµ‹è¯•
â”‚       â”‚
â”‚       â””â”€ æ··åˆç±»å‹ï¼ˆå¦‚ Django æ—¢æ˜¯æ¡†æ¶åˆæœ‰ ORM åº“ï¼‰
â”‚           â””â”€ åˆ†åˆ«å­¦ä¹ æ¯ä¸ªéƒ¨åˆ†
```

---

## æ€»ç»“ï¼šä¸‰ç§åç«¯ä»“åº“çš„å¿«é€Ÿè¯†åˆ«å’Œå­¦ä¹ 

### ğŸ¯ å¿«é€Ÿè¯†åˆ«ï¼ˆçœ‹è¿™äº›ç‰¹å¾ï¼‰

|ç‰¹å¾|æ¡†æ¶|ä¸šåŠ¡æœåŠ¡|åº“|
|---|---|---|---|
|examples/|å¿…æœ‰|æ— |å¿…æœ‰|
|tests/|å¤§é‡å•å…ƒæµ‹è¯•|å¤§é‡é›†æˆæµ‹è¯•|å¤§é‡æ€§èƒ½æµ‹è¯•|
|æ ¸å¿ƒæ¦‚å¿µ|è£…é¥°å™¨ã€ä¸­é—´ä»¶|æœåŠ¡ã€ä»“åº“|æ¥å£ã€é€‚é…å™¨|
|README å†…å®¹|å¦‚ä½•ä½¿ç”¨|æ¶æ„è®¾è®¡|æ€§èƒ½å¯¹æ¯”|
|æ‰©å±•æ–¹å¼|æ’ä»¶ã€ä¸­é—´ä»¶|ä¸šåŠ¡æœåŠ¡|æ–°å®ç°|

### âš¡ å­¦ä¹ é€Ÿåº¦ï¼ˆä»å¿«åˆ°æ…¢ï¼‰

1. **åº“ä»“åº“** - é€šå¸¸æœ€å¿«ï¼ˆä»£ç é‡æœ€å°ï¼Œæ¦‚å¿µæœ€æ¸…æ™°ï¼‰
2. **æ¡†æ¶ä»“åº“** - ä¸­ç­‰ï¼ˆä»£ç é‡å¤šï¼Œä½†æ¦‚å¿µç›¸å¯¹ç‹¬ç«‹ï¼‰
3. **ä¸šåŠ¡æœåŠ¡** - æœ€æ…¢ï¼ˆéœ€è¦ç†è§£å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼‰

### ğŸ“Š å­¦ä¹ æŠ•å…¥ï¼ˆä»å°‘åˆ°å¤šï¼‰

1. **åº“ä»“åº“** - å­¦ä¹  1 ä¸ªå®ç°å³å¯ï¼ˆå¦‚ RedisBrokerï¼‰
2. **æ¡†æ¶ä»“åº“** - å­¦ä¹ æ ¸å¿ƒ 2-3 ä¸ªæ¨¡å—ï¼ˆå¦‚ routing + middlewareï¼‰
3. **ä¸šåŠ¡æœåŠ¡** - å­¦ä¹ å®Œæ•´çš„æµç¨‹ï¼ˆAPI â†’ Domain â†’ Infrastructureï¼‰