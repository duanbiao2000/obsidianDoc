**第17章：Optimization in Embedded Systems（嵌入式系统中的优化）内容总结：**

- **嵌入式系统资源极度有限**
    
    - 嵌入式设备（微控制器）相比PC拥有极低的主频和极小的RAM，必须极度节约资源，避免使用大型框架、解释器、JIT编译器、系统数据库等臃肿构件。
        
    - 通常无操作系统，更不能依赖动态内存、后台垃圾回收。
        
- **编程语言选择**
    
    - C/C++为嵌入式首选，可在PC上交叉编译生成机器码下载至设备；解释型语言与运行时库耗资源过大，不推荐。
        
    - C++与C在资源消耗接近，谨慎使用容器和动态特性即可。
        
- **内存利用与数组管理**
    
    - 大数组应声明于临时使用的函数内，函数返回自动释放内存。
        
    - 建议复用数组资源，实现内存共享，保证RAM极限情况下所有内存均物尽其用。
        
    - 严禁 new/delete 或 malloc/free，避免 heap 管理和垃圾回收带来的不可控实时延迟。
        
- **容器、字符串与结构**
    
    - 禁用标准C++容器（如queue、vector），改用环形缓冲区、定长静态数组、结构体，高度可控且不依赖动态分配。
        
    - 字符串建议用老式char数组，务必做边界检查防止溢出。
        
- **高级特性谨慎使用**
    
    - 尽量避免 C++ 虚函数，因虚表指针/多态机制严重拖慢速度并增大空间消耗。
        
    - 小型芯片常无硬件浮点运算单元，浮点表达式（如 a = b * 2.5）会触发庞大的浮点库加载，强烈建议用整数和分数近似代替。
        
    - 代码中如需保留两位小数，建议全部数值*100，避免浮点类型。
        
- **数据类型与位宽管理**
    
    - 所有整型变量视需求用最小位宽（8/16/32），压缩RAM用量。
        
    - 类型规格跨平台不一，编译前务必查阅具体芯片编译器文档。
        
- **中断与驱动编程**
    
    - 中断服务例程/设备驱动为高优先级关键代码，尽量只做必要事件（如缓冲区收发一条消息），绝不做复杂计算或响应。
        
    - 响应命令类事件应交由程序主循环（低优先级）完成，避免高优先级中断阻塞主流程。
        

**结论**  
嵌入式系统优化重点是资源压缩、避免所有动态机制和多余代码，只用静态、定长、轻量的数组与数据结构。软件核心部分用严格的C/C++，只在功能和结构简洁时加入少量C++特性。浮点计算必须能以整数替代，所有中断和驱动代码都最小化，加边界检查和资源复用，保证速度和实时性。

1. [https://agner.org/optimize/optimizing_cpp.pdf](https://agner.org/optimize/optimizing_cpp.pdf)