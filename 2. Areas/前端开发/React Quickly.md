---
aliases: null
theme: null
original: null
url: null
author: null
date_created: 2024-08-03 13:11
date_updated: null
type: null
high_priority: false
tags: null
---

以下是 React 组件类写法和函数式写法的对比，使用 Markdown 表格格式：

| 特性             | 类组件写法                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 函数组件写法                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| -------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **定义**         | 使用 ES6 类定义组件                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 使用函数定义组件                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **状态管理**       | 通过 `this.state` 和 `this.setState` 管理状态                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 通过 `useState` Hook 管理状态                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **生命周期方法**     | 具有生命周期方法，如 `componentDidMount`、`componentDidUpdate`、`componentWillUnmount`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 使用 `useEffect` Hook 替代生命周期方法                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **`this` 关键字** | 需要绑定 `this`，例如在事件处理函数中                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 不需要使用 `this`，不必担心 `this` 绑定问题                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **性能优化**       | 可以使用 `shouldComponentUpdate` 或 `PureComponent` 进行性能优化                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 可以使用 `React.memo` 进行性能优化                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Hooks**      | 无法使用 Hooks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 可以使用 Hooks，例如 `useState`、`useEffect`、`useContext` 等                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **代码简洁度**      | 代码相对冗长，需要处理 `this` 绑定                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 代码简洁，结构清晰                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **可组合性**       | 通过高阶组件（HOC）或 Render Props 实现组件逻辑复用                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 通过 Hooks 实现逻辑复用，更加简洁和易于组合                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| **示例代码**       | `jsx<br>import React, { Component } from 'react';<br><br>class ClassComponent extends Component {<br>  constructor(props) {<br>    super(props);<br>    this.state = { count: 0 };<br>    this.handleClick = this.handleClick.bind(this);<br>  }<br><br>  handleClick() {<br>    this.setState({ count: this.state.count + 1 });<br>  }<br><br>  componentDidMount() {<br>    console.log('Component mounted');<br>  }<br><br>  render() {<br>    return (<br>      <div><br>        <p>Count: {this.state.count}</p><br>        <button onClick={this.handleClick}>Increment</button><br>      </div><br>    );<br>  }<br>}<br><br>export default ClassComponent;<br>` | `jsx<br>import React, { useState, useEffect } from 'react';<br><br>function FunctionComponent() {<br>  const [count, setCount] = useState(0);<br><br>  useEffect(() => {<br>    console.log('Component mounted');<br>  }, []);<br><br>  const handleClick = () => {<br>    setCount(count + 1);<br>  };<br><br>  return (<br>    <div><br>      <p>Count: {count}</p><br>      <button onClick={handleClick}>Increment</button><br>    </div><br>  );<br>}<br><br>export default FunctionComponent;<br>` |

### 总结

类组件在 React 早期版本中是主要的组件定义方式，具有完整的生命周期方法和状态管理机制。函数式组件在 React 16.8 中引入 Hooks 之后，变得更加简洁和灵活，能够处理状态和副作用，使得函数式组件成为了现代 React 开发的首选。

在给定的`useEffect`钩子中，连续两个箭头函数的写法是一种常见的用法，被称为返回清理函数的箭头函数。具体来说，第一个箭头函数被用作`useEffect`的回调函数，用于定义副作用逻辑；而第二个箭头函数则被用作返回的清理函数，用于在组件卸载或下一次副作用执行前执行清理操作。
下面是解释和最佳实践的示例代码：

```javascript
useEffect(() => {
  // 副作用逻辑
  const trackEvent = () => {
    // 跟踪事件的代码
    console.log('Event tracked: dialog_dismissed');
  };
  // 在组件卸载或下一次副作用执行前执行清理操作
  return () => {
    trackEvent(); // 执行清理操作，如跟踪事件
  };
}, []);
```

在这个例子中，当组件挂载时，`useEffect`的回调函数被执行。在回调函数内部，定义了`trackEvent`函数来跟踪事件。同时，返回的第二个箭头函数会在组件卸载时或下一次副作用执行前被调用。在这个清理函数内部，可以执行一些清理操作，比如跟踪事件或取消订阅。
这种用法的最佳实践是在副作用逻辑中处理任何需要清理的操作，并返回一个清理函数以确保在组件被卸载时进行清理。这样可以避免内存泄漏和不必要的副作用。
需要注意的是，第二个箭头函数只在依赖项数组为空（`[]`）时执行一次，因为它没有依赖项。如果有依赖项，清理函数会在依赖项发生变化时被调用，而不是在组件卸载时执行清理操作。
