---
tags:
  - task-management
  - dataview
  - automation
  - dashboard
---

# æ™ºèƒ½ä»»åŠ¡ç®¡ç†ä»ªè¡¨æ¿

## ä¸€ã€å…¨å±€ä»»åŠ¡æ¦‚è§ˆ

<%*
// åŸºç¡€ä»»åŠ¡ç»Ÿè®¡
const allTasks = dv.pages()
    .where(p => p.tasks && p.tasks.length > 0)
    .flatMap(p => p.tasks.map(t => ({
        ...t,
        page: p,
        projectName: p.tags?.find(t => t.includes('project')) || 'æœªåˆ†ç±»'
    })));

const completedTasks = allTasks.filter(t => t.completed);
const activeTasks = allTasks.filter(t => !t.completed);
const overdueTasks = allTasks.filter(t => t.due && t.due < Date.now() && !t.completed);
%>

### ğŸ“Š ä»»åŠ¡ç»Ÿè®¡æ¦‚è§ˆ

| æŒ‡æ ‡ | æ•°é‡ | æ¯”ä¾‹ |
|:---|:---|:---|
| **æ€»ä»»åŠ¡** | <%= allTasks.length %> | 100% |
| **å·²å®Œæˆ** | <%= completedTasks.length %> | <%= ((completedTasks.length / allTasks.length) * 100).toFixed(1) %>% |
| **è¿›è¡Œä¸­** | <%= activeTasks.length %> | <%= ((activeTasks.length / allTasks.length) * 100).toFixed(1) %>% |
| **å·²é€¾æœŸ** | <%= overdueTasks.length %> | <%= ((overdueTasks.length / allTasks.length) * 100).toFixed(1) %>% |

---

## äºŒã€ä»Šæ—¥æ¨èä»»åŠ¡

<%*
// æ™ºèƒ½ä»»åŠ¡æ¨èç®—æ³•
const today = Date.now();
const oneDay = 24 * 60 * 60 * 1000;

// ç­›é€‰ä»Šæ—¥åº”è¯¥å®Œæˆçš„ä»»åŠ¡
const recommendedTasks = activeTasks
    .filter(t => {
        // 1. ç´§æ€¥ä»»åŠ¡ï¼ˆä»Šå¤©æˆ–æ˜å¤©åˆ°æœŸï¼‰
        if (t.due) {
            const daysUntil = (t.due - today) / oneDay;
            if (daysUntil <= 1) return true;
        }

        // 2. é«˜ä¼˜å…ˆçº§ä»»åŠ¡
        if (t.priority === 'high' || t.priority === 'urgent') return true;

        // 3. é˜»å¡å…¶ä»–ä»»åŠ¡çš„ä»»åŠ¡
        if (t.blocks && t.blocks.length > 0) return true;

        return false;
    })
    .sort((a, b) => {
        // æŒ‰æˆªæ­¢æ—¥æœŸä¼˜å…ˆæ’åº
        if (a.due && b.due) return a.due - b.due;
        if (a.due) return -1;
        if (b.due) return 1;

        // æŒ‰ä¼˜å…ˆçº§æ’åº
        const priorityOrder = { 'urgent': 0, 'high': 1, 'medium': 2, 'low': 3 };
        return (priorityOrder[a.priority] || 4) - (priorityOrder[b.priority] || 4);
    })
    .slice(0, 10); // æœ€å¤šæ˜¾ç¤º10ä¸ªä»»åŠ¡
%>

### ğŸ¯ ä»Šæ—¥é‡ç‚¹ä»»åŠ¡ï¼ˆ<%= recommendedTasks.length %>é¡¹ï¼‰

<%*
if (recommendedTasks.length === 0) {
%>
> âœ… **æ­å–œï¼ä»Šæ—¥æ²¡æœ‰ç´§æ€¥ä»»åŠ¡**
> æ‚¨å¯ä»¥ä¸“æ³¨äºé•¿æœŸè§„åˆ’æˆ–æ·±åº¦å·¥ä½œã€‚

<%
} else {
    recommendedTasks.forEach(task => {
%>
<%= task.completed ? 'âœ…' : 'â¬œ' %> [[<%= task.page.file.name %>]] - <%= task.text %>
<%
        if (task.due) {
            const daysUntil = Math.ceil((task.due - today) / oneDay);
            const urgencyClass = daysUntil <= 0 ? 'text-red-600' : daysUntil <= 1 ? 'text-orange-600' : 'text-blue-600';
%>
<span class="<%= urgencyClass %>">ğŸ“… <%= daysUntil <= 0 ? 'å·²é€¾æœŸ' : daysUntil === 0 ? 'ä»Šå¤©' : daysUntil + 'å¤©å' %></span>
<%
        }
        if (task.priority) {
            const priorityIcon = {
                'urgent': 'ğŸ”´',
                'high': 'ğŸŸ ',
                'medium': 'ğŸŸ¡',
                'low': 'ğŸŸ¢'
            }[task.priority] || 'âšª';
%>
<span><%= priorityIcon %> <%= task.priority.toUpperCase() %></span>
<%
        }
%>

<%
    });
}
%>

---

## ä¸‰ã€é¡¹ç›®è¿›åº¦è·Ÿè¸ª

<%*
// æŒ‰é¡¹ç›®åˆ†ç»„ä»»åŠ¡
const tasksByProject = {};
activeTasks.forEach(task => {
    const project = task.page.tags?.find(t => t.includes('project'))?.split('/').pop() || 'æœªåˆ†ç±»';
    if (!tasksByProject[project]) {
        tasksByProject[project] = { active: 0, completed: 0, total: 0 };
    }
    tasksByProject[project].active++;
    tasksByProject[project].total++;
});

completedTasks.forEach(task => {
    const project = task.page.tags?.find(t => t.includes('project'))?.split('/').pop() || 'æœªåˆ†ç±»';
    if (!tasksByProject[project]) {
        tasksByProject[project] = { active: 0, completed: 0, total: 0 };
    }
    tasksByProject[project].completed++;
    tasksByProject[project].total++;
});
%>

### ğŸ“ˆ é¡¹ç›®è¿›åº¦æ¦‚è§ˆ

| é¡¹ç›® | æ´»è·ƒä»»åŠ¡ | å·²å®Œæˆ | æ€»æ•° | å®Œæˆç‡ | è¿›åº¦ |
|:---|:---|:---|:---|:---|:---|
<%*
Object.entries(tasksByProject)
    .sort((a, b) => b[1].total - a[1].total)
    .forEach(([project, stats]) => {
        const completionRate = ((stats.completed / stats.total) * 100).toFixed(1);
        const progressBar = 'â–ˆ'.repeat(Math.floor(completionRate / 10)) + 'â–‘'.repeat(10 - Math.floor(completionRate / 10));
%>
| <%= project %> | <%= stats.active %> | <%= stats.completed %> | <%= stats.total %> | <%= completionRate %>% | <%= progressBar %> |
<%
    });
%>

---

## å››ã€é£é™©é¢„è­¦

<%*
// é£é™©åˆ†æ
const riskTasks = activeTasks.filter(t => {
    // 1. é€¾æœŸä»»åŠ¡
    if (t.due && t.due < today) return true;

    // 2. å³å°†åˆ°æœŸçš„é«˜ä¼˜å…ˆçº§ä»»åŠ¡
    if (t.due && (t.priority === 'urgent' || t.priority === 'high')) {
        const daysUntil = (t.due - today) / oneDay;
        if (daysUntil <= 3) return true;
    }

    return false;
});

// å·¥ä½œè´Ÿè½½åˆ†æ
const thisWeekTasks = activeTasks.filter(t => {
    if (!t.estimated) return false;
    const hours = parseInt(t.estimated.match(/(\d+)h/)?.[1] || 0);
    return hours > 0;
});

const totalEstimatedHours = thisWeekTasks.reduce((sum, t) => {
    const hours = parseInt(t.estimated?.match(/(\d+)h/)?.[1] || 0);
    return sum + hours;
}, 0);
%>

### âš ï¸ é£é™©åˆ†æ

#### é€¾æœŸä»»åŠ¡ (<%= overdueTasks.length %>é¡¹)
<%*
if (overdueTasks.length === 0) {
%>
âœ… **æ— é€¾æœŸä»»åŠ¡**

<%
} else {
    overdueTasks.slice(0, 5).forEach(task => {
%>
- [[<%= task.page.file.name %>]] - <%= task.text %>
<%
    });
    if (overdueTasks.length > 5) {
%>
... è¿˜æœ‰ <%= overdueTasks.length - 5 %> é¡¹é€¾æœŸä»»åŠ¡
<%
    }
}
%>

#### å·¥ä½œè´Ÿè½½é¢„è­¦
<%*
if (totalEstimatedHours > 40) {
%>
ğŸ”´ **å·¥ä½œè´Ÿè½½è¿‡é«˜**
- æœ¬å‘¨é¢„ä¼°å·¥æ—¶ï¼š<%= totalEstimatedHours %>å°æ—¶
- å»ºè®®ä¼˜åŒ–ä¼˜å…ˆçº§æˆ–é‡æ–°è§„åˆ’ä»»åŠ¡

<%
} else if (totalEstimatedHours > 30) {
%>
ğŸŸ  **å·¥ä½œè´Ÿè½½è¾ƒé«˜**
- æœ¬å‘¨é¢„ä¼°å·¥æ—¶ï¼š<%= totalEstimatedHours %>å°æ—¶
- éœ€è¦å…³æ³¨ä»»åŠ¡è¿›åº¦

<%
} else if (totalEstimatedHours > 0) {
%>
ğŸŸ¢ **å·¥ä½œè´Ÿè½½æ­£å¸¸**
- æœ¬å‘¨é¢„ä¼°å·¥æ—¶ï¼š<%= totalEstimatedHours %>å°æ—¶

<%
} else {
%>
âšª **å·¥ä½œè´Ÿè½½æœªæ˜ç¡®**
- å»ºè®®ä¸ºä»»åŠ¡æ·»åŠ å·¥æ—¶ä¼°ç®—

<%
}
%>

---

## äº”ã€æ™ºèƒ½å»ºè®®

<%*
// ç”Ÿæˆæ™ºèƒ½å»ºè®®
const suggestions = [];

// 1. é€¾æœŸä»»åŠ¡å¤„ç†å»ºè®®
if (overdueTasks.length > 0) {
    suggestions.push({
        type: 'urgent',
        icon: 'ğŸš¨',
        message: `ç«‹å³å¤„ç† ${overdueTasks.length} é¡¹é€¾æœŸä»»åŠ¡ï¼Œæˆ–é‡æ–°è¯„ä¼°ä¼˜å…ˆçº§å’Œæˆªæ­¢æ—¥æœŸ`
    });
}

// 2. å·¥ä½œè´Ÿè½½ä¼˜åŒ–å»ºè®®
if (totalEstimatedHours > 40) {
    suggestions.push({
        type: 'warning',
        icon: 'ğŸ“Š',
        message: `å·¥ä½œè´Ÿè½½è¿‡é«˜ï¼ˆ${totalEstimatedHours}hï¼‰ï¼Œå»ºè®®å°† ${totalEstimatedHours - 40}h çš„ä»»åŠ¡å»¶åæˆ–é‡æ–°åˆ†é…`
    });
} else if (totalEstimatedHours < 20) {
    suggestions.push({
        type: 'info',
        icon: 'ğŸ’¡',
        message: `å·¥ä½œè´Ÿè½½è¾ƒä½ï¼ˆ${totalEstimatedHours}hï¼‰ï¼Œå¯ä»¥è€ƒè™‘æ·»åŠ æ›´å¤šä»»åŠ¡æˆ–ä¸“æ³¨äºæ·±åº¦å·¥ä½œ`
    });
}

// 3. é«˜ä¼˜å…ˆçº§ä»»åŠ¡å»ºè®®
const highPriorityTasks = activeTasks.filter(t =>
    t.priority === 'urgent' || t.priority === 'high'
);
if (highPriorityTasks.length > 5) {
    suggestions.push({
        type: 'warning',
        icon: 'âš ï¸',
        message: `é«˜ä¼˜å…ˆçº§ä»»åŠ¡è¿‡å¤šï¼ˆ${highPriorityTasks.length}é¡¹ï¼‰ï¼Œå»ºè®®é‡æ–°è¯„ä¼°ç´§æ€¥ç¨‹åº¦`
    });
}

// 4. ä¾èµ–å…³ç³»å»ºè®®
const blockedTasks = activeTasks.filter(t => t.blocked);
if (blockedTasks.length > 0) {
    suggestions.push({
        type: 'info',
        icon: 'ğŸš§',
        message: `${blockedTasks.length} é¡¹ä»»åŠ¡è¢«é˜»å¡ï¼Œå»ºè®®ä¼˜å…ˆå¤„ç†å‰ç½®ä»»åŠ¡`
    });
}
%>

### ğŸ’¡ æ™ºèƒ½å»ºè®®

<%*
if (suggestions.length === 0) {
%>
âœ… **å½“å‰çŠ¶æ€è‰¯å¥½**
æ²¡æœ‰æ˜æ˜¾çš„é£é™©æˆ–éœ€è¦ä¼˜åŒ–çš„äº‹é¡¹ã€‚

<%
} else {
    suggestions.forEach(suggestion => {
%>
<%= suggestion.icon %> **<%= suggestion.type.toUpperCase() %>**
<%= suggestion.message %>

<%
    });
}
%>

---

## å…­ã€å¿«é€Ÿæ“ä½œ

### ğŸ¯ å¿«é€Ÿä»»åŠ¡åˆ›å»º

<%*
// å¿«é€Ÿä»»åŠ¡åˆ›å»ºæ¨¡æ¿
const newTaskTemplate = {
    due: tp.date.now("YYYY-MM-DD"),
    created: tp.date.now(),
    priority: "medium",
    status: "todo"
};
%>

```javascript
// åˆ›å»ºæ–°ä»»åŠ¡
<%*
const taskText = await tp.system.prompt("è¾“å…¥ä»»åŠ¡æè¿°ï¼š");
if (taskText) {
%>
- [ ] <%= taskText %> ğŸ“… <%= newTaskTemplate.due %> #priority/<%= newTaskTemplate.priority %> #status/<%= newTaskTemplate.status %>
<%
}
%>
```

### ğŸ”„ æ‰¹é‡æ“ä½œ

- [ ] **å½’æ¡£å·²å®Œæˆä»»åŠ¡**
- [ ] **é‡ç½®é€¾æœŸä»»åŠ¡ä¼˜å…ˆçº§**
- [ ] **ä¼˜åŒ–æœ¬å‘¨å·¥ä½œè®¡åˆ’**
- [ ] **ç”ŸæˆSprintæŠ¥å‘Š**

---

## ä¸ƒã€ä¸ªæ€§åŒ–è®¾ç½®

### æ˜¾ç¤ºé…ç½®

```yaml
dashboard_settings:
  show_completed: true
  max_active_tasks: 15
  group_by_project: true
  show_risk_analysis: true
  enable_suggestions: true
  working_hours_per_day: 8
  working_days_per_week: 5
```

### ä¼˜å…ˆçº§é…ç½®

```yaml
priority_settings:
  urgent:
    icon: "ğŸ”´"
    weight: 10
    auto_escalation: true
  high:
    icon: "ğŸŸ "
    weight: 8
    auto_escalation: false
  medium:
    icon: "ğŸŸ¡"
    weight: 5
    auto_escalation: false
  low:
    icon: "ğŸŸ¢"
    weight: 2
    auto_escalation: false
```

---

**æœ€åæ›´æ–°**ï¼š<%= tp.date.now("YYYY-MM-DD HH:mm") %>
**ä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°**ï¼š<%= tp.date.now("add", 1, "days", "YYYY-MM-DD HH:mm") %>
