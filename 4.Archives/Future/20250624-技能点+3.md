---
view-count: 9

tags: ["Type/Reference", "Domain/Technology"]

---

## ğŸ”— ç›¸å…³é“¾æ¥

**ä¸Šçº§ç´¢å¼•**:
- [[4.Archives\_Index_of_4.Archives.md|4.Archives]]

---

# ç³»ç»Ÿæ¶æ„æ ¸å¿ƒç¬”è®° (Core Architecture Notes)

## æ¨¡å— Iï¼šåˆ†å¸ƒå¼æ¶ˆæ¯ (EDA & Distributed Messaging)
**ç›®æ ‡**ï¼šè§£è€¦ã€å‰Šå³°ã€æœ€ç»ˆä¸€è‡´æ€§ã€‚

### 1. æ ¸å¿ƒåŸè¯­ (Primitives)
*   **EDA (Event-Driven)**: å‘å¸ƒ/è®¢é˜…æ¨¡å¼ $\to$ ç©ºé—´/æ—¶é—´è§£è€¦ã€‚
*   **CAP å®šç†**: åˆ†å¸ƒå¼é“å¾‹ã€‚P (åˆ†åŒºå®¹é”™) å¿…é€‰ $\to$ æƒè¡¡ CP (å¼ºä¸€è‡´) æˆ– AP (é«˜å¯ç”¨)ã€‚
    *   *ç”Ÿäº§å®è·µ*ï¼š99% åœºæ™¯é€‰ **AP + æœ€ç»ˆä¸€è‡´æ€§**ã€‚
*   **Saga æ¨¡å¼**: é•¿äº‹åŠ¡æ‹†è§£ $\to$ T1...Tn (æœ¬åœ°äº‹åŠ¡é“¾) + C1...Cn (è¡¥å¿é“¾)ã€‚
*   **å¹‚ç­‰æ€§ (Idempotency)**: $f(f(x)) = f(x)$ã€‚
    *   *å®ç°*ï¼šæ•°æ®åº“å”¯ä¸€ç´¢å¼• (RequestID) / Redis SETNXã€‚

### 2. ç”Ÿäº§çº§é…ç½® (Production Config)
*   **å¯é æ€§ (Reliability)**:
    *   `Producer`: `delivery_mode=PERSISTENT` (æŒä¹…åŒ–)ã€‚
    *   `Consumer`: `auto_ack=False` (æ‰‹åŠ¨ç¡®è®¤) + `prefetch_count=1` (QoS/èƒŒå‹)ã€‚
    *   `Failure`: `dead_letter_exchange` (æ­»ä¿¡é˜Ÿåˆ—) $\to$ äººå·¥ä»‹å…¥/å»¶è¿Ÿé‡è¯•ã€‚

### 3. é™·é˜± (Anti-Patterns)
*   **å‘é€å³æˆåŠŸ**: é”™è¯¯ã€‚$\to$ å¿…é¡»ç›‘å¬ Broker çš„ `Publisher Confirm`ã€‚
*   **å¼ºä¸€è‡´æ€§æ‰§å¿µ**: é”™è¯¯ã€‚$\to$ æ¥å—çŸ­æš‚å»¶è¿Ÿï¼Œé€šè¿‡å¯¹è´¦/è¡¥å¿ä¿è¯æœ€ç»ˆä¸€è‡´ã€‚
*   **é˜Ÿåˆ—ä½œä¸ºæ•°æ®åº“**: é”™è¯¯ã€‚$\to$ æ¶ˆæ¯é˜Ÿåˆ—ç”¨äºä¼ è¾“ï¼Œä¸åšå¤æ‚æŸ¥è¯¢ã€‚

---

## æ¨¡å— IIï¼šMLOps (AI Production Pipeline)
**ç›®æ ‡**ï¼šæ¶ˆé™¤â€œå®éªŒå®¤â€ä¸â€œç”Ÿäº§ç¯å¢ƒâ€çš„ç†µå¢ã€‚

### 1. ç”Ÿå‘½å‘¨æœŸ (Lifecycle)
*   **ç‰ˆæœ¬ä¸‰ä½ä¸€ä½“**: `Code` (Git) + `Data` (DVC) + `Model` (MLflow) = å¯å¤ç°ã€‚
*   **æ¼‚ç§» (Drift)**:
    *   **Data Drift**: $P_{train}(X) \neq P_{serve}(X)$ (è¾“å…¥åˆ†å¸ƒå˜äº†)ã€‚
    *   **Model Drift**: $P(Y|X)$ è¡°å‡ (æ¦‚å¿µå˜äº†)ã€‚
    *   *å¯¹ç­–*: ç›‘æ§åˆ†å¸ƒè·ç¦» (KLæ•£åº¦) $\to$ è§¦å‘è‡ªåŠ¨é‡è®­ç®¡é“ã€‚

### 2. éƒ¨ç½²ç­–ç•¥ (Deployment)
*   **æ¶æ„**: Training Pipeline $\to$ Model Registry $\to$ Serving API (K8s).
*   **å®‰å…¨å‘å¸ƒ**:
    1.  **Shadow Mode**: ä¸Šçº¿ä½†ä¸è¿”å›ç»“æœï¼Œä»…å¯¹æ¯”æ–°æ—§æ¨¡å‹è¾“å‡ºã€‚
    2.  **Canary**: 1% æµé‡ $\to$ é€æ­¥å…¨é‡ã€‚
*   **ç›‘æ§**: ä¸šåŠ¡æŒ‡æ ‡ (Conversion Rate) > æŠ€æœ¯æŒ‡æ ‡ (Latency) > æ¨¡å‹æŒ‡æ ‡ (Accuracy)ã€‚

### 3. é™·é˜± (Anti-Patterns)
*   **Training-Serving Skew**: è®­ç»ƒç”¨æ‰¹é‡ç‰¹å¾ï¼Œé¢„æµ‹ç”¨å®æ—¶ç‰¹å¾ã€‚$\to$ å¿…é¡»ä¸Š **Feature Store**ã€‚
*   **é™æ€æ¨¡å‹**: å‡è®¾ä¸–ç•Œä¸å˜ã€‚$\to$ æ¨¡å‹å¿…é¡»æ˜¯**æ˜“è…å“**ï¼Œéœ€å®šæœŸåˆ·æ–°ã€‚

---

## æ¨¡å— IIIï¼šé«˜æ€§èƒ½å¼‚æ­¥ (High-Perf Async)
**ç›®æ ‡**ï¼šæ¦¨å¹²å•æ ¸ CPU ç­‰å¾…æ—¶é—´ (I/O Wait)ã€‚

### 1. å†³ç­–çŸ©é˜µ (Decision Matrix)
| åœºæ™¯ | ç“¶é¢ˆ | æ–¹æ¡ˆ | å…³é”®è¯ |
| :--- | :--- | :--- | :--- |
| **HTTP/DB/Net** | I/O ç­‰å¾… | **Asyncio** (åç¨‹) | `await`, `aiohttp`, EventLoop |
| **æ•°æ®è®¡ç®—/ML** | CPU è®¡ç®— | **Multiprocessing** | `ProcessPoolExecutor`, GIL Bypass |
| **æ··åˆåœºæ™¯** | I/O + Legacy | **Async + ThreadPool** | `run_in_executor` |

### 2. æ ¸å¿ƒä»£ç éª¨æ¶ (Skeleton)
```python
# é»„é‡‘æ³•åˆ™: 1. æ°¸ä¸é˜»å¡EventLoop 2. å¤ç”¨Session
async def main():
    # è¿æ¥æ± å¤ç”¨ (Critical)
    async with aiohttp.ClientSession() as session:
        tasks = [fetch(session, url) for url in urls]
        # å¹¶å‘æ§åˆ¶ (Scatter-Gather)
        results = await asyncio.gather(*tasks, return_exceptions=True)

# å¼‚å¸¸é˜²å¾¡
try:
    # å¿…é¡»è®¾ç½®è¶…æ—¶ï¼Œé˜²æ­¢åƒµå°¸ä»»åŠ¡
    await asyncio.wait_for(task, timeout=5.0)
except asyncio.TimeoutError:
    handle_timeout()
```

### 3. é™·é˜± (Anti-Patterns)
*   **åœ¨ async ä¸­ `time.sleep()`**: è‡´å‘½ã€‚$\to$ é˜»å¡æ•´ä¸ªçº¿ç¨‹ï¼Œå¿…é¡»ç”¨ `await asyncio.sleep()`ã€‚
*   **CPU å¯†é›†å‹ç”¨ async**: æ— æ•ˆã€‚$\to$ ä¾ç„¶å— GIL é™åˆ¶ï¼Œå¿…é¡»ç”¨å¤šè¿›ç¨‹ã€‚
*   **å¿½è§†èƒŒå‹**: æ— é™å¹¶å‘ $\to$ å†…å­˜çˆ†ç‚¸/ä¸‹æ¸¸å´©æºƒã€‚$\to$ ç”¨ `asyncio.Semaphore` é™åˆ¶å¹¶å‘æ•°ã€‚
