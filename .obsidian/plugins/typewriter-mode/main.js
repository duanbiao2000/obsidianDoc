var{defineProperty:pt,getOwnPropertyNames:ye,getOwnPropertyDescriptor:fe}=Object,be=Object.prototype.hasOwnProperty;var Pt=new WeakMap,Se=(t)=>{var e=Pt.get(t),i;if(e)return e;if(e=pt({},"__esModule",{value:!0}),t&&typeof t==="object"||typeof t==="function")ye(t).map((r)=>!be.call(e,r)&&pt(e,r,{get:()=>t[r],enumerable:!(i=fe(t,r))||i.enumerable}));return Pt.set(t,e),e};var Ce=(t,e)=>{for(var i in e)pt(t,i,{get:e[i],enumerable:!0,configurable:!0,set:(r)=>e[i]=()=>r})};var He={};Ce(He,{default:()=>At});module.exports=Se(He);var le=require("obsidian");var E="<!-- markdownlint-disable -->\n**Thank you for using Typewriter Mode!** If you like the plugin, please consider supporting me on [GitHub Sponsors](https://github.com/sponsors/davisriedel) or [buy me a coffee](https://www.buymeacoffee.com/davis.riedel). I am a computer science student and develop this plugin in my spare time. Your support will ensure the continuous development and maintenance of the plugin. <br> <a href=\"https://www.buymeacoffee.com/davis.riedel\" target=\"_blank\"><img src=\"https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png\" alt=\"Buy Me A Coffee\" style=\"height: 60px !important;width: 217px !important;\"></a> <br>\nIf you find any bugs or have a feature request, please don't hesitate to [open an issue on GitHub](https://github.com/davisriedel/obsidian-typewriter-mode/issues). You are also welcome to contribute to the project.\n";var Dt="# Typewriter Mode updated to v{{tag-name}}\n\n{{funding}}\n\n## What's new?\n\nHere's what's new since the last version you had installed:\n\n***\n\n{{release-notes}}\n";var Kt=require("obsidian"),v=require("obsidian");async function Le(t,e,i,r){let n=await fetch(`https://api.github.com/repos/${t}/${e}/releases`),o=await n.json();if(!n.ok&&"message"in o||!Array.isArray(o))throw new Error(`Failed to fetch releases: ${o.message??"Unknown error"}`);if(i==null)return o.filter((m)=>!m.draft&&!m.prerelease);let d=o.findIndex((m)=>m.tag_name===i);if(d===-1)throw new Error(`Could not find release with tag ${i}`);return o.slice(0,d).filter((m)=>!m.draft&&(r||!m.prerelease))}class ht extends v.Modal{e;i;constructor(t,e,i){super(t);this.currentVersion=e;this.previousVersion=i}fetchAndDisplayReleaseNotes(){let t=this.currentVersion.includes("-");Le("davisriedel","obsidian-typewriter-mode",this.previousVersion,t).then((e)=>{if(e.length===0)this.displayError(new Error("No new releases found"));else this.displayReleaseNotes(e)}).catch((e)=>{this.displayError(e)})}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Fetching release notes..."}),this.fetchAndDisplayReleaseNotes()}displayReleaseNotes(t){let{contentEl:e}=this;e.empty(),e.classList.add("ptm-update-modal-container");let i=e.createDiv("ptm-update-modal"),r=t.map((o)=>`### ${o.tag_name}\n\n${o.body}`).join("\n---\n"),n=Dt.replace("{{tag-name}}",t[0].tag_name).replace("{{funding}}",E).replace("{{release-notes}}",r);v.MarkdownRenderer.render(this.app,n,i,this.app.vault.getRoot().path,new Kt.Component)}displayError(t){let{contentEl:e}=this;e.empty(),e.classList.add("ptm-update-modal-container"),e.createDiv("ptm-update-modal").createEl("h2",{text:t.message})}}var Ot=require("@codemirror/state"),T=Ot.Facet.define({combine:(t)=>{if(t.length===0)return{cssVariables:{},bodyAttrs:{},bodyClasses:[],persistentBodyClasses:[],allBodyClasses:[]};return t[t.length-1]}});var L={version:null,isAnnounceUpdatesEnabled:!0,isPluginActivated:!0,isTypewriterScrollEnabled:!0,isOnlyActivateAfterFirstInteractionEnabled:!1,isOnlyMaintainTypewriterOffsetWhenReachedEnabled:!1,isTypewriterOnlyUseCommandsEnabled:!1,typewriterOffset:0.5,isKeepLinesAboveAndBelowEnabled:!1,linesAboveAndBelow:5,isMaxCharsPerLineEnabled:!1,maxCharsPerLine:64,isDimUnfocusedEnabled:!1,isDimHighlightListParentEnabled:!1,isDimTableAsOneEnabled:!0,dimUnfocusedMode:"paragraphs",dimUnfocusedEditorsBehavior:"dim",dimmedOpacity:0.25,isPauseDimUnfocusedWhileScrollingEnabled:!0,isPauseDimUnfocusedWhileSelectingEnabled:!0,isHighlightCurrentLineEnabled:!0,isFadeLinesEnabled:!1,fadeLinesIntensity:0.5,isHighlightCurrentLineOnlyInFocusedEditorEnabled:!1,currentLineHighlightStyle:"box",currentLineHighlightUnderlineThickness:1,"currentLineHighlightColor-dark":"#444","currentLineHighlightColor-light":"#ddd",doesWritingFocusShowHeader:!1,doesWritingFocusShowStatusBar:!1,doesWritingFocusShowVignette:!0,isWritingFocusFullscreen:!0,writingFocusVignetteStyle:"box"};var Vt=require("@codemirror/state"),g=Vt.Facet.define({combine:(t)=>{if(t.length===0)return L;return t[t.length-1]}});function c(t){return t.dom.ownerDocument.querySelector(".workspace-leaf.mod-active .cm-editor, .mod-inside-iframe .cm-editor")}function M(t){return t.dom.ownerDocument.querySelector(".workspace-leaf.mod-active .cm-scroller, .mod-inside-iframe .cm-scroller")}function gt(t){return t.dom.ownerDocument.querySelector(".workspace-leaf.mod-active .cm-sizer, .mod-inside-iframe .cm-sizer")}function Me(t,e){let i=t.contentDOM.querySelector(".cm-active.cm-line")?.getCssPropertyValue(e).replace("px","");if(!i)return null;return Number.parseFloat(i)}function $t(t,e){let i=e.top,r=c(t);if(!r)return 0;let n=r.getBoundingClientRect().top;return i-n}function xe(t){let e=c(t);if(!e)return 0;let i=t.state.facet(g).typewriterOffset;return e.clientHeight*i}function Ee(t){let e=t.coordsAtPos(t.state.selection.main.head);if(!e)return null;let i=e.bottom-e.top,r=Me(t,"line-height");if(!r)return null;let n=0,o=0;if(i>r)n=i,o=0;else n=r,o=(n-i)/2;let d=xe(t),m=$t(t,e),{isTypewriterScrollEnabled:l,isKeepLinesAboveAndBelowEnabled:u,isOnlyMaintainTypewriterOffsetWhenReachedEnabled:h}=t.state.facet(g),p=c(t),w=M(t),y;if(!p||!w)y=0;else if(l){if(y=d,h)if(m<0)y=0;else y=w.scrollTop+m<d?Math.min(d,m):d}else if(u){let{linesAboveAndBelow:Ht}=t.state.facet(g),Ut=t.defaultLineHeight*Ht,kt=p.clientHeight-t.defaultLineHeight*(Ht+1),ce=w.scrollTop!==0&&m<Ut,ue=m>kt;if(ce)y=Ut;else if(ue)y=kt;else y=m}else y=$t(t,e);return{typewriterOffset:d,scrollOffset:y,activeLineOffset:m,lineHeight:n,lineOffset:o}}function x(t,e,i){t.requestMeasure({key:e,read:(r)=>Ee(r),write:(r,n)=>{if(!r)return;window.requestAnimationFrame(()=>{i(r,n)})}})}var Wt=require("@codemirror/state"),jt=require("@codemirror/state"),A=require("@codemirror/view"),H=require("obsidian");var lt=require("@codemirror/view");function Bt(t,e,i){let r=!1;for(let n of e)if(t.slice(i+1-n.length,i+1)===n){r=!0;break}return r}function Ft(t,e,i){let r=t.sentenceDelimiters.split(""),n=t.extraCharacters.split(""),o=t.ignoredPatterns.split("\n"),d=e.from,m=e.text,l=-1;for(let h=i-d-1;h>=0;h--)if(r.contains(m[h])){if(Bt(m,o,h))continue;let p=1;while(m[h+p]===" "&&p<i-d-1)p+=1;while(n.contains(m[h+p])&&r.contains(m[h+p-1])&&p<i-d-1)p+=1;l=h+p;break}if(l===-1)l=0;let u=-1;for(let h=i-d;h<e.length;h++)if(r.contains(m[h])){if(Bt(m,o,h))continue;let p=1;while(r.contains(m[h+p])&&p<e.length)p+=1;while(n.contains(m[h+p])&&p<e.length)p+=1;u=h+p;break}if(u!==-1)return{start:l+d,end:u+d};return{start:l+d,end:null}}function It(t,e){let i=[],n=t.state.selection.main.from,o=t.state.doc.lineAt(n),d=Ft(e,o,n);if(d.end==null){if(n>o.from)d=Ft(e,o,n-1)}let{start:m,end:l}=d;if(l==null)l=o.to;function u(h,p,w){i.push(lt.Decoration.mark({inclusive:!0,attributes:{},class:w}).range(h,p))}if(m!==l){if(u(m,l,"active-sentence"),o.from!==m)u(o.from,m,"active-paragraph");if(l!==o.to)u(l,o.to,"active-paragraph")}return lt.Decoration.set(i,!0)}var ct="ptm-current-line",ut="ptm-current-line-fade-before",yt="ptm-current-line-fade-after";class qt{app;view;domResizeObserver=null;onScrollEventKey;isListeningToOnScroll=!1;isOnScrollClassSet=!1;isInitialInteraction=!0;isRenderingAllowedUserEvent=!1;decorations=Wt.RangeSet.empty;isPerWindowPropsReloadRequired=!1;constructor(t,e){this.app=t,this.view=e,this.onScrollEventKey=H.Platform.isMobile?"touchmove":"wheel",this.onLoad()}destroy(){this.domResizeObserver?.disconnect(),this.destroyCurrentLine(),this.removeScrollListener(),window.removeEventListener("moveByCommand",this.moveByCommand.bind(this))}onLoad(){this.domResizeObserver=new ResizeObserver(this.onResize.bind(this)),this.domResizeObserver.observe(this.view.dom.ownerDocument.body),window.addEventListener("moveByCommand",this.moveByCommand.bind(this)),this.watchEmbeddedMarkdown(),this.onReconfigured()}userEventAllowed(t){let{isTypewriterOnlyUseCommandsEnabled:e}=this.view.state.facet(g),i=/^(select|input|delete|undo|redo)(\..+)?$/,r=/^(select.pointer)$/;if(e)i=/^(input|delete|undo|redo)(\..+)?$/,r=/^(select)(\..+)?$/;return i.test(t)&&!r.test(t)}inspectTransactions(t){let e=[],i=!1;for(let n of t.transactions){if(n.reconfigured)i=!0;let o=n.annotation(jt.Transaction.userEvent);if(o!==void 0)e.push(o)}if(e.length===0)return{isReconfigured:i,isUserEvent:!1,allowedUserEvents:null};return{isReconfigured:!1,isUserEvent:!0,allowedUserEvents:e.reduce((n,o)=>{return n&&this.userEventAllowed(o)},e.length>0)}}update(t){let{isReconfigured:e,isUserEvent:i,allowedUserEvents:r}=this.inspectTransactions(t);if(this.isTableCell())return;if(e)this.onReconfigured();if(this.isDisabled())return;if(!i){this.updateNonUserEvent();return}r?this.updateAllowedUserEvent():this.updateDisallowedUserEvent()}isTableCell(){return this.view.dom.parentElement?.parentElement?.className.contains("table-cell-wrapper")??!1}isMarkdownFile(){let t=this.app.workspace.getActiveViewOfType(H.ItemView);if(!t)return this.isPerWindowPropsReloadRequired=!0,!1;return t.getViewType()==="markdown"}isDisabledInFrontmatter(){let t=this.app.workspace.getActiveFile();if(!t)return this.isPerWindowPropsReloadRequired=!0,!1;let e=this.app.metadataCache.getFileCache(t)?.frontmatter;if(!e)return!1;if(!Object.hasOwn(e,"typewriter-mode"))return!1;return!e["typewriter-mode"]}isDisabled(){let{isPluginActivated:t}=this.view.state.facet(g);if(!t)return!0;if(!this.isMarkdownFile())return!0;if(this.isDisabledInFrontmatter())return!0}onReconfigured(){if(this.isPerWindowPropsReloadRequired=!0,this.isDisabled())this.destroyCurrentLine(),this.resetPadding(this.view),this.loadPerWindowProps();else this.updateAfterExternalEvent()}watchEmbeddedMarkdown(){let e=this.view.state.facet(T);new MutationObserver((r)=>{r.forEach((n)=>{[].forEach.call(n.addedNodes,(o)=>{if(o.nodeType===Node.ELEMENT_NODE&&o.matches(".markdown-embed-content iframe.embed-iframe")){let d=o.contentDocument?.body;if(!d)return;this.loadPerWindowPropsOnElement(e,d)}})})}).observe(this.view.dom.ownerDocument,{childList:!0,subtree:!0})}loadPerWindowPropsOnElement(t,e){for(let i of t.allBodyClasses)e.classList.remove(i);if(e.addClasses(t.persistentBodyClasses),!this.isDisabled())e.addClasses(t.bodyClasses);e.setCssProps(t.cssVariables),e.setAttrs(t.bodyAttrs)}getMarkdownBodies(){let t=this.view.dom.ownerDocument.querySelectorAll(".markdown-embed-content iframe.embed-iframe"),e=Array.from(t).flatMap((i)=>{let r=i.contentDocument?.body;return r?[r]:[]});return[this.view.dom.ownerDocument.body,...e]}loadPerWindowProps(){if(!this.isPerWindowPropsReloadRequired)return;this.isPerWindowPropsReloadRequired=!1;let t=this.getMarkdownBodies(),e=this.view.state.facet(T);for(let i of t)this.loadPerWindowPropsOnElement(e,i)}loadCurrentLine(t=this.view){let e=c(t);if(!e)return null;let i=e.querySelector(`.${ct}`),r=t.state.facet(g);if(!i)i=document.createElement("div"),i.className=`${ct} ptm-current-line-highlight-${r.currentLineHighlightStyle}`,e.appendChild(i);if(r.isFadeLinesEnabled){let n=e.querySelector(`.${ut}`),o=e.querySelector(`.${yt}`);if(!n)n=document.createElement("div"),n.className=ut,e.appendChild(n);if(!o)o=document.createElement("div"),o.className=yt,e.appendChild(o);return{currentLine:i,fadeBefore:n,fadeAfter:o}}return{currentLine:i}}destroyCurrentLine(t=this.view){let e=c(t);if(!e)return;let i=e.querySelector(`.${ct}`),r=e.querySelector(`.${ut}`),n=e.querySelector(`.${yt}`);i?.remove(),r?.remove(),n?.remove()}setupScrollListener(){if(this.isListeningToOnScroll)return;let t=M(this.view);if(t)t.addEventListener(this.onScrollEventKey,this.onScroll.bind(this),{passive:!0}),this.isListeningToOnScroll=!0}removeScrollListener(){if(!this.isListeningToOnScroll)return;let t=M(this.view);if(t)t.removeEventListener(this.onScrollEventKey,this.onScroll),this.isListeningToOnScroll=!1}updateAllowedUserEvent(){this.applyDecorations(),this.removeScrollListener();let t=c(this.view);if(t){if(t.classList.remove("ptm-scroll"),this.isOnScrollClassSet=!1,t.classList.remove("ptm-select"),this.isInitialInteraction)t.classList.remove("ptm-first-open"),this.isInitialInteraction=!1}this.isRenderingAllowedUserEvent=!0,x(this.view,"TypewriterModeUpdateAfterAllowedUserEvent",(e,i)=>{if(!e)return;this.recenterAndMoveCurrentLine(i,e),this.isRenderingAllowedUserEvent=!1})}updateDisallowedUserEvent(){if(this.isRenderingAllowedUserEvent)return;let t=c(this.view);if(t){if(this.isInitialInteraction)t.classList.remove("ptm-first-open"),this.isInitialInteraction=!1;t.classList.add("ptm-select")}x(this.view,"TypewriterModeUpdateAfterDisallowedUserEvent",(e,i)=>{if(!e)return;let{activeLineOffset:r,lineHeight:n,lineOffset:o}=e,{isHighlightCurrentLineEnabled:d,isFadeLinesEnabled:m}=i.state.facet(g);if(d||m)this.moveCurrentLine(i,r,o,n)})}updateNonUserEvent(){if(this.applyDecorations(),!this.isInitialInteraction)return;let{isOnlyActivateAfterFirstInteractionEnabled:t}=this.view.state.facet(g);if(t){let e=c(this.view);if(e)e.classList.add("ptm-first-open")}}moveByCommand(){let t=c(this.view);if(t)t.classList.remove("ptm-select");this.updateAllowedUserEvent()}onResize(){if(this.isDisabled())return;this.updateAfterExternalEvent()}onScroll(){x(this.view,"TypewriterModeOnScroll",(t,e)=>{if(!this.isOnScrollClassSet){let o=c(this.view);if(o)o.classList.add("ptm-scroll"),this.isOnScrollClassSet=!0}if(!t)return;let{activeLineOffset:i,lineOffset:r,lineHeight:n}=t;this.moveCurrentLine(e,i,r,n)})}applyDecorations(){let{isDimUnfocusedEnabled:t,dimUnfocusedMode:e}=this.view.state.facet(g);if(!t||e!=="sentences")return;this.decorations=It(this.view,{sentenceDelimiters:".!?",extraCharacters:"*\u201C\u201D\u2018\u2019",ignoredPatterns:"Mr."})}updateAfterExternalEvent(){if(this.isTableCell()){this.destroyCurrentLine();return}this.loadPerWindowProps(),this.applyDecorations();let{isTypewriterScrollEnabled:t}=this.view.state.facet(g);x(this.view,"TypewriterModeUpdateAfterExternalEvent",(e,i)=>{if(this.setupScrollListener(),!e)return;if(t)this.setPadding(i,e.typewriterOffset);this.recenterAndMoveCurrentLine(i,e)})}moveCurrentLine(t,e,i,r){let n=this.loadCurrentLine(t);if(!n)return;if(n.currentLine.style.height=`${r}px`,n.currentLine.style.top=`${e-i}px`,n.fadeBefore)n.fadeBefore.style.top=`calc(${e-i}px - 100vh)`;if(n.fadeAfter)n.fadeAfter.style.top=`${e-i+r}px`}setPadding(t,e){let{isOnlyMaintainTypewriterOffsetWhenReachedEnabled:i}=t.state.facet(g),r=gt(t);if(!r)return;r.style.padding=i?`0 0 ${e}px 0`:`${e}px 0`}resetPadding(t){if(!this.isMarkdownFile())return;let e=gt(t);if(!e)return;e.style.removeProperty("padding")}recenter(t,e){let i=t.state.selection.main.head,r=A.EditorView.scrollIntoView(i,{y:"start",yMargin:e}),n=t.state.update({effects:r});t.dispatch(n)}recenterAndMoveCurrentLine(t,{scrollOffset:e,lineOffset:i,lineHeight:r}){let{isTypewriterScrollEnabled:n,isKeepLinesAboveAndBelowEnabled:o,isHighlightCurrentLineEnabled:d,isFadeLinesEnabled:m}=t.state.facet(g);if(n||o)this.recenter(t,e);if(d||m)this.moveCurrentLine(t,e,i,r)}}function ft(t){return A.ViewPlugin.define((e)=>{return new qt(t,e)},{decorations:(e)=>e.decorations})}var f=require("obsidian");class U extends f.PluginSettingTab{tm;constructor(t,e){super(t,e.plugin);this.tm=e}addHeading(t){return new f.Setting(this.containerEl).setName(t).setHeading()}addText(t){return new f.Setting(this.containerEl).setName(t)}display(){this.containerEl.empty();for(let e of Object.values(this.tm.features.general))e.registerSetting(this);if(this.addHeading("Typewriter"),this.tm.settings.isKeepLinesAboveAndBelowEnabled)this.addText("Not available if \"keep lines above and below\" is activated");for(let e of Object.values(this.tm.features.typewriter))e.registerSetting(this);if(this.addHeading("Keep lines above and below"),this.tm.settings.isTypewriterScrollEnabled)this.addText("Not available if typewriter scrolling is activated");for(let e of Object.values(this.tm.features.keepAboveAndBelow))e.registerSetting(this);this.addHeading("Highlight current line");for(let e of Object.values(this.tm.features.currentLine))e.registerSetting(this);this.addHeading("Dimming");for(let e of Object.values(this.tm.features.dimming))e.registerSetting(this);this.addHeading("Limit line width");for(let e of Object.values(this.tm.features.maxChar))e.registerSetting(this);this.addHeading("Writing focus");for(let e of Object.values(this.tm.features.writingFocus))e.registerSetting(this);this.addHeading("Update notice and funding");for(let e of Object.values(this.tm.features.updates))e.registerSetting(this);let t=this.containerEl.createDiv();this.containerEl.appendChild(t),f.MarkdownRenderer.render(this.app,E,t,this.app.vault.getRoot().path,new f.Component)}}var Gt=require("obsidian");class S{t;constructor(t){this.tm=t}load(){}}class a extends S{enable(){}disable(){}getSettingKey(){return this.settingKey}getSettingValue(){return this.tm.settings[this.settingKey]}}class s extends a{toggleClass=null;isToggleClassPersistent=!1;isSettingEnabled(){return!0}getToggleClass(){return this.toggleClass}registerSetting(t){new Gt.Setting(t.containerEl).setName(this.settingTitle).setDesc(this.settingDesc).setClass("typewriter-mode-setting").addToggle((e)=>e.setValue(this.getSettingValue()).onChange((i)=>{this.toggle(i),t.display()})).setDisabled(!this.isSettingEnabled())}load(){this.tm.settings[this.settingKey]?this.enable():this.disable()}toggle(t=null){let e=t;if(e===null)e=!this.getSettingValue();this.tm.settings={...this.tm.settings,[this.settingKey]:e},e?this.enable():this.disable(),this.tm.saveSettings().then()}enable(){if(this.toggleClass){let t=this.isToggleClassPersistent?"persistentBodyClasses":"bodyClasses";if(!this.tm.perWindowProps[t].contains(this.toggleClass))this.tm.perWindowProps[t].push(this.toggleClass)}}disable(){if(this.toggleClass){let t=this.isToggleClassPersistent?"persistentBodyClasses":"bodyClasses";this.tm.perWindowProps[t].remove(this.toggleClass)}}}function ve(t){return t.charAt(0).toUpperCase()+t.slice(1)}class bt extends S{load(){for(let t of["up","down"])this.tm.plugin.addCommand({id:`move-typewriter-${t}`,name:`Move typewriter ${t}`,hotkeys:[{modifiers:["Mod"],key:t==="up"?"ArrowUp":"ArrowDown"}],editorCallback:(e,i)=>this.onCommand(e,t)})}onCommand(t,e){t.exec(`go${ve(e)}`),window.dispatchEvent(new Event("moveByCommand"))}}class St extends S{}class Ct extends St{registerCommand(){this.tm.plugin.addCommand({id:this.commandKey,name:this.commandTitle,callback:this.onCommand.bind(this)})}load(){this.registerCommand()}}class b extends Ct{registerCommand(){this.tm.plugin.addCommand({id:`${this.commandKey}-toggle`,name:`Toggle ${this.commandTitle}`,callback:this.onCommand.bind(this)}),this.tm.plugin.addCommand({id:`${this.commandKey}-enable`,name:`Enable ${this.commandTitle}`,callback:this.onEnable.bind(this)}),this.tm.plugin.addCommand({id:`${this.commandKey}-disable`,name:`Disable ${this.commandTitle}`,callback:this.onDisable.bind(this)})}onCommand(){this.featureToggle?.toggle()}onEnable(){this.featureToggle?.toggle(!0)}onDisable(){this.featureToggle?.toggle(!1)}}class wt extends b{commandKey="dimming";commandTitle="dimming";featureToggle=this.tm.features.dimming.isDimUnfocusedEnabled}class Tt extends b{commandKey="typewriter";commandTitle="typewriter scrolling";featureToggle=this.tm.features.typewriter.isTypewriterScrollEnabled}class Lt extends b{featureToggle=null;commandKey="typewriter-scrolling-and-paragraph-dimming";commandTitle="typewriter scrolling and paragraph dimming";onCommand(){let t=this.tm.features.typewriter.isTypewriterScrollEnabled,e=this.tm.features.dimming.isDimUnfocusedEnabled,i=t.getSettingValue()&&e.getSettingValue();t.toggle(!i),e.toggle(!i)}onEnable(){this.tm.features.typewriter.isTypewriterScrollEnabled.toggle(!0),this.tm.features.dimming.isDimUnfocusedEnabled.toggle(!0)}onDisable(){this.tm.features.typewriter.isTypewriterScrollEnabled.toggle(!1),this.tm.features.dimming.isDimUnfocusedEnabled.toggle(!1)}}var Mt=require("obsidian"),xt=require("obsidian");class Et{tm;constructor(t){this.tm=t}focusModeActive=!1;maximizedClass="ptm-maximized";focusModeClass="ptm-focus-mode";vignetteElClass="ptm-writing-focus-vignette-element";vignetteStyleAttr="data-ptm-writing-focus-vignette-style";leftSplitCollapsed=!1;rightSplitCollapsed=!1;prevWasFullscreen=!1;addVignette(t){let e=this.tm.settings.doesWritingFocusShowHeader?t.containerEl:t.contentEl;e.classList.add(this.vignetteElClass),e.setAttr(this.vignetteStyleAttr,this.tm.settings.writingFocusVignetteStyle)}removeVignette(t){let e=this.tm.settings.doesWritingFocusShowHeader?t.containerEl:t.contentEl;e.removeAttribute(this.vignetteStyleAttr),e.classList.remove(this.vignetteElClass)}startFullscreen(t){if(xt.Platform.isMobile)return;let e=window.electron.remote.getCurrentWindow();this.prevWasFullscreen=e.isFullScreen(),e.setFullScreen(!0);let i=()=>{this.onExitFullscreenWritingFocus(t),e.off("leave-full-screen",i)};e.on("leave-full-screen",i)}exitFullscreen(){if(xt.Platform.isMobile)return;if(this.prevWasFullscreen)return;window.electron.remote.getCurrentWindow().setFullScreen(!1)}onExitFullscreenWritingFocus(t){if(this.focusModeActive)this.disableFocusModeForView(t)}storeSplitsValues(){this.leftSplitCollapsed=this.tm.plugin.app.workspace.leftSplit.collapsed,this.rightSplitCollapsed=this.tm.plugin.app.workspace.rightSplit.collapsed}collapseSplits(){this.tm.plugin.app.workspace.leftSplit.collapse(),this.tm.plugin.app.workspace.rightSplit.collapse()}restoreSplits(){if(!this.leftSplitCollapsed)this.tm.plugin.app.workspace.leftSplit.expand();if(!this.rightSplitCollapsed)this.tm.plugin.app.workspace.rightSplit.expand()}removeExtraneousClasses(){if(this.tm.plugin.app.workspace.containerEl.hasClass(this.maximizedClass))this.tm.plugin.app.workspace.containerEl.removeClass(this.maximizedClass);if(document.body.classList.contains(this.focusModeClass))document.body.classList.remove(this.focusModeClass)}enableFocusModeForView(t){if(this.focusModeActive=!0,!document.body.classList.contains(this.focusModeClass))this.storeSplitsValues();if(this.collapseSplits(),this.tm.plugin.app.workspace.containerEl.toggleClass(this.maximizedClass,!this.tm.plugin.app.workspace.containerEl.hasClass(this.maximizedClass)),document.body.classList.toggle(this.focusModeClass,!document.body.classList.contains(this.focusModeClass)),document.body.classList.contains(this.focusModeClass))Array.from(document.querySelectorAll(`.${this.focusModeClass} .workspace-split`)).forEach((e)=>{let i=e;if(i.querySelector(".mod-active"))i.style.display="flex";else i.style.display="none"});if(this.tm.settings.doesWritingFocusShowVignette)this.addVignette(t);if(this.tm.settings.isWritingFocusFullscreen)this.startFullscreen(t)}disableFocusModeForView(t){if(this.removeExtraneousClasses(),document.body.classList.contains(this.focusModeClass))document.body.classList.remove(this.focusModeClass);if(this.restoreSplits(),Array.from(document.querySelectorAll(".workspace-split")).forEach((e)=>{let i=e;i.style.display="flex"}),this.tm.settings.doesWritingFocusShowVignette)this.removeVignette(t);if(this.tm.settings.isWritingFocusFullscreen)this.exitFullscreen();this.focusModeActive=!1}enableFocusMode(){let t=this.tm.plugin.app.workspace.getActiveViewOfType(Mt.ItemView);if(!t||t?.getViewType()==="empty")return;this.enableFocusModeForView(t)}disableFocusMode(){let t=this.tm.plugin.app.workspace.getActiveViewOfType(Mt.ItemView);if(!t||t?.getViewType()==="empty")return;this.disableFocusModeForView(t)}toggleFocusMode(){this.focusModeActive?this.disableFocusMode():this.enableFocusMode()}}class vt extends b{featureToggle=null;commandKey="writing-focus";commandTitle="writing focus";writingFocus=new Et(this.tm);onCommand(){this.writingFocus.toggleFocusMode()}onEnable(){this.writingFocus.enableFocusMode()}onDisable(){this.writingFocus.disableFocusMode()}async onload(){this.tm.plugin.addRibbonIcon("enter","Toggle Writing Focus",(t)=>{this.writingFocus.toggleFocusMode()})}}function zt(t){return[Tt,wt,Lt,bt,vt].reduce((e,i)=>{let r=new i(t);return e[r.commandKey]=new i(t),e},{})}function Ae(t,e){return Object.fromEntries(Object.entries(t).map(([i,r],n)=>[i,e(r,i,n)]))}function Yt(t,e){return Ae(e,(i)=>{return i.reduce((r,n)=>{let o=new n(t);return r[o.settingKey]=o,r},{})})}var _t=require("obsidian");class C extends a{settingKey;themeMode;constructor(t,e){super(t);this.themeMode=e,this.settingKey=`currentLineHighlightColor-${e}`}registerSetting(t){new _t.Setting(t.containerEl).setName(`Current line highlight color in ${this.themeMode} themes`).setDesc(`The color of the current line highlight in ${this.themeMode} themes`).setClass("typewriter-mode-setting").addText((e)=>e.setValue(this.getSettingValue()).onChange((i)=>{this.changeCurrentLineHighlightColor(i)}))}load(){this.tm.setCSSVariable(`--current-line-highlight-color-${this.themeMode}`,`${this.getSettingValue()}`)}changeCurrentLineHighlightColor(t){this.tm.settings[this.settingKey]=t,this.tm.setCSSVariable(`--current-line-highlight-color-${this.themeMode}`,`${t}`),this.tm.saveSettings().then()}}class k extends C{constructor(t){super(t,"dark")}}class P extends C{constructor(t){super(t,"light")}}var Jt=require("obsidian");class D extends a{settingKey="currentLineHighlightStyle";registerSetting(t){new Jt.Setting(t.containerEl).setName("Current line highlight style").setDesc("The style of the current line highlight").setClass("typewriter-mode-setting").addDropdown((e)=>e.addOption("box","Box").addOption("underline","Underline").setValue(this.tm.settings.currentLineHighlightStyle).onChange((i)=>{this.changeCurrentLineHighlightStyle(i),t.display()}))}changeCurrentLineHighlightStyle(t){this.tm.settings.currentLineHighlightStyle=t,this.tm.saveSettings().then()}}var Qt=require("obsidian");class K extends a{settingKey="currentLineHighlightUnderlineThickness";registerSetting(t){new Qt.Setting(t.containerEl).setName("Current line underline thickness").setDesc("The thickness of the underline that highlights the current line").setClass("typewriter-mode-setting").addSlider((e)=>e.setLimits(1,5,1).setDynamicTooltip().setValue(this.tm.settings.currentLineHighlightUnderlineThickness).onChange((i)=>{this.changeCurrentLineHighlightUnderlineThickness(i)}))}load(){this.tm.setCSSVariable("--current-line-highlight-underline-thickness",`${this.tm.settings.currentLineHighlightUnderlineThickness}px`)}changeCurrentLineHighlightUnderlineThickness(t){this.tm.settings.currentLineHighlightUnderlineThickness=t,this.tm.setCSSVariable("--current-line-highlight-underline-thickness",`${t}px`),this.tm.saveSettings()}}class O extends s{settingKey="isFadeLinesEnabled";toggleClass="ptm-fade-lines";settingTitle="Fade lines";settingDesc="This places a gradient on the lines above and below the current line, making the text fade out more and more towards the top and bottom of the editor."}var Xt=require("obsidian");class V extends a{settingKey="fadeLinesIntensity";registerSetting(t){new Xt.Setting(t.containerEl).setName("Intensity of the fade lines gradient").setDesc("How soon lines shall be faded out").setClass("typewriter-mode-setting").addSlider((e)=>e.setLimits(0,100,5).setDynamicTooltip().setValue(this.tm.settings.fadeLinesIntensity*100).onChange((i)=>{this.changeFadeLinesIntensity(i/100)}))}load(){this.tm.setCSSVariable("--ptm-fade-lines-intensity",`${this.tm.settings.fadeLinesIntensity*100}%`)}changeFadeLinesIntensity(t=0.5){this.tm.settings.fadeLinesIntensity=t,this.tm.setCSSVariable("--ptm-fade-lines-intensity",`${t*100}%`),this.tm.saveSettings()}}class $ extends s{settingKey="isHighlightCurrentLineEnabled";toggleClass="ptm-highlight-current-line";settingTitle="Highlight current line";settingDesc="Highlights the line that the cursor is currently on"}class B extends s{settingKey="isHighlightCurrentLineOnlyInFocusedEditorEnabled";toggleClass="ptm-highlight-current-line-only-in-active-editor";hasCommand=!1;settingTitle="Highlight current line only in focused note";settingDesc="Only show highlighted line in the note your cursor is on (e.g. if you have multiple notes open in split panes)"}var Zt=[$,O,V,P,k,D,K,B];class F extends s{settingKey="isDimHighlightListParentEnabled";toggleClass="ptm-dim-highlight-list-parent";settingTitle="Highlight list parents";settingDesc="If this is enabled, the parent items of the active list item are not dimmed"}class I extends s{settingKey="isDimTableAsOneEnabled";toggleClass="ptm-dim-table-as-one";settingTitle="Undim all table cells when editing";settingDesc="If this is enabled, all table cells are shown/not dimmed when you edit a table. If this is disabled, only the current table cell that you are editing is shown, while the other cells remain dimmed."}class W extends s{settingKey="isDimUnfocusedEnabled";toggleClass="ptm-dim-unfocused";settingTitle="Dim unfocused";settingDesc="Dim unfocused paragraphs / sentences"}var Rt=require("obsidian");class j extends a{settingKey="dimUnfocusedEditorsBehavior";registerSetting(t){new Rt.Setting(t.containerEl).setName("Dimming behavior in unfocused notes").setDesc("How to dim paragraphs / sentences in notes / editors that your cursor is not on (e.g. if you have multiple notes open in split panes)").setClass("typewriter-mode-setting").addDropdown((e)=>e.addOption("dim-none","Do not dim anything").addOption("dim","Dim all but the previously focused paragraph / sentence").addOption("dim-all","Dim everything").setValue(this.tm.settings.dimUnfocusedEditorsBehavior).onChange((i)=>{this.changeDimUnfocusedEditorsBehavior(i),t.display()}))}load(){super.load(),this.tm.perWindowProps.bodyAttrs["data-ptm-dim-unfocused-editors-behavior"]=this.tm.settings.dimUnfocusedEditorsBehavior}changeDimUnfocusedEditorsBehavior(t){this.tm.settings.dimUnfocusedEditorsBehavior=t,this.tm.perWindowProps.bodyAttrs["data-ptm-dim-unfocused-editors-behavior"]=t,this.tm.saveSettings().then()}}var Nt=require("obsidian");class q extends a{settingKey="dimUnfocusedMode";registerSetting(t){new Nt.Setting(t.containerEl).setName("Dim unfocused mode").setDesc("Choose to dim unfocused paragraphs or sentences").setClass("typewriter-mode-setting").addDropdown((e)=>e.addOption("paragraphs","Paragraphs").addOption("sentences","Sentences").setValue(this.tm.settings.dimUnfocusedMode).onChange((i)=>{this.change(i),t.display()}))}load(){super.load(),this.tm.perWindowProps.bodyAttrs["data-ptm-dim-unfocused-mode"]=this.tm.settings.dimUnfocusedMode}change(t){this.tm.settings.dimUnfocusedMode=t,this.tm.perWindowProps.bodyAttrs["data-ptm-dim-unfocused-mode"]=this.tm.settings.dimUnfocusedMode,this.tm.saveSettings().then()}}var te=require("obsidian");class G extends a{settingKey="dimmedOpacity";registerSetting(t){new te.Setting(t.containerEl).setName("Opacity of dimmed elements").setDesc("The opacity of dimmed elements").setClass("typewriter-mode-setting").addSlider((e)=>e.setLimits(0,100,5).setDynamicTooltip().setValue(this.tm.settings.dimmedOpacity*100).onChange((i)=>{this.changeDimmedOpacity(i/100)}))}load(){this.tm.setCSSVariable("--dimmed-opacity",`${this.tm.settings.dimmedOpacity}`)}changeDimmedOpacity(t=0.25){this.tm.settings.dimmedOpacity=t,this.tm.setCSSVariable("--dimmed-opacity",`${t}`),this.tm.saveSettings()}}class z extends s{settingKey="isPauseDimUnfocusedWhileScrollingEnabled";toggleClass="ptm-dim-unfocused-pause-while-scrolling";settingTitle="Pause dimming while scrolling";settingDesc="If this is enabled, paragraphs / sentences are not dimmed while scrolling"}class Y extends s{settingKey="isPauseDimUnfocusedWhileSelectingEnabled";toggleClass="ptm-dim-unfocused-pause-while-selecting";settingTitle="Pause dimming while selecting text";settingDesc="If this is enabled, paragraphs / sentences are not dimmed while selecting text"}var ee=[W,q,F,I,G,z,Y,j];class _ extends s{settingKey="isOnlyActivateAfterFirstInteractionEnabled";settingTitle="Only activate after first interaction";settingDesc="Activate the focused line highlight and paragraph dimming only after the first interaction with the editor"}class J extends s{settingKey="isPluginActivated";toggleClass="ptm-plugin-activated";settingTitle="Activate Typewriter Mode";settingDesc="This enables or disables all the features below."}var ie=[J,_];class Q extends s{settingKey="isKeepLinesAboveAndBelowEnabled";settingTitle="Keep lines above and below";settingDesc="When enabled, always keeps the specified amount of lines above and below the current line in view";isSettingEnabled(){return!this.tm.settings.isTypewriterScrollEnabled}}var re=require("obsidian");class X extends a{settingKey="linesAboveAndBelow";registerSetting(t){new re.Setting(t.containerEl).setName("Amount of lines above and below the current line").setDesc("The amount of lines to always keep above and below the current line").setClass("typewriter-mode-setting").addText((e)=>e.setValue(this.tm.settings.linesAboveAndBelow.toString()).onChange((i)=>{this.changeAmountOfLinesAboveAndBelow(Number.parseInt(i))}))}changeAmountOfLinesAboveAndBelow(t){this.tm.settings.linesAboveAndBelow=t,this.tm.saveSettings().then()}}var ne=[Q,X];class Z extends s{settingKey="isMaxCharsPerLineEnabled";toggleClass="ptm-max-chars-per-line";isToggleClassPersistent=!0;settingTitle="Limit maximum number of characters per line";settingDesc="Limits the maximum number of characters per line"}var oe=require("obsidian");class R extends a{settingKey="maxCharsPerLine";registerSetting(t){new oe.Setting(t.containerEl).setName("Maximum number of characters per line").setDesc("The maximum number of characters per line").setClass("typewriter-mode-setting").addText((e)=>e.setValue(this.tm.settings.maxCharsPerLine.toString()).onChange((i)=>{this.changeMaxCharsPerLine(Number.parseInt(i))}))}load(){this.tm.setCSSVariable("--max-chars-per-line",`${this.tm.settings.maxCharsPerLine}ch`)}changeMaxCharsPerLine(t){this.tm.settings.maxCharsPerLine=t,this.tm.setCSSVariable("--max-chars-per-line",`${t}ch`),this.tm.saveSettings()}}var se=[Z,R];class N extends s{settingKey="isOnlyMaintainTypewriterOffsetWhenReachedEnabled";hasCommand=!1;settingTitle="Only maintain typewriter offset when reached";settingDesc="The line that the cursor is on will not be scrolled to the center of the editor until it the specified typewriter offset is reached. This removes the additional space at the top of the editor."}var me=require("obsidian");class tt extends a{settingKey="typewriterOffset";registerSetting(t){new me.Setting(t.containerEl).setName("Typewriter offset").setDesc("Positions the typewriter line at the specified percentage of the screen").setClass("typewriter-mode-setting").addSlider((e)=>e.setLimits(0,100,5).setDynamicTooltip().setValue(this.tm.settings.typewriterOffset*100).onChange((i)=>{this.changeTypewriterOffset(i/100)}))}changeTypewriterOffset(t){this.tm.settings.typewriterOffset=t,this.tm.saveSettings().then()}}class et extends s{settingKey="isTypewriterOnlyUseCommandsEnabled";toggleClass="ptm-typewriter-only-use-commands";settingTitle="Do not snap typewriter with arrow keys";settingDesc="The typewriter will only snap when using this plugin's move commands. It will not snap when using the arrow keys. The move commands are by default Cmd/Ctrl+ArrowUp/ArrowDown, but you can assign your own hotkeys for the move commands in Obsidian's settings."}class it extends s{settingKey="isTypewriterScrollEnabled";toggleClass="ptm-typewriter-scroll";settingTitle="Typewriter scrolling";settingDesc="Turns typewriter scrolling on or off";isSettingEnabled(){return!this.tm.settings.isKeepLinesAboveAndBelowEnabled}}var de=[it,tt,N,et];class rt extends s{settingKey="isAnnounceUpdatesEnabled";toggleClass="ptm-announce-updates";settingTitle="Announce updates";settingDesc="If enabled you will get a notice with release notes whenever you install a new version of Typewriter Mode"}var ae=[rt];class nt extends s{settingKey="isWritingFocusFullscreen";settingTitle="Make Obsidian fullscreen in writing focus";settingDesc="If enabled, the Obsidian window will toggle to fullscreen when entering writing focus"}class ot extends s{settingKey="doesWritingFocusShowHeader";toggleClass="ptm-writing-focus-shows-header";settingTitle="Show header in writing focus";settingDesc="If enabled, the header will be shown in writing focus"}class st extends s{settingKey="doesWritingFocusShowStatusBar";toggleClass="ptm-writing-focus-shows-status-bar";settingTitle="Show status bar in writing focus";settingDesc="If enabled, the status bar will be shown in writing focus"}class mt extends s{settingKey="doesWritingFocusShowVignette";settingTitle="Writing focus vignette";settingDesc="Add a vignette to the edges of the screen in writing focus"}var pe=require("obsidian");class dt extends a{settingKey="writingFocusVignetteStyle";registerSetting(t){new pe.Setting(t.containerEl).setName("Writing focus vignette style").setDesc("The style of the vignette in writing focus mode").setClass("typewriter-mode-setting").addDropdown((e)=>e.addOption("box","Box").addOption("column","Column").setValue(this.tm.settings.writingFocusVignetteStyle).onChange((i)=>{this.changeVignetteStyle(i),t.display()}))}changeVignetteStyle(t){this.tm.settings.writingFocusVignetteStyle=t,this.tm.saveSettings().then()}}var he=[ot,st,nt,mt,dt];function ge(t){return Yt(t,{currentLine:Zt,dimming:ee,general:ie,keepAboveAndBelow:ne,maxChar:se,typewriter:de,updates:ae,writingFocus:he})}class at{plugin;loadData;saveData;settings=L;perWindowProps={cssVariables:{},bodyClasses:[],bodyAttrs:{},allBodyClasses:[],persistentBodyClasses:[]};editorExtensions;features;commands;constructor(t,e,i){this.plugin=t,this.loadData=e,this.saveData=i,this.features=ge(this),this.commands=zt(this),this.editorExtensions=[ft(this.plugin.app),[]]}async load(){await this.loadSettings(),await this.saveSettings(),this.loadPerWindowProps(),this.loadEditorExtension()}loadPerWindowProps(){this.perWindowProps.allBodyClasses=[];for(let t of Object.values(this.features))for(let e of Object.values(t))if(e.load(),e instanceof s){let i=e.getToggleClass();if(i)this.perWindowProps.allBodyClasses.push(i)}for(let t of Object.values(this.commands))t.load();this.updateFacets()}loadEditorExtension(){this.plugin.registerEditorExtension(this.editorExtensions)}loadSettingsTab(){this.plugin.addSettingTab(new U(this.plugin.app,this))}unload(){for(let t of Object.values(this.features))for(let e of Object.values(t))e.disable()}updateFacets(){this.editorExtensions[1]=[g.of(this.settings),T.of(this.perWindowProps)]}async loadSettings(){let t=await this.loadData();this.settings=Object.assign(L,t)}async saveSettings(){await this.saveData(this.settings),this.updateFacets(),this.plugin.app.workspace.updateOptions()}setCSSVariable(t,e){this.perWindowProps.cssVariables[t]=e}}class At extends le.Plugin{tm;constructor(t,e){super(t,e);this.tm=new at(this,async()=>await this.loadData(),async(i)=>await this.saveData(i))}async onload(){await this.tm.load(),this.tm.loadSettingsTab(),this.app.workspace.onLayoutReady(()=>{this.announceUpdate()})}onunload(){this.tm.unload()}announceUpdate(){let t=this.manifest.version,e=this.tm.settings.version??"";if(t===e)return;if(this.tm.settings.version=t,this.tm.saveSettings().then(),this.tm.settings.isAnnounceUpdatesEnabled===!1)return;new ht(this.app,t,e).open()}}

/* nosourcemap */