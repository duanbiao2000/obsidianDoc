---
aliases:

---
Elastic中的主要概念和关系型数据库的对应关系如下:
 
| Elastic概念 | 说明 | 关系型数据库对应 |
|-|-|-|
| indices | 索引,相当于数据库 | 数据库 |
| types | 类型,相当于表 | 表 | 
| documents | 文档,相当于表中的一行记录 | 记录/行 |
| fields | 字段,文档中的属性 | 字段/列 |

详细解释:

| indices   | 索引是Elasticsearch中保存和管理文档的基本容器,相当于关系数据库中的数据库。一个索引可以包含多个类型。              |
| --------- | ---------------------------------------------------------------------- |
| types     | 类型是逻辑分类,可以理解为表,一个索引可以包含多个类型,每个类型可以有不同的结构。Elasticsearch 6.0后废弃了types概念。 |
| documents | 文档是数据的基本单位,相当于表中的一行记录,它包含一个或多个字段。                                      |
| fields    | 字段是文档的组成部分,相当于表中的字段(列)。字段定义了文档中数据的结构和类型。                               |

关系型数据库中的表结构需要预定义,而Elasticsearch中的类型和字段可以动态添加,更加灵活。
索引、类型、文档和字段是Elasticsearch中最基本和重要的概念,了解它们可以帮助理解Elasticsearch的工作原理和使用方法。



```js
/* eslint-disable complexity */

// 自动加载监控逻辑
(function (uam_win, uam_config) {
  try {
    var current_area_code = 800000

    //= ==============数据主动发送start=================================================================================
    // 主动发送通用信息
    uam_xy_obj.sendCommonInfo = function (message) {
      try {
        for (var attr in message) {
          if (uam_config.getCookie('uam_config_' + attr) != message[attr]) {
            uam_config.updateCookie('uam_config_' + attr, message[attr])
          } else {
            uam_config.createCookie('uam_config_' + attr, message[attr], 1)
          }
        }
      } catch (error) {
      }
    }

    // 主动发送业务信息
    uam_xy_obj.sendBusiInfo = function (message) {
      uam_xy_obj.businessJson = message
    }

    // 主动发送自定义数据
    uam_xy_obj.sendCustomInfo = function (message) {
      var loginName = uam_config.uam_sendBaseConfig.uam_username
      if (typeof (loginName) === 'undefined') {
        uam_setLoginName = findPaq('setLoginName')
        uam_config.uam_sendBaseConfig.uam_username = emptifyNull(uam_setLoginName)
      }
      var uam_sendBaseConfig = uam_config.uam_sendBaseConfig
      var uam_message = message
      var uam_elementAttrs = uam_config.elementAttrs

      var resultJsonObject = {}
      for (var attr in uam_sendBaseConfig) {
        resultJsonObject[attr] = uam_sendBaseConfig[attr]
      }
      for (var attr in uam_message) {
        resultJsonObject[attr] = uam_message[attr]
      }
      for (var attr in uam_elementAttrs) {
        resultJsonObject[attr] = uam_elementAttrs[attr]
      }

      serverUrl = serverUrl.replace('sendqueue', 'postqueque')

      var xhr
      if (window.ActiveXObject) {
        try {
          xhr = new window.ActiveXObject('Microsoft.XMLHTTP'), xhr.onreadystatechange = function () { },
          xhr.open('POST', serverUrl, !0), xhr.send(tianyan_stringify(resultJsonObject))

          const xhr1 = new window.ActiveXObject('Microsoft.XMLHTTP')
          xhr1.onreadystatechange = function () { },
          xhr1.open('POST', forum_url, !0),
          xhr1.setRequestHeader('Authorization', 'Basic ZWxhc3RpYzo4bkRmSzQ4UzhjMmhEaDkyRkw4QzhmSTg='),
          xhr1.setRequestHeader('Content-Type', 'Application/json'),
          xhr1.send(tianyan_stringify({ ...resultJsonObject, forumType: 'postqueque' }))
        } catch (e) {

        }
      } else if (window.XMLHttpRequest) {
        try {
          xhr = new XMLHttpRequest(), xhr.onreadystatechange = function () { },
          xhr.open('POST', serverUrl, !0), xhr.send(tianyan_stringify(resultJsonObject))

          const xhr1 = new XMLHttpRequest()
          xhr1.onreadystatechange = function () { },
          xhr1.open('POST', forum_url, !0),
          xhr1.setRequestHeader('Authorization', 'Basic ZWxhc3RpYzo4bkRmSzQ4UzhjMmhEaDkyRkw4QzhmSTg='),
          xhr1.setRequestHeader('Content-Type', 'Application/json'),
          xhr1.send(tianyan_stringify({ ...resultJsonObject, forumType: 'postqueque' }))
        } catch (e) {
        }
      }
    }
    //= ==============数据主动发送end=================================================================================

    //= ==============植入浏览器信息采集start=================================================================================

    uam_xy_obj.loadBroserFinder = function () {
      var _navigator = window.navigator
      var u = _navigator.userAgent || {}
      var _this = this
      var _window = window
      var _mime = function (option, value) {
        var mimeTypes = _navigator.mimeTypes
        for (var mt in mimeTypes) {
          if (mimeTypes[mt][option] == value) {
            return true
          }
        }
        return false
      }

      var match = {
        // 内核
        'Trident': u.indexOf('Trident') > -1 || u.indexOf('NET CLR') > -1,
        'Presto': u.indexOf('Presto') > -1,
        'WebKit': u.indexOf('AppleWebKit') > -1,
        'Gecko': u.indexOf('Gecko/') > -1,
        // 浏览器
        'Safari': u.indexOf('Safari') > -1,
        'Chrome': u.indexOf('Chrome') > -1 || u.indexOf('CriOS') > -1,
        'IE': u.indexOf('MSIE') > -1 || u.indexOf('Trident') > -1,
        'Edge': u.indexOf('Edge') > -1 || u.indexOf('Edg/') > -1,
        'Firefox': u.indexOf('Firefox') > -1 || u.indexOf('FxiOS') > -1,
        'Firefox Focus': u.indexOf('Focus') > -1,
        'Chromium': u.indexOf('Chromium') > -1,
        'Opera': u.indexOf('Opera') > -1 || u.indexOf('OPR') > -1,
        'Vivaldi': u.indexOf('Vivaldi') > -1,
        'Yandex': u.indexOf('YaBrowser') > -1,
        'Arora': u.indexOf('Arora') > -1,
        'Lunascape': u.indexOf('Lunascape') > -1,
        'QupZilla': u.indexOf('QupZilla') > -1,
        'Coc Coc': u.indexOf('coc_coc_browser') > -1,
        'Kindle': u.indexOf('Kindle') > -1 || u.indexOf('Silk/') > -1,
        'Iceweasel': u.indexOf('Iceweasel') > -1,
        'Konqueror': u.indexOf('Konqueror') > -1,
        'Iceape': u.indexOf('Iceape') > -1,
        'SeaMonkey': u.indexOf('SeaMonkey') > -1,
        'Epiphany': u.indexOf('Epiphany') > -1,
        '360': u.indexOf('QihooBrowser') > -1 || u.indexOf('QHBrowser') > -1,
        '360EE': u.indexOf('360EE') > -1,
        '360SE': u.indexOf('360SE') > -1,
        'UC': u.indexOf('UC') > -1 || u.indexOf(' UBrowser') > -1,
        'QQBrowser': u.indexOf('QQBrowser') > -1,
        'QQ': u.indexOf('QQ/') > -1,
        'Baidu': u.indexOf('Baidu') > -1 || u.indexOf('BIDUBrowser') > -1 || u.indexOf('baiduboxapp') > -1,
        'Maxthon': u.indexOf('Maxthon') > -1,
        'Sogou': u.indexOf('MetaSr') > -1 || u.indexOf('Sogou') > -1,
        'LBBROWSER': u.indexOf('LBBROWSER') > -1,
        '2345Explorer': u.indexOf('2345Explorer') > -1 || u.indexOf('Mb2345Browser') > -1,
        '115Browser': u.indexOf('115Browser') > -1,
        'TheWorld': u.indexOf('TheWorld') > -1,
        'XiaoMi': u.indexOf('MiuiBrowser') > -1,
        'Quark': u.indexOf('Quark') > -1,
        'Qiyu': u.indexOf('Qiyu') > -1,
        'Wechat': u.indexOf('MicroMessenger') > -1,
        'Taobao': u.indexOf('AliApp(TB') > -1,
        'Alipay': u.indexOf('AliApp(AP') > -1,
        'Weibo': u.indexOf('Weibo') > -1,
        'Douban': u.indexOf('com.douban.frodo') > -1,
        'Suning': u.indexOf('SNEBUY-APP') > -1,
        'iQiYi': u.indexOf('IqiyiApp') > -1,
        'DingTalk': u.indexOf('DingTalk') > -1,
        'Huawei': u.indexOf('HuaweiBrowser') > -1 || u.indexOf('HUAWEI') > -1,
        // 系统或平台
        'Windows': u.indexOf('Windows') > -1,
        'Linux': u.indexOf('Linux') > -1 || u.indexOf('X11') > -1,
        'Mac OS': u.indexOf('Macintosh') > -1,
        'Android': u.indexOf('Android') > -1 || u.indexOf('Adr') > -1,
        'Ubuntu': u.indexOf('Ubuntu') > -1,
        'FreeBSD': u.indexOf('FreeBSD') > -1,
        'Debian': u.indexOf('Debian') > -1,
        'Windows Phone': u.indexOf('IEMobile') > -1 || u.indexOf('Windows Phone') > -1,
        'BlackBerry': u.indexOf('BlackBerry') > -1 || u.indexOf('RIM') > -1,
        'MeeGo': u.indexOf('MeeGo') > -1,
        'Symbian': u.indexOf('Symbian') > -1,
        'iOS': u.indexOf('like Mac OS X') > -1,
        'Chrome OS': u.indexOf('CrOS') > -1,
        'WebOS': u.indexOf('hpwOS') > -1,
        // 设备
        'Mobile': u.indexOf('Mobi') > -1 || u.indexOf('iPh') > -1 || u.indexOf('480') > -1,
        'Tablet': u.indexOf('Tablet') > -1 || u.indexOf('Pad') > -1 || u.indexOf('Nexus 7') > -1
      }
      var is360 = false
      if (_window.chrome) {
        var chrome_vision = u.replace(/^.*Chrome\/([\d]+).*$/, '$1')
        if (_window.chrome.adblock2345 || _window.chrome.common2345) {
          match['2345Explorer'] = true
        } else if (_mime('type', 'application/360softmgrplugin') || _mime('type', 'application/mozilla-npqihooquicklogin')) {
          is360 = true
        } else if (chrome_vision > 36 && _window.showModalDialog) {
          is360 = true
        } else if (chrome_vision > 45) {
          is360 = _mime('type', 'application/vnd.chromium.remoting-viewer')
          if (!is360 && chrome_vision >= 69) {
            is360 = _mime('type', 'application/hwepass2001.installepass2001') || _mime('type', 'application/asx')
          }
        }
      }
      // 修正
      if (match['Mobile']) {
        match['Mobile'] = !(u.indexOf('iPad') > -1)
      } else if (is360) {
        if (_mime('type', 'application/gameplugin')) {
          match['360SE'] = true
        } else if (_navigator && typeof _navigator['connection'] !== 'undefined' && typeof _navigator['connection']['saveData'] === 'undefined') {
          match['360SE'] = true
        } else {
          match['360EE'] = true
        }
      }
      if (match['IE'] || match['Edge']) {
        var navigator_top = window.screenTop - window.screenY
        switch (navigator_top) {
          case 71: // 无收藏栏,贴边
          case 99: // 有收藏栏,贴边
          case 102: // 有收藏栏,非贴边
            match['360EE'] = true
            break
          case 75: // 无收藏栏,贴边
          case 105: // 有收藏栏,贴边
          case 104: // 有收藏栏,非贴边
            match['360SE'] = true
            break
        }
      }
      if (match['Baidu'] && match['Opera']) {
        match['Baidu'] = false
      } else if (match['iOS']) {
        match['Safari'] = true
      }
      // 基本信息
      var hash = {
        engine: ['WebKit', 'Trident', 'Gecko', 'Presto'],
        browser: ['Safari', 'Chrome', 'Edge', 'IE', 'Firefox', 'Firefox Focus', 'Chromium', 'Opera', 'Vivaldi', 'Yandex', 'Arora', 'Lunascape', 'QupZilla', 'Coc Coc', 'Kindle', 'Iceweasel', 'Konqueror', 'Iceape', 'SeaMonkey', 'Epiphany', 'XiaoMi', 'Huawei', '360', '360SE', '360EE', 'UC', 'QQBrowser', 'QQ', 'Baidu', 'Maxthon', 'Sogou', 'LBBROWSER', '2345Explorer', '115Browser', 'TheWorld', 'Quark', 'Qiyu', 'Wechat', 'Taobao', 'Alipay', 'Weibo', 'Douban', 'Suning', 'iQiYi', 'DingTalk'],
        os: ['Windows', 'Linux', 'Mac OS', 'Android', 'Ubuntu', 'FreeBSD', 'Debian', 'iOS', 'Windows Phone', 'BlackBerry', 'MeeGo', 'Symbian', 'Chrome OS', 'WebOS'],
        device: ['Mobile', 'Tablet']
      }
      _this.device = 'PC'
      _this.language = (function () {
        var g = (_navigator.browserLanguage || _navigator.language)
        var arr = g.split('-')
        if (arr[1]) {
          arr[1] = arr[1].toUpperCase()
        }
        return arr.join('_')
      })()
      for (var s in hash) {
        for (var i = 0; i < hash[s].length; i++) {
          var value = hash[s][i]
          if (match[value]) {
            _this[s] = value
          }
        }
      }
      // 系统版本信息
      var osVersion = {
        'Windows': function () {
          var v = u.replace(/^Mozilla\/\d.0 \(Windows NT ([\d.]+);.*$/, '$1')
          var hash = {
            '10': '10',
            '6.4': '10',
            '6.3': '8.1',
            '6.2': '8',
            '6.1': '7',
            '6.0': 'Vista',
            '5.2': 'XP',
            '5.1': 'XP',
            '5.0': '2000'
          }
          return hash[v] || v
        },
        'Android': function () {
          return u.replace(/^.*Android ([\d.]+);.*$/, '$1')
        },
        'iOS': function () {
          return u.replace(/^.*OS ([\d_]+) like.*$/, '$1').replace(/_/g, '.')
        },
        'Debian': function () {
          return u.replace(/^.*Debian\/([\d.]+).*$/, '$1')
        },
        'Windows Phone': function () {
          return u.replace(/^.*Windows Phone( OS)? ([\d.]+);.*$/, '$2')
        },
        'Mac OS': function () {
          return u.replace(/^.*Mac OS X ([\d_]+).*$/, '$1').replace(/_/g, '.')
        },
        'WebOS': function () {
          return u.replace(/^.*hpwOS\/([\d.]+);.*$/, '$1')
        }
      }
      _this.osVersion = ''
      if (osVersion[_this.os]) {
        _this.osVersion = osVersion[_this.os]()
        if (_this.osVersion == u) {
          _this.osVersion = ''
        }
      }
      // 浏览器版本信息
      var version = {
        'Safari': function () {
          return u.replace(/^.*Version\/([\d.]+).*$/, '$1')
        },
        'Chrome': function () {
          return u.replace(/^.*Chrome\/([\d.]+).*$/, '$1').replace(/^.*CriOS\/([\d.]+).*$/, '$1')
        },
        'IE': function () {
          return u.replace(/^.*MSIE ([\d.]+).*$/, '$1').replace(/^.*rv:([\d.]+).*$/, '$1')
        },
        'Edge': function () {
          return u.replace(/^.*Edge\/([\d.]+).*$/, '$1').replace(/^.*Edg\/([\d.]+).*$/, '$1')
        },
        'Firefox': function () {
          return u.replace(/^.*Firefox\/([\d.]+).*$/, '$1').replace(/^.*FxiOS\/([\d.]+).*$/, '$1')
        },
        'Firefox Focus': function () {
          return u.replace(/^.*Focus\/([\d.]+).*$/, '$1')
        },
        'Chromium': function () {
          return u.replace(/^.*Chromium\/([\d.]+).*$/, '$1')
        },
        'Opera': function () {
          return u.replace(/^.*Opera\/([\d.]+).*$/, '$1').replace(/^.*OPR\/([\d.]+).*$/, '$1')
        },
        'Vivaldi': function () {
          return u.replace(/^.*Vivaldi\/([\d.]+).*$/, '$1')
        },
        'Yandex': function () {
          return u.replace(/^.*YaBrowser\/([\d.]+).*$/, '$1')
        },
        'Arora': function () {
          return u.replace(/^.*Arora\/([\d.]+).*$/, '$1')
        },
        'Lunascape': function () {
          return u.replace(/^.*Lunascape[\/\s]([\d.]+).*$/, '$1')
        },
        'QupZilla': function () {
          return u.replace(/^.*QupZilla[\/\s]([\d.]+).*$/, '$1')
        },
        'Coc Coc': function () {
          return u.replace(/^.*coc_coc_browser\/([\d.]+).*$/, '$1')
        },
        'Kindle': function () {
          return u.replace(/^.*Version\/([\d.]+).*$/, '$1')
        },
        'Iceweasel': function () {
          return u.replace(/^.*Iceweasel\/([\d.]+).*$/, '$1')
        },
        'Konqueror': function () {
          return u.replace(/^.*Konqueror\/([\d.]+).*$/, '$1')
        },
        'Iceape': function () {
          return u.replace(/^.*Iceape\/([\d.]+).*$/, '$1')
        },
        'SeaMonkey': function () {
          return u.replace(/^.*SeaMonkey\/([\d.]+).*$/, '$1')
        },
        'Epiphany': function () {
          return u.replace(/^.*Epiphany\/([\d.]+).*$/, '$1')
        },
        '360': function () {
          return u.replace(/^.*QihooBrowser\/([\d.]+).*$/, '$1')
        },
        '360SE': function () {
          var hash = {
            '69': '11.1',
            '63': '10.0',
            '55': '9.1',
            '45': '8.1',
            '42': '8.0',
            '31': '7.0',
            '21': '6.3'
          }
          var chrome_vision = u.replace(/^.*Chrome\/([\d]+).*$/, '$1')
          return hash[chrome_vision] || ''
        },
        '360EE': function () {
          var hash = { '78': '12.0', '69': '11.0', '63': '9.5', '55': '9.0', '50': '8.7', '30': '7.5' }
          var chrome_vision = u.replace(/^.*Chrome\/([\d]+).*$/, '$1')
          return hash[chrome_vision] || ''
        },
        'Maxthon': function () {
          return u.replace(/^.*Maxthon\/([\d.]+).*$/, '$1')
        },
        'QQBrowser': function () {
          return u.replace(/^.*QQBrowser\/([\d.]+).*$/, '$1')
        },
        'QQ': function () {
          return u.replace(/^.*QQ\/([\d.]+).*$/, '$1')
        },
        'Baidu': function () {
          return u.replace(/^.*BIDUBrowser[\s\/]([\d.]+).*$/, '$1').replace(/^.*baiduboxapp\/([\d.]+).*$/, '$1')
        },
        'UC': function () {
          return u.replace(/^.*UC?Browser\/([\d.]+).*$/, '$1')
        },
        'Sogou': function () {
          return u.replace(/^.*SE ([\d.X]+).*$/, '$1').replace(/^.*SogouMobileBrowser\/([\d.]+).*$/, '$1')
        },
        'LBBROWSER': function () {
          var hash = {
            '57': '6.5',
            '49': '6.0',
            '46': '5.9',
            '42': '5.3',
            '39': '5.2',
            '34': '5.0',
            '29': '4.5',
            '21': '4.0'
          }
          var chrome_vision = navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/, '$1')
          return hash[chrome_vision] || ''
        },
        '2345Explorer': function () {
          var hash = { '69': '10.0', '55': '9.9' }
          var chrome_vision = navigator.userAgent.replace(/^.*Chrome\/([\d]+).*$/, '$1')
          return hash[chrome_vision] || u.replace(/^.*2345Explorer\/([\d.]+).*$/, '$1').replace(/^.*Mb2345Browser\/([\d.]+).*$/, '$1')
        },
        '115Browser': function () {
          return u.replace(/^.*115Browser\/([\d.]+).*$/, '$1')
        },
        'TheWorld': function () {
          return u.replace(/^.*TheWorld ([\d.]+).*$/, '$1')
        },
        'XiaoMi': function () {
          return u.replace(/^.*MiuiBrowser\/([\d.]+).*$/, '$1')
        },
        'Quark': function () {
          return u.replace(/^.*Quark\/([\d.]+).*$/, '$1')
        },
        'Qiyu': function () {
          return u.replace(/^.*Qiyu\/([\d.]+).*$/, '$1')
        },
        'Wechat': function () {
          return u.replace(/^.*MicroMessenger\/([\d.]+).*$/, '$1')
        },
        'Taobao': function () {
          return u.replace(/^.*AliApp\(TB\/([\d.]+).*$/, '$1')
        },
        'Alipay': function () {
          return u.replace(/^.*AliApp\(AP\/([\d.]+).*$/, '$1')
        },
        'Weibo': function () {
          return u.replace(/^.*weibo__([\d.]+).*$/, '$1')
        },
        'Douban': function () {
          return u.replace(/^.*com.douban.frodo\/([\d.]+).*$/, '$1')
        },
        'Suning': function () {
          return u.replace(/^.*SNEBUY-APP([\d.]+).*$/, '$1')
        },
        'iQiYi': function () {
          return u.replace(/^.*IqiyiVersion\/([\d.]+).*$/, '$1')
        },
        'DingTalk': function () {
          return u.replace(/^.*DingTalk\/([\d.]+).*$/, '$1')
        },
        'Huawei': function () {
          return u.replace(/^.*Version\/([\d.]+).*$/, '$1').replace(/^.*HuaweiBrowser\/([\d.]+).*$/, '$1')
        }
      }

      var browserName = {
        'IE': function () {
          try {
            var browserName = 'unknow'
            if (!!window.MSInputMethodContext && !!document.documentMode) {
              browserName = 'IE11'
            } else {
              /* @cc_on
                                @if (@_jscript_version == 11)
                                    browserName = "IE11";
                                @elif (@_jscript_version == 10)
                                    browserName = "IE10";
                                @elif (@_jscript_version == 9)
                                    browserName = "IE9";
                                @elif (@_jscript_version == 5.8)
                                    browserName = "IE8";
                                @elif (@_jscript_version == 5.7)
                                    browserName = "IE7";
                                @elif (@_jscript_version == 5.6)
                                    browserName = "IE6";
                                @end
                            @ */
            };
            return browserName
          } catch (e) {
            return ''
          }
        }
      }

      _this.browserName = _this.browser
      if (_this.browserName == 'IE') {
        _this.browserName = browserName[_this.browserName]()
        if (_this.browserName == u) {
          _this.browserName = ''
        }
      } else {
        _this.browserName = _this.browserName + version[_this.browserName]()
        if (_this.browserName == u) {
          _this.browserName = ''
        }
      }

      _this.version = ''
      if (version[_this.browser]) {
        _this.version = version[_this.browser]()
        if (_this.version == u) {
          _this.version = ''
        }
      }
      // 修正
      if (_this.browser == 'Edge') {
        if (_this.version > '75') {
          _this.engine = 'Blink'
        } else {
          _this.engine = 'EdgeHTML'
        }
      } else if (match['Chrome'] && _this.engine == 'WebKit' && parseInt(version['Chrome']()) > 27) {
        _this.engine = 'Blink'
      } else if (_this.browser == 'Opera' && parseInt(_this.version) > 12) {
        _this.engine = 'Blink'
      } else if (_this.browser == 'Yandex') {
        _this.engine = 'Blink'
      }

      return _this
    }
    //= ==============植入浏览器信息采集end=================================================================================

    //= ==============植入错误信息采集start=================================================================================
    try {
      var userAgent = navigator.userAgent
      if (userAgent.includes('DingTalk')) {
        window.addEventListener('error', handleListenerError, true)
        function handleListenerError (eventErr) {
          var column = eventErr.colno
          var message = eventErr.message
          var url = eventErr.filename
          var line = eventErr.lineno
          var error = eventErr.error

          try {
            function stringConnect () {
              this._str_ = new Array()
            }

            stringConnect.prototype.append = function (key, value) {
              this._str_.push(key + '=' + encodeURIComponent(encodeURIComponent(value)))
            }
            stringConnect.prototype.toString = function () {
              return this._str_.join('&')
            }

            var error_box = new stringConnect()
            error_box.append('url', url)
            error_box.append('line', line)
            error_box.append('userAgent', window.navigator.userAgent)
            error_box.append('column', column && column ? column : 0)
            error_box.append('msg', message)
            error_box.append('detail', error && error.stack ? error.stack : '')

            var uam_pageurl = uam_config.getUrl()
            uam_pageurl = uam_config.getNull(uam_pageurl)
            error_box.append('requestURL', uam_pageurl)

            var staffId = ''
            if (!staffId || staffId == '' || staffId == 'undefined' || uam_config.getCookie('uam_config_staffId') != staffId) {
              staffId = uam_config.getCookie('uam_config_staffId')
              if (!staffId || staffId == '') {
                staffId = dealTianyanStaffId()
              }
            }

            error_box.append('staffId', staffId)

            error_box.append('sessionId', uam_config.getCookie('browserSessionId'))
            error_box.append('areaCode', current_area_code)
            error_box.append('pageTitle', uam_win.document.title)
            error_box.append('systemCode', findPaq('systemCode'))

            error_box.append('provinceCode', findPaq('provinceCode'))
            error_box.append('forumLoginId', findPaq('forumLoginId'))
            error_box.append('forumLoginSource', findPaq('forumLoginSource'))
            error_box.append('forumProvinceName', findPaq('forumProvinceName'))

            error_box.append('virtualOrderId', uam_config.getCookie('virtualOrderId'))
            var err_time = new Date().getTime()
            error_box.append('err_time', err_time)
            error_box.append('token', '')

            // EndUserAgent.error_list.push(error_box),

            // 浏览器结构信息
            var info = getBrowserObj()

            error_box.append('browser', info.browser + info.version) // 浏览器
            error_box.append('version', info.browserName) // 版本
            error_box.append('os', info.os + info.osVersion) // 操作系统
            error_box.append('device', info.device) // 设备
            error_box.append('device', info.device) // 设备
            error_box.append('engine', info.engine) // 内核
            error_box.append('language', info.language) // 语言

            var errorStackMsg = error_box.toString()

            // 发送数据
            var backend_server_ipAndPort = findPaq('server_url')
            backend_server_ipAndPort = backend_server_ipAndPort.replace('sendqueue', 'sendErrorStack')
            var uam_url = backend_server_ipAndPort +
                            '?' + errorStackMsg

            createAImgRequest(uam_url)
          } catch (e) {
          }
        }
      } else {
        uam_win.onerror = function (message, url, line, column, error) {
          try {
            function stringConnect () {
              this._str_ = new Array()
            }

            stringConnect.prototype.append = function (key, value) {
              this._str_.push(key + '=' + encodeURIComponent(encodeURIComponent(value)))
            }
            stringConnect.prototype.toString = function () {
              return this._str_.join('&')
            }

            var error_box = new stringConnect()
            error_box.append('url', url)
            error_box.append('line', line)
            error_box.append('userAgent', window.navigator.userAgent)
            error_box.append('column', column && column ? column : 0)
            error_box.append('msg', message)
            error_box.append('detail', error && error.stack ? error.stack : '')

            var uam_pageurl = uam_config.getUrl()
            uam_pageurl = uam_config.getNull(uam_pageurl)
            error_box.append('requestURL', uam_pageurl)

            var staffId = this.dealTianyanStaffId()
            error_box.append('staffId', staffId)

            error_box.append('sessionId', uam_config.getCookie('browserSessionId'))
            error_box.append('areaCode', current_area_code)
            error_box.append('pageTitle', uam_win.document.title)
            error_box.append('systemCode', findPaq('systemCode'))

            error_box.append('provinceCode', findPaq('provinceCode'))
            error_box.append('forumLoginId', findPaq('forumLoginId'))
            error_box.append('forumLoginSource', findPaq('forumLoginSource'))
            error_box.append('forumProvinceName', findPaq('forumProvinceName'))

            error_box.append('virtualOrderId', uam_config.getCookie('virtualOrderId'))
            var err_time = new Date().getTime()
            error_box.append('err_time', err_time)
            error_box.append('token', '')

            // EndUserAgent.error_list.push(error_box),

            // 浏览器结构信息
            var info = getBrowserObj()

            error_box.append('browser', info.browser + info.version) // 浏览器
            error_box.append('version', info.browserName) // 版本
            error_box.append('os', info.os + info.osVersion) // 操作系统
            error_box.append('device', info.device) // 设备
            error_box.append('engine', info.engine) // 内核
            error_box.append('language', info.language) // 语言

            var errorStackMsg = error_box.toString()

            // 发送数据
            var backend_server_ipAndPort = findPaq('server_url')
            backend_server_ipAndPort = backend_server_ipAndPort.replace('sendqueue', 'sendErrorStack')
            var uam_url = backend_server_ipAndPort +
                            '?' + errorStackMsg

            createAImgRequest(uam_url)
          } catch (e) {
          }
        }
      }
    } catch (e) {
    }
    //= ==============植入错误信息采集end=================================================================================

    /**
         * 以加载图片的方式发送请求给后端采集服务
         * @param uam_url 拼接的url
         */

    try {
      function createAImgRequest (uam_url) {
        var uam_Image = new Image()
        uam_Image.onload = function () {
          uam_Image = null
        }
        uam_Image.src = uam_url
      }
    } catch (error) {

    }

    /**
         * 定义核心程序逻辑初始化标记，初始化完毕设置为true
         * @type {boolean}
         */
    var uam_flagflag = false

    var uam_pageurl
    var referurl
    var startDate = new Date()
    var endDate
    var pageId
    var sessionobj = {}
    // 取出uam_xy_paq变量中key对应的value值
    findPaq = function (key) {
      try {
        for (var i = uam_xy_paq.length - 1; i >= 0; i--) {
          var uam_param = uam_xy_paq[i]
          if (uam_param[0] == key) {
            return uam_param[1]
          }
        }
      } catch (e) {
      }
    }
    var sessionId = findPaq('sessionId')
    var virtualOrderId = findPaq('virtualOrderId')// 虚单ID
    var systemCode = findPaq('systemCode')
    var uam_setLoginName = findPaq('setLoginName')
    var serverUrl = findPaq('server_url')
    var forum_url = findPaq('forum_url')
    var areaCode = findPaq('areaCode')
    var staffId
    var provinceCode
    var forumLoginId
    var forumLoginSource
    var forumProvinceName
    var cityCode
    var depart
    var uuid
    var scene
    var phone
    var orderid
    var busiType
    var channel
    var reserve1
    var reserve2
    var reserve3
    var reserve4
    var reserve5
    var reserve6

    var uam_browser
    var evtTime
    var token
    var pageTitle
    var businessJson
    var custOrderNbr = findPaq('custOrderNbr')
    var channelNbr = findPaq('channelNbr')
    var custId = findPaq('custId')
    var custCertNbr = findPaq('custCertNbr')
    var custCertType = findPaq('custCertType')
    var btnuuid
    var reqtime
    var busitype
    var orderFlowCode
    var operCode
    var stepCode

    if (uam_xy_paq) {
      try {
        uam_xy_run()
        uam_config.main(systemCode, uam_setLoginName, serverUrl)
        uam_flagflag = true
      } catch (e) {
      }
    }

    /**
         * 核心执行逻辑
         */
    setTimeout(function () {
      // 避免重复执行初始化
      if (uam_flagflag) return
      // 基础核心监听事件初始化
      uam_xy_run()
      if (uam_xy_paq) {
        // 获得监控的用户
        uam_config.main(systemCode, uam_setLoginName, serverUrl)
        uam_flagflag = true
      }
    }, 2000)

    /**
         * 核心事件监听
         */
    function uam_xy_run () {
      // 加载业务采集方面的方法
      uam_business_run()

      // 主方法入口,事件监听
      uam_config.main = function (systemCode, uam_setLoginName, serverUrl) {
        try {
          // 得到页面的url
          uam_pageurl = uam_config.getUrl()
          setInterval(function () {
            if (uam_win.location.href !== uam_pageurl) {
              uam_pageurl = uam_win.location.href
            }
          }, 1000)
          uam_pageurl = uam_config.getNull(uam_pageurl)
          referurl = uam_config.getUrlReferrer()
          referurl = uam_config.getNull(referurl)

          // 页面加载时间
          uam_config.loadpageTimes = uam_config.getPerformanceTiming()

          var inputList = window.document.getElementsByTagName('input')
          if (uam_win.addEventListener)// IE9,IE10,IE11,chrome,firefox,qq,else
          {
            // 监听页面离开unload的事件
            window.addEventListener('unload', function (e) {
              endDate = new Date()
              e.restTime = endDate - startDate
              e.listnerEvent = 'unload'
              uam_config.dealEvent(e)
            }, true)

            // 监听click的事件
            window.addEventListener('mousedown', function (e) {
              e.listnerEvent = 'mousedown'
              uam_config.dealEvent(e)
            }, false)

            if (document.readyState === 'complete') {
              uam_config.loadpageTimes = uam_config.getPerformanceTiming()
              uam_config.dealStart()
            } else {
              window.addEventListener('load', function (e) {
                window.pageSignTimeStamp = new Date().getTime()
                window.pageSignUUID = uam_config.getuuid()
                uam_config.loadpageTimes = uam_config.getPerformanceTiming()
                uam_config.dealStart()
              }, false)
            }

            // 监听双击dbclick事件
            window.addEventListener('dblclick', function (e) {
              e.listnerEvent = 'dblclick'
              // uam_config.dealEvent(e);
            }, true)

            // 监听按键事件
            window.addEventListener('keydown', function (e) {
              e.listnerEvent = 'keydown'
              // uam_config.dealEvent(e);
            }, true)
            // 监听input的事件
            for (var i = 0; i < inputList.length; i++) {
              inputList[i].addEventListener('focus', function (e) {
                e.listnerEvent = 'focus'
                // uam_config.dealEvent(e);
              }, true)
            }
          } else // IE8,IE7,IE6,IE5
          {
            // 监听页面离开load的事件
            window.document.attachEvent('onunload', function (e) {
              endDate = new Date()
              e.restTime = endDate - startDate
              e.listnerEvent = 'onunload'
              uam_config.dealEvent(e)
            }, true)

            // 监听click的事件
            window.document.attachEvent('onclick', function (e) {
              e.listnerEvent = 'onclick'
              uam_config.dealEvent(e)
            }, false)
            // 监听click的事件
            if (document.readyState === 'complete') {
              uam_config.loadpageTimes = uam_config.getPerformanceTiming()
              uam_config.dealStart()
            } else {
              window.attachEvent('onload', function (e) {
                window.pageSignTimeStamp = new Date().getTime()
                window.pageSignUUID = uam_config.getuuid()
                // 页面加载时间
                uam_config.loadpageTimes = uam_config.getPerformanceTiming()
                uam_config.dealStart()
              }, false)
            }

            // 监听双击dbclick事件
            window.document.attachEvent('ondblclick', function (e) {
              e.listnerEvent = 'ondblclick'
              // uam_config.dealEvent(e);
            }, true)

            // 监听按键事件
            window.document.attachEvent('onkeydown', function (e) {
              e.listnerEvent = 'onkeydown'
              // uam_config.dealEvent(e);
            }, true)

            // 监听input的事件
            for (var i = 0; i < inputList.length; i++) {
              inputList[i].attachEvent('onfocus', function (e) {
                e.listnerEvent = 'onfocus'
                // uam_config.dealEvent(e);
              }, true)
            }
          }
        } catch (e) {
        };
      }

      uam_config.dealCommonParam = function () {
        try {
          // 获取员工ID信息与省份信息
          if (!staffId || staffId == '' || uam_config.getCookie('uam_config_staffId') != staffId) {
            staffId = uam_config.getCookie('uam_config_staffId')
            staffId = dealTianyanStaffId()
          }
          if (!provinceCode || provinceCode == '') {
            provinceCode = findPaq('provinceCode')
          }
          if (!forumLoginId || forumLoginId == '') {
            forumLoginId = findPaq('forumLoginId')
          }
          if (!forumLoginSource || forumLoginSource == '') {
            forumLoginSource = findPaq('forumLoginSource')
          }
          if (!forumProvinceName || forumProvinceName == '') {
            forumProvinceName = findPaq('forumProvinceName')
          }
          if (!cityCode || cityCode == '' || uam_config.getCookie('uam_config_cityCode') != cityCode) {
            cityCode = uam_config.getCookie('uam_config_cityCode')
          }
          if (!depart || depart == '' || uam_config.getCookie('uam_config_depart') != depart) {
            depart = uam_config.getCookie('uam_config_depart')
          }
          if (!custId || custId == '' || uam_config.getCookie('uam_config_custId') != custId) {
            custId = uam_config.getCookie('uam_config_custId')
          }
          if (!uuid || uuid == '' || uam_config.getCookie('uam_config_uuid') != uuid) {
            uuid = uam_config.getCookie('uam_config_uuid')
          }
          if (!scene || scene == '' || uam_config.getCookie('uam_config_scene') != scene) {
            scene = uam_config.getCookie('uam_config_scene')
          }
          if (!phone || phone == '' || uam_config.getCookie('uam_config_phone') != phone) {
            phone = uam_config.getCookie('uam_config_phone')
          }
          if (!orderid || orderid == '' || uam_config.getCookie('uam_config_orderid') != orderid) {
            orderid = uam_config.getCookie('uam_config_orderid')
          }
          if (!busiType || busiType == '' || uam_config.getCookie('uam_config_busiType') != busiType) {
            busiType = uam_config.getCookie('uam_config_busiType')
          }
          if (!channel || channel == '' || uam_config.getCookie('uam_config_channel') != channel) {
            channel = uam_config.getCookie('uam_config_channel')
          }
          if (!reserve1 || reserve1 == '' || uam_config.getCookie('uam_config_reserve1') != reserve1) {
            reserve1 = uam_config.getCookie('uam_config_reserve1')
          }
          if (!reserve2 || reserve2 == '' || uam_config.getCookie('uam_config_reserve2') != reserve2) {
            reserve2 = uam_config.getCookie('uam_config_reserve2')
          }
          if (!reserve3 || reserve3 == '' || uam_config.getCookie('uam_config_reserve3') != reserve3) {
            reserve3 = uam_config.getCookie('uam_config_reserve3')
          }
          if (!reserve5 || reserve5 == '' || uam_config.getCookie('uam_config_reserve5') != reserve5) {
            reserve5 = uam_config.getCookie('uam_config_reserve5')
          }
          if (!reserve6 || reserve6 == '' || uam_config.getCookie('uam_config_reserve6') != reserve6) {
            reserve6 = uam_config.getCookie('uam_config_reserve6')
          }
          if (!reserve4 || reserve4 == '' || uam_config.getCookie('uam_config_reserve4') != reserve4) {
            reserve4 = uam_config.getCookie('uam_config_reserve4')
          }
        } catch (error) {
        }
      }

      uam_config.dealMustParam = function () {
        // 生成一个模似客户
        var cookie_seesionId = uam_config.getCookie('browserSessionId')
        if (!cookie_seesionId) {
          sessionId = uam_config.createCookie('browserSessionId', uam_config.guid(), 1)
        } else {
          sessionId = cookie_seesionId
        };

        systemCode = findPaq('systemCode')
        serverUrl = findPaq('server_url')
        areaCode = findPaq('areaCode')
        custOrderNbr = findPaq('custOrderNbr')
        channelNbr = findPaq('channelNbr')
        custCertNbr = findPaq('custCertNbr')
        custCertType = findPaq('custCertType')
        provinceCode = findPaq('provinceCode')
        forumLoginId = findPaq('forumLoginId')
        forumLoginSource = findPaq('forumLoginSource')
        forumProvinceName = findPaq('forumProvinceName')

        sessionId = uam_config.getNull(sessionId)
        systemCode = uam_config.getNull(systemCode)
        serverUrl = uam_config.getNull(serverUrl)
        areaCode = uam_config.getNull(areaCode)
        staffId = uam_config.getNull(staffId)
        provinceCode = uam_config.getNull(provinceCode)
        forumLoginId = uam_config.getNull(forumLoginId)
        forumLoginSource = uam_config.getNull(forumLoginSource)
        forumProvinceName = uam_config.getNull(forumProvinceName)

        custOrderNbr = uam_config.getNull(custOrderNbr)
        channelNbr = uam_config.getNull(channelNbr)
        custId = uam_config.getNull(custId)
        custCertNbr = uam_config.getNull(custCertNbr)
        custCertType = uam_config.getNull(custCertType)

        uam_browser = window.navigator.userAgent
        uam_browser = uam_config.getNull(uam_browser)

        evtTime = uam_config.getEventTime()
        evtTime = uam_config.getNull(evtTime)

        pageTitle = uam_win.document.title
        pageTitle = uam_config.getNull(pageTitle)

        var info = uam_xy_obj.loadBroserFinder()
        businessJson = uam_xy_obj.businessJson

        // 每次必传
        uam_config.uam_sendBaseConfig = {
          'browser': info.browser + info.version, // 浏览器
          'version': info.browserName, // 版本
          'os': info.os, // 操作系统
          'device': info.device, // 设备
          'engine': info.engine, // 内核
          'language': info.language, // 语言
          'areaCode': current_area_code,
          'systemCode': systemCode,
          'staffId': staffId,
          'provinceCode': provinceCode,
          'forumLoginId': forumLoginId,
          'forumLoginSource': forumLoginSource,
          'forumProvinceName': forumProvinceName,
          'businessJson': businessJson,
          'cityCode': cityCode,
          'depart': depart,
          'uuid': uuid,
          'scene': scene,
          'phone': phone,
          'orderid': orderid,
          'busiType': busiType,
          'channel': channel,
          'reserve1': reserve1,
          'reserve2': reserve2,
          'reserve3': reserve3,
          'reserve4': reserve4,
          'reserve5': reserve5,
          'reserve6': reserve6,
          'custOrderNbr': custOrderNbr,
          'channelNbr': channelNbr,
          'custId': custId,
          'custCertNbr': custCertNbr,
          'custCertType': custCertType,
          'orderFlowCode': '',
          'operCode': '',
          'stepCode': '',
          'referURL': referurl,
          'pageId': pageId,
          'btnuuid': btnuuid
        }
      }

      // 页面操作事件处理  eventType=eleClick
      uam_config.dealEvent = function (e) {
        try {
          var uam_e = e || window.event
          var listnerEvent = uam_config.getNull(uam_e.type)
          var uam_obj = uam_e.srcElement ? uam_e.srcElement : uam_e.target
          // 屏幕分辨率uam_clientWidth、uam_clientHeight
          var uam_clientWidth = uam_win.document.body.clientWidth
          var uam_clientHeight = uam_win.document.body.clientHeight
          uam_clientWidth = uam_config.getNull(uam_clientWidth)
          uam_clientHeight = uam_config.getNull(uam_clientHeight)
          // 元素坐标uam_x、uam_y
          var uam_x = uam_e.clientX + uam_win.document.body.scrollLeft + uam_win.document.documentElement.scrollLeft
          var uam_y = uam_e.clientY + uam_win.document.body.scrollTop + uam_win.document.documentElement.scrollTop
          uam_x = uam_config.getNaN(uam_x)
          uam_y = uam_config.getNaN(uam_y)

          uam_config.dealCommonParam()
          uam_config.dealMustParam()

          //= ==================================================
          // 统一业务采集入口,所有需要采集业务的位置，都调用这一句
          uam_business_eventHandler_run(uam_pageurl, uam_e, uam_config)
          //= ==================================================

          var keyCode = uam_config.getNull(uam_e.keyCode)
          var restTime = uam_config.getNull(uam_e.restTime)
          var id = uam_config.getNull(uam_obj.id)
          var tagname = uam_config.getNull(uam_obj.tagName)
          var type = uam_config.getNull(uam_obj.type)
          var value = removeR(uam_config.getNull(uam_obj.value))
          var tempValue = uam_obj.getAttribute('value')
          if (value == '' && tempValue) {
            value = uam_obj.getAttribute('value')
          }

          var name = uam_config.getNull(uam_obj.name)
          var className = uam_config.getNull(uam_obj.className)
          var innerText = removeR(uam_config.getNull(uam_obj.innerText).substring(0, 50))

          // 存储当前点击内容
          uam_xy_obj.current_btn_value = value
          uam_xy_obj.current_btn_innerText = innerText

          try {
            uam_xy_session.sessionId = sessionId
            uam_xy_obj.sessionId = sessionId
            uam_xy_obj.id = id
            uam_xy_obj.tagname = tagname
            uam_xy_obj.type = type
            uam_xy_obj.value = encodeURIComponent(encodeURIComponent(value))
            uam_xy_obj.name = name
            uam_xy_obj.className = className
            uam_xy_obj.innerText = encodeURIComponent(encodeURIComponent(innerText))
            uam_xy_obj.uam_pageurl = encodeURIComponent(encodeURIComponent(uam_pageurl))
            uam_xy_obj.pageTitle = encodeURIComponent(encodeURIComponent(pageTitle))
            uam_xy_obj.referurl = encodeURIComponent(encodeURIComponent(referurl))
          } catch (e) {
          }
          var eventType
          pageId = uam_config.getNull(pageId)
          if (listnerEvent == 'focus' || listnerEvent == 'onfocus') {
            eventType = 'eleFocus'
          } else if (listnerEvent == 'load' || listnerEvent == 'onload') {
            eventType = 'pageLoad'
          } else if (listnerEvent == 'unload' || listnerEvent == 'onunload') {
            eventType = 'pageUnload'
          } else if (listnerEvent == 'click' || listnerEvent == 'onclick') {
            eventType = 'eleClick'
          } else if (listnerEvent == 'dblclick' || listnerEvent == 'ondblclick') {
            eventType = 'eleDbclick'
          } else if (listnerEvent == 'keydown' || listnerEvent == 'onkeydown') {
            eventType = 'pageKeypress'
          }

          uam_config.elementAttrs = {
            'id': id,
            'tagName': tagname,
            'type': type,
            'value': encodeURIComponent(encodeURIComponent(value)),
            'name': name,
            'className': className,
            'innerText': encodeURIComponent(encodeURIComponent(innerText))
          }

          var busi_extArray = uam_config.ext_array
          // json转换成Array
          var busiJsons = ''
          try {
            busiJsons = busi_extArray
          } catch (e) {
          }

          // 发送点击事件信息到服务端
          if (innerText != '' || value != '') {
            uam_config.tianyansend({
              'evtTime': evtTime, // 事件发生时前端时间
              'token': '',
              'pageLoadTime': uam_config.loadpageTimes[0].loadpage, // 页面请求时间
              'eventType': eventType,
              'sessionId': sessionId,
              'virtualOrderId': uam_config.getCookie('virtualOrderId'),
              'userAgent': uam_browser,
              'screenWidth': uam_clientWidth,
              'screenHeight': uam_clientHeight,
              'pageTitle': encodeURIComponent(encodeURIComponent(pageTitle)),
              'requestURL': encodeURIComponent(encodeURIComponent(uam_pageurl)),
              'clientX': uam_x,
              'clientY': uam_y,
              'keyCode': keyCode,
              'restTime': restTime,
              'busi_ext_array': busiJsons
            }, serverUrl)
          }

          uam_config.ext_array = []
        } catch (e) {
        }
      }

      // 页面加载事件处理  eventType = pageLoad
      uam_config.dealStart = function () {
        try {
          pageId = uam_config.getuuid()
          pageId = uam_config.getNull(pageId)

          // 屏幕分辨率uam_clientWidth、uam_clientHeight
          var uam_clientWidth = uam_win.document.body.clientWidth
          var uam_clientHeight = uam_win.document.body.clientHeight
          uam_clientWidth = uam_config.getNull(uam_clientWidth)
          uam_clientHeight = uam_config.getNull(uam_clientHeight)

          var eventType = 'pageLoad'
          uam_config.dealCommonParam()
          uam_config.dealMustParam()

          // 发送加载事件信息到服务端
          uam_config.tianyansend({
            'evtTime': evtTime, // 事件发生时前端时间
            'pageLoadTime': uam_config.loadpageTimes[0].loadpage, // 页面请求时间
            'dnsTime': uam_config.loadpageTimes[0].lookupDomain, // 域名解析时间
            'conTime': uam_config.loadpageTimes[0].connect, // 建立连接花费时间
            'exetime': uam_config.loadpageTimes[0].request, // 请求数据花费时间
            'resTime': uam_config.loadpageTimes[0].receive, // 接收数据花费时间
            'domReady': uam_config.loadpageTimes[0].domReady,
            'connect': uam_config.loadpageTimes[0].connect,
            'receive': uam_config.loadpageTimes[0].receive,
            'request': uam_config.loadpageTimes[0].request,
            'tcpTime': uam_config.loadpageTimes[0].tcpTime,
            'domBuild': uam_config.loadpageTimes[0].domBuild,
            'respTime': uam_config.loadpageTimes[0].respTime,
            'frontTime': uam_config.loadpageTimes[0].frontTime,
            'serverCon': uam_config.loadpageTimes[0].serverCon,
            'doneTime': uam_config.loadpageTimes[0].doneTime,
            'dnsTime': uam_config.loadpageTimes[0].dnsTime,
            'docDow': uam_config.loadpageTimes[0].docDow,
            'pageTime': uam_config.loadpageTimes[0].pageTime,
            'sc': uam_config.loadpageTimes[0].sc,
            'fpt': uam_config.loadpageTimes[0].fpt,
            'ali_FMP': uam_config.loadpageTimes[0].ali_FMP,
            'ali_load': uam_config.loadpageTimes[0].ali_load,
            'tianyan_FMP': uam_config.loadpageTimes[0].tianyan_FMP,
            'tianyan_tti': uam_config.loadpageTimes[0].tianyan_tti,
            'tianyan_ready': uam_config.loadpageTimes[0].tianyan_ready,
            'tianyan_load': uam_config.loadpageTimes[0].tianyan_load,
            'tianyan_firstbyte': uam_config.loadpageTimes[0].tianyan_firstbyte,
            'tianyan_dom': uam_config.loadpageTimes[0].tianyan_dom,
            'tianyan_res': uam_config.loadpageTimes[0].tianyan_res,
            'tianyan_ssl': uam_config.loadpageTimes[0].tianyan_ssl,
            'eventType': eventType,
            'token': '',
            'sessionId': sessionId,
            'userAgent': uam_browser,
            'screenWidth': uam_clientWidth,
            'screenHeight': uam_clientHeight,
            'pageTitle': pageTitle,
            'requestURL': uam_pageurl
          }, serverUrl, '')
        } catch (e) {
        }
      }
      //
      uam_config.getNull = function (uam_obj) {
        if (uam_obj == '' || uam_obj == 'null' || uam_obj == 'nan' || uam_obj == 'NaN' ||
                    uam_obj == 'undefined' || uam_obj == null || uam_obj == undefined) {
          return ''
        } else {
          return uam_obj
        }
      }
      uam_config.getNaN = function (uam_obj) {
        if (isNaN(uam_obj)) {
          return ''
        } else if (uam_obj == null || uam_obj == undefined) {
          return ''
        } else {
          return uam_obj
        }
      }

      // 去除换行符
      function removeR (str) {
        try {
          return str.replace(/[\r\n]/g, ' ')
        } catch (e) {
        }
      }

      // 获取url
      uam_config.getUrl = function () {
        try {
          return uam_win.location.href
        } catch (e) {
        }
      }
      uam_config.getUrlReferrer = function () {
        try {
          return uam_win.document.referrer
        } catch (error) {
        }
      }

      // 毫秒小于100时补足0或者00
      uam_config.checkMilliseconds = function (i) {
        if (i < 100 && i > 9) {
          i = '0' + i
        }
        if (i < 10) {
          i = '00' + i
        }
        return i
      }
      uam_config.checkTimes = function (i) {
        if (i < 10) {
          i = '0' + i
        }
        return i
      }

      // 请求到服务端
      uam_config.tianyansend = function (message, serverUrl, tagtype) {
        try {
          var loginName = uam_config.uam_sendBaseConfig.uam_username
          if (typeof (loginName) === 'undefined') {
            uam_setLoginName = findPaq('setLoginName')
            uam_config.uam_sendBaseConfig.uam_username = uam_config.getNull(uam_setLoginName)
          }

          var uam_sendBaseConfig = uam_config.uam_sendBaseConfig
          var uam_message = message
          var uam_elementAttrs = uam_config.elementAttrs

          var resultJsonObject = {}
          for (var attr in uam_sendBaseConfig) {
            resultJsonObject[attr] = uam_sendBaseConfig[attr]
          }
          for (var attr in uam_message) {
            resultJsonObject[attr] = uam_message[attr]
          }
          for (var attr in uam_elementAttrs) {
            resultJsonObject[attr] = uam_elementAttrs[attr]
          }

          serverUrl = serverUrl.replace('sendqueue', 'postqueque')

          var xhr
          if (window.ActiveXObject) {
            try {
              xhr = new window.ActiveXObject('Microsoft.XMLHTTP'), xhr.onreadystatechange = function () { },
              xhr.open('POST', serverUrl, !0), xhr.send(tianyan_stringify(resultJsonObject))

              const xhr1 = new window.ActiveXObject('Microsoft.XMLHTTP')
              xhr1.onreadystatechange = function () { },
              xhr1.open('POST', forum_url, !0),
              xhr1.setRequestHeader('Authorization', 'Basic ZWxhc3RpYzo4bkRmSzQ4UzhjMmhEaDkyRkw4QzhmSTg='),
              xhr1.setRequestHeader('Content-Type', 'Application/json'),
              xhr1.send(tianyan_stringify({ ...resultJsonObject, forumType: 'postqueque' }))
            } catch (e) {

            }
          } else if (window.XMLHttpRequest) {
            try {
              xhr = new XMLHttpRequest(), xhr.onreadystatechange = function () { },
              xhr.open('POST', serverUrl, !0), xhr.send(tianyan_stringify(resultJsonObject))

              const xhr1 = new XMLHttpRequest()
              xhr1.onreadystatechange = function () { },
              xhr1.open('POST', forum_url, !0),
              xhr1.setRequestHeader('Authorization', 'Basic ZWxhc3RpYzo4bkRmSzQ4UzhjMmhEaDkyRkw4QzhmSTg='),
              xhr1.setRequestHeader('Content-Type', 'Application/json'),
              xhr1.send(tianyan_stringify({ ...resultJsonObject, forumType: 'postqueque' }))
            } catch (e) {

            }
          }
        } catch (e) {
        }
      }

      // 创建cookie
      uam_config.createCookie = function (name, value, hour) {
        try {
          var expires
          if (hour) {
            var uam_date = new Date()
            uam_date.setTime(uam_date.getTime() + (hour * 24 * 60 * 60 * 60 * 1000))
            expires = '; expires=' + uam_date.toGMTString()
          } else {
            expires = ''
          }
          document.cookie = name + '=' + value + expires + '; path=/'
          return uam_config.getCookie(name)
        } catch (error) {
        }
      }

      // 获取cookie值
      uam_config.getCookie = function (name) {
        try {
          var strcookie = document.cookie
          var arrcookie = strcookie.split(';')
          for (var i = 0; i < arrcookie.length; i++) {
            var arr = arrcookie[i].split('=')
            if (arr[0].replace(/\s*/g, '') == name.replace(/\s*/g, '')) {
              return arr[1]
            }
          }
          return ''
        } catch (error) {
          return ''
        }
      }
      // 更改cookie值
      uam_config.updateCookie = function (name, value) {
        try {
          document.cookie = name + '=' + value + '; path=/'
        } catch (error) {
        }
      }

      // 拼接字符串为URl格式
      uam_config.uam_buildUrlParams = function (uam_config) {
        var uam_param = ''
        for (var p in uam_config) {
          try {
            if (p && (p == 'toJSONString')) {
              continue
            }
            uam_param += p + '=' + uam_config[p].replace(/#/g, '')
            uam_param += '&'
          } catch (e) {
            uam_param += p + '=' + uam_config[p]
            uam_param += '&'
          }
        }
        return uam_param
      }

      // 编码转换
      uam_config.encodeCharset = function (obj) {
        for (var p in obj) {
          try {
            obj[p] = encodeURIComponent(encodeURIComponent(obj[p]))
          } catch (e) {
          }
        }
        return obj
      }

      uam_config.guid = function () {
        return 'xxxxxxxxxxxx4xxxyxxxxxxxxxx'.replace(/[xy]/g, function (uam_c) {
          try {
            var uam_r = Math.random() * 16 | 0
            var uam_v = uam_c == 'x' ? uam_r : (uam_r & 0x3 | 0x8)
            return uam_v.toString(16)
          } catch (e) {
          }
        })
      }

      // 获取随机数
      uam_config.getuuid = function () {
        try {
          return (uam_config.getUUnumber() + uam_config.getUUnumber() + '' + uam_config.getUUnumber() + '' + uam_config.getUUnumber() +
                        '' + uam_config.getUUnumber() + '' + uam_config.getUUnumber() + uam_config.getUUnumber() + uam_config.getUUnumber())
        } catch (e) {
        }
      }

      uam_config.getUUnumber = function () {
        try {
          return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)
        } catch (e) {
        }
      }

      // 获取事件开始时间
      uam_config.getEventTime = function () {
        try {
          var uam_startDate = new Date()
          var month = uam_startDate.getMonth() + 1
          if (month < 10) {
            month = 0 + '' + month
          }
          var day = uam_startDate.getDate()
          if (day < 10) {
            day = 0 + '' + day
          }
          var evtTime = uam_startDate.getFullYear() + '' + month + '' + day + '' + uam_config.checkTimes(uam_startDate.getHours()) + '' +
                        uam_config.checkTimes(uam_startDate.getMinutes()) + '' + uam_config.checkTimes(uam_startDate.getSeconds()) + '' +
                        uam_config.checkMilliseconds(uam_startDate.getMilliseconds())
          return evtTime
        } catch (e) {
        }
      }
      // 计算加载时间
      uam_config.getPerformanceTiming = function () {
        try {
          var performance = window.performance ||
                        window.msPerformance ||
                        window.webkitPerformance

          var timing = {}
          if (performance) {
            timing = performance.timing
          }

          var loadpageTimes = []
          if (!performance) { // 浏览器不支持
            loadpageTimes.push({
              'connect': '',
              'request': '',
              'receive': '',
              'domAna': '',
              'domReady': '',
              'loadpage': '',
              'tcpTime': '',
              'domBuild': '',
              'respTime': '',
              'frontTime': '',
              'serverCon': '',
              'doneTime': '',
              'dnsTime': '',
              'docDow': '',
              'pageTime': '',
              'sc': '',
              'tianyan_FMP': '',
              'tianyan_tti': '',
              'tianyan_ready': '',
              'tianyan_load': '',
              'tianyan_firstbyte': '',
              'tianyan_dom': '',
              'tianyan_res': '',
              'tianyan_ssl': '',
              'ali_FMP': '',
              'ali_load': '',
              'fpt': ''
            })
            return loadpageTimes
          }
          var result = []
          var i = 0

          var domReady = 0 // DOM准备时间
          var tcpTime = 0 // TCP时间
          var domBuild = 0 // DOM建立时间
          var respTime = 0 // 首字节时间
          var frontTime = 0 // 前端时间
          var serverCon = 0 // 服务器连接时间
          var doneTime = 0 // 响应时间
          var dnsTime = 0 // DNS时间
          var docDow = 0 // HTML下载时间
          var pageTime = 0 // 页面渲染时间
          var sc = 0 // 首屏时间
          var fpt = 0 // 白屏时间
          var connect = 0
          var request = 0
          var receive = 0
          var domAna = 0

          var loadpage = 0
          var loadEventEnd = 0

          // 首屏时间
          var tianyan_FMP = 0
          var ali_FMP = 0
          // 首次可交互时间
          var tianyan_tti = 0
          // DOM Ready时间。
          var tianyan_ready = 0
          // 页面完全加载时间
          var tianyan_load = 0
          var ali_load = 0
          // 首包时间
          var tianyan_firstbyte = 0
          // DOM解析耗时
          var tianyan_dom = 0
          // 资源加载耗时
          var tianyan_res = 0
          // SSL安全连接耗时
          var tianyan_ssl = 0

          for (var key in timing) {
            if (typeof (timing[key]) === 'undefined') {
              timing[key] = 0
            }
          }

          var endScreenTime = Date.now()
          if (timing.loadEventEnd > 0) {
            loadEventEnd = endScreenTime < timing.loadEventEnd ? endScreenTime : timing.loadEventEnd
          } else {
            loadEventEnd = endScreenTime
          }

          // DOM准备时间
          domReady = timing.domContentLoadedEventStart - timing.navigationStart
          // TCP时间
          tcpTime = timing.connectEnd - timing.connectStart
          // DOM建立时间
          domBuild = timing.domContentLoadedEventStart - timing.responseEnd
          // 首字节时间
          respTime = timing.responseStart - timing.navigationStart
          // 前端时间
          frontTime = loadEventEnd - timing.responseStart
          // 服务器连接时间
          serverCon = timing.requestStart - timing.navigationStart
          // 响应时间
          doneTime = loadEventEnd - timing.navigationStart
          // DNS时间
          dnsTime = timing.domainLookupEnd - timing.domainLookupStart
          // HTML下载时间
          docDow = timing.responseEnd - timing.responseStart
          // 页面渲染时间
          pageTime = loadEventEnd - timing.domContentLoadedEventStart
          // 首屏时间
          sc = timing.domComplete - timing.domLoading
          // 白屏时间
          fpt = timing.responseEnd - timing.fetchStart

          // 建立连接时间
          connect = timing.connectEnd - timing.connectStart

          // 请求数据时间
          request = timing.responseStart - timing.requestStart

          // 接收数据时间
          receive = timing.responseEnd - timing.responseStart

          // dom解析时间
          domAna = timing.domInteractive - timing.domLoading

          // 加载时间 （错误时间）
          loadpage = dnsTime + connect + request + receive + domAna + domReady

          // 首屏时间
          tianyan_FMP = timing.loadEventStart - timing.fetchStart
          ali_FMP = timing.loadEventStart - timing.navigationStart

          // 首次可交互时间
          tianyan_tti = timing.domInteractive - timing.fetchStart
          // DOM Ready时间。
          tianyan_ready = timing.domContentLoadedEventEnd - timing.fetchStart

          // 页面完全加载时间
          tianyan_load = loadEventEnd - timing.navigationStart
          ali_load = timing.loadEventStart - timing.fetchStart

          // 首包时间
          tianyan_firstbyte = timing.responseStart - timing.domainLookupStart
          // DOM解析耗时
          tianyan_dom = timing.domInteractive - timing.responseEnd
          // 资源加载耗时
          tianyan_res = timing.loadEventStart - timing.domContentLoadedEventEnd
          // SSL安全连接耗时
          tianyan_ssl = timing.connectEnd - timing.secureConnectionStart

          connect = uam_config.getNaN(connect)
          request = uam_config.getNaN(request)
          receive = uam_config.getNaN(receive)
          domAna = uam_config.getNaN(domAna)
          loadpage = uam_config.getNaN(loadpage)
          domReady = uam_config.getNaN(domReady)
          tcpTime = uam_config.getNaN(tcpTime)
          domBuild = uam_config.getNaN(domBuild)
          respTime = uam_config.getNaN(respTime)
          frontTime = uam_config.getNaN(frontTime)
          serverCon = uam_config.getNaN(serverCon)
          doneTime = uam_config.getNaN(doneTime)
          dnsTime = uam_config.getNaN(dnsTime)
          docDow = uam_config.getNaN(docDow)
          pageTime = uam_config.getNaN(pageTime)
          sc = uam_config.getNaN(sc)

          fpt = uam_config.getNaN(fpt)
          tianyan_FMP = uam_config.getNaN(tianyan_FMP)
          ali_FMP = uam_config.getNaN(ali_FMP)
          ali_load = uam_config.getNaN(ali_load)
          tianyan_tti = uam_config.getNaN(tianyan_tti)
          tianyan_ready = uam_config.getNaN(tianyan_ready)
          tianyan_load = uam_config.getNaN(tianyan_load)
          tianyan_firstbyte = uam_config.getNaN(tianyan_firstbyte)
          tianyan_dom = uam_config.getNaN(tianyan_dom)
          tianyan_res = uam_config.getNaN(tianyan_res)
          tianyan_ssl = uam_config.getNaN(tianyan_ssl)

          loadpageTimes.push({
            'connect': connect,
            'request': request,
            'receive': receive,
            'domAna': domAna,
            'domReady': domReady,
            'loadpage': loadpage,
            'tcpTime': tcpTime,
            'domBuild': domBuild,
            'respTime': respTime,
            'frontTime': frontTime,
            'serverCon': serverCon,
            'doneTime': doneTime,
            'dnsTime': dnsTime,
            'docDow': docDow,
            'pageTime': pageTime,
            'sc': sc,
            'tianyan_FMP': tianyan_FMP,
            'tianyan_tti': tianyan_tti,
            'tianyan_ready': tianyan_ready,
            'tianyan_load': tianyan_load,
            'tianyan_firstbyte': tianyan_firstbyte,
            'tianyan_dom': tianyan_dom,
            'tianyan_res': tianyan_res,
            'tianyan_ssl': tianyan_ssl,
            'ali_FMP': ali_FMP,
            'ali_load': ali_load,
            'fpt': fpt
          })
          return loadpageTimes
        } catch (error) {
          loadpageTimes.push({
            'connect': '',
            'request': '',
            'receive': '',
            'domAna': '',
            'domReady': '',
            'loadpage': '',
            'tcpTime': '',
            'domBuild': '',
            'resptime': '',
            'frontTime': '',
            'serverCon': '',
            'doneTime': '',
            'dnsTime': '',
            'docDow': '',
            'pageTime': '',
            'sc': '',
            'tianyan_FMP': '',
            'tianyan_tti': '',
            'tianyan_ready': '',
            'tianyan_load': '',
            'tianyan_firstbyte': '',
            'tianyan_dom': '',
            'tianyan_res': '',
            'tianyan_ssl': '',
            'ali_FMP': '',
            'ali_load': '',
            'fpt': ''
          })
          return loadpageTimes
        }
      }
    };

    //= ========================增加业务方面的js植入==================================
    /**
         * 所有业务采集逻辑植入，初始化时加载
         * 都放入busiObj
         */
    function uam_business_run () {
      // 需要植入业务采集，页面的URL和处理实体类配置关系
      // 增加一个数组，保存采集到的业务扩展字段
      uam_config.ext_array = []

      // 增加字段保存采集到的弹框信息
      uam_config.alertMessage = ''

      // 增加一个字段保存所有的业务处理对象
      uam_config.busiObj = {}

      // 通用的工具
      uam_config.busiObj.utils = {

        getUUnumber: function () {
          try {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)
          } catch (e) {
          }
        },

        /**
                 * 生成UUID随机数
                 */
        ranndomUUID: function () {
          try {
            return (this.getUUnumber() + this.getUUnumber() + '' + this.getUUnumber() + '' + this.getUUnumber() +
                            '' + this.getUUnumber() + '' + this.getUUnumber() + this.getUUnumber() + this.getUUnumber())
          } catch (e) {
          }
        }
      },

      // -----------------------------------------------------------------------------
      // 通用业务
      uam_config.busiObj.common = {

        urlPageHandlerMap: {
          // "hook": uam_config.busiObj.cbss_continueTrade,
        },

        /**
                     * 通过URL，查找处理器（这里是简单实用idnexOf判断查找，
                     * 如果是复杂判断，可以在相关的页面处理器中单独实现 fn_fentch 方法）
                     * @param uam_pageurl
                     */
        businessFentcher: function (uam_pageurl, that_uam_e, globalUamConfig) {
          if (!uam_pageurl) {
            return
          }

          // 遍历查找已经注册的处理器
          var handlerMap = uam_config.busiObj.common.urlPageHandlerMap
          var targetHandler

          for (var key in handlerMap) {
            targetHandler = handlerMap[key]
            if (!targetHandler) {
              continue
            }
            if (uam_pageurl.indexOf(key) > -1) {
              return targetHandler
            }

            // 如果处理器，实现了匹配URL的方法，则直接调用
            if (targetHandler.fn_fentch) {
              var declareInnerHanlder = targetHandler.fn_fentch(uam_pageurl, that_uam_e, globalUamConfig)
              return declareInnerHanlder
            }
          }
        },
        /**
                     * 为扩展属性集合，增加一个扩展属性和值
                     * @param key
                     * @param value
                     */
        addExtKV: function (key, value) {
          var temp = {}
          temp[key] = value
          uam_config.ext_array.push(temp)
        },
        addExtjsonObj: function (jsonObj) {
          uam_config.ext_array.push(jsonObj)
        },

        /**
                     * 生成虚单id
                     */
        generateVirtualId: function () {
          return uam_config.busiObj.utils.ranndomUUID()
        }
      }
    }

    /**
         * 业务处理器执行统一入口
         * 在（点击、双击、键盘按键等操作时，统一就只调用这一个function）
         *
         * 这个方法依赖1：uam_config对象，所以必须在事件触发的时候调用这里
         * 依赖2： uam_business_run函数，业务逻辑的植入
         *
         * 后期扩展方式：只需要实现对应页面的处理器即可
         * uam_config.busiObj.cbss_openuserNew
         * cbss_openuserNew则是相关的业务处理器对象。
         * cbss_openuserNew内部需要提供 ：listener()，方法，fn_fentch方法（或是在最开始通过url注册）
         *
         * 入参：当前页面的pageurl，当前的event事件对象 和 外层的uam_config便于处理器自行扩展
         *
         */
    function uam_business_eventHandler_run (that_uam_pageurl, that_uam_e, that_uam_config) {
      try {
        // 根据URL找处理器，调用一个方法根据URL直接返回处理器，如果没有，则遍历处理器集合，调用他们的匹配url方法
        var currentPageHandler = uam_config.busiObj.common.businessFentcher(that_uam_pageurl, that_uam_e, uam_config)

        // 否则，执行处理器的listener方法
        if (currentPageHandler && currentPageHandler.listener) {
          currentPageHandler.listener(that_uam_pageurl, that_uam_e, that_uam_config)
        }
      } catch (e) {
      }
    }
    //= ==============================================================================================================================
  } catch (e) {

  }

  // 添加单页面应用相关
  var getEntriesCount = 0
  var fetchReqArgs = []

  try {
    var _fetch = fetch

    window.fetch = function (_, options) {
      // 生成业务uuid推送全局变量
      var tianyanbtnuuid = gettyuuidlast()
      if (findPaq('systemCode') == '90002' || findPaq('systemCode') == '10002') {
        if (options && options.headers) {
          options.headers = { ...options.headers, 'btnuuid': tianyanbtnuuid }
        }
      }
      try {
        const startTime = new Date().valueOf()
        return _fetch.apply(this, arguments).then(res => {
          try {
            fetchReqArgs = {
              arguments: arguments,
              res: res,
              resHeader: res.headers.get('X-Trace-Id'),
              startTime,
              endTime: new Date().valueOf()
            }

            fetchDataSendNew(res, tianyanbtnuuid)
            return res
          } catch (error) { }
        })
      } catch (error) { }
    }
  } catch (error) {

  }

  //= ==============Axios监听 start=================================================================================
  try {
    if (window.XMLHttpRequest) {
      // 保存原生的 open 方法
      const xhrOpen = XMLHttpRequest.prototype.open
      // 保存原生的 send 方法
      const xhrSend = XMLHttpRequest.prototype.send
      const axiosData = []
      const _handleEvent = (event, arg, resHeader) => {
        try {
          if (
            event &&
                event.currentTarget &&
                event.currentTarget.responseURL.indexOf('jsAgent') < 0 &&
                event.currentTarget.responseURL.indexOf('sockjs-node') < 0 &&
                event.currentTarget.responseURL.indexOf('umiui') < 0
          ) {
            function stringConnect () {
              this._str_ = new Array()
            }
            stringConnect.prototype.append = function (key, value) {
              this._str_.push(key + '=' + encodeURIComponent(encodeURIComponent(value)))
            }
            stringConnect.prototype.toString = function () {
              return this._str_.join('&')
            }

            var rspTime = new Date().getTime()
            var respParam = new stringConnect()
            var tianyanbtnuuid = gettyuuidlast()

            let method = ''
            let requestStartTime = ''

            for (let index = 0; index < axiosData.length; index++) {
              if (event.target.responseURL.includes(axiosData[index].url)) {
                method = axiosData[index].method
                requestStartTime = axiosData[index].startTime
                axiosData.splice(index, 1)
              }
            }

            respParam.append('is_async', 0)
            respParam.append('code_txt', event.target.status)

            respParam.append('req_url', event.target.responseURL)
            respParam.append('req_method', method)
            respParam.append('traceId', resHeader || '')

            respParam.append('token', '')
            respParam.append('userAgent', window.navigator.userAgent)
            respParam.append('reqtime', requestStartTime || '')
            respParam.append('btnuuid', tianyanbtnuuid || '')
            respParam.append('sessionId', this.sessionId || '')
            respParam.append('data_type', this.dataType || '')
            respParam.append('req_btn_value', uam_xy_obj.current_btn_value || '')
            respParam.append('req_btn_innerText', uam_xy_obj.current_btn_innerText || '')
            respParam.append('event_type', 'ajax')

            respParam.append('pageTitle', uam_win.document.title)
            respParam.append('referUrl', uam_win.document.referrer)
            respParam.append('rsp_btn_value', uam_xy_obj.current_btn_value || '')
            respParam.append('rsp_btn_innerText', uam_xy_obj.current_btn_innerText || '')
            respParam.append('areaCode', uam_xy_obj.current_area_code || '')
            respParam.append(
              'pageSign',
              uam_win.document.title + '_' + window.pageSignTimeStamp + '_' + pageSignUUID
            )
            respParam.append('systemCode', findPaq('systemCode'))
            respParam.append('provinceCode', findPaq('provinceCode'))
            respParam.append('forumLoginId', findPaq('forumLoginId'))
            respParam.append('forumLoginSource', findPaq('forumLoginSource'))
            respParam.append('forumProvinceName', findPaq('forumProvinceName'))

            respParam.append('rsp_time', rspTime)

            var staffId = dealTianyanStaffId()
            respParam.append('staffId', staffId)

            respParam.append('rep_code', event.target.status)
            respParam.append('timeout', this.timeout)
            respParam.append('is_err', 1)

            respParam.append('firstbyte_time', this._firstbyte_time || 0)
            respParam.append('cb_start_time', this._firstbyte_time || 0)
            respParam.append('lastbyte_time', this._lastbyte_time || 0)
            respParam.append('cb_end_time', this._lastbyte_time || 0)
            respParam.append('read_byte_elapsed', this._lastbyte_time - this._firstbyte_time || 0)
            respParam.append('rsp_size', event.target.loaded)
            // //浏览器结构信息
            var info = getBrowserObj()
            respParam.append('browser', info.browser + info.version) // 浏览器
            respParam.append('version', info.browserName) // 版本
            respParam.append('os', info.os + info.osVersion) // 操作系统
            respParam.append('device', info.device) // 设备
            respParam.append('engine', info.engine) // 内核
            respParam.append('language', info.language) // 语言

            respParam.append('requestURL', event.target.responseURL) // 请求的地址
            respParam.append('elapsed', rspTime - requestStartTime) // 请求的耗时（单位：ms）
            var rspAllData = respParam
            var backend_server_ipAndPort = findPaq('server_url')
            backend_server_ipAndPort = backend_server_ipAndPort.replace('sendqueue', 'sendjsrsp')

            var uam_url = backend_server_ipAndPort + '?' + rspAllData

            createAImgRequest(uam_url)
          }
        } catch (error) {}
      }

      // 重写 open
      XMLHttpRequest.prototype.open = function () {
        // 先在此处取得请求的method

        axiosData.push({
          url: arguments[1],
          method: arguments[0],
          startTime: new Date().getTime()
        })
        // 再调用原生 open 实现重写
        return xhrOpen.apply(this, arguments)
      }
      XMLHttpRequest.setRequestHeader('Content-Type', 'application/json')
      // 重写 send
      XMLHttpRequest.prototype.send = function () {
        if (this['addEventListener']) {
          this['addEventListener']('error', e => _handleEvent(e, arguments)) // 失败
          this['addEventListener']('load', e => _handleEvent(e, arguments)) // 完成
          this['addEventListener']('abort', e => _handleEvent(e, arguments)) // 取消
        } else {
          const tempStateChange = this['onreadystatechange']
          this['onreadystatechange'] = function (event) {
            tempStateChange.apply(this, arguments)
            if (this.readyState === 4) {
              _handleEvent(event, arguments)
            }
          }
        }
        // 再调用原生 send 实现重写
        return xhrSend.apply(this, arguments)
      }
    }
  } catch (error) {}
  //= ==============Axios监听 end=================================================================================

  //= ==============fetch监听 start=================================================================================
  function fetchDataSendNew (res, tianyanbtnuuid) {
    try {
      const findPaq = function (key) {
        try {
          for (var i = uam_xy_paq.length - 1; i >= 0; i--) {
            var uam_param = uam_xy_paq[i]
            if (uam_param[0] == key) {
              return uam_param[1]
            }
          }
        } catch (e) { }
      }

      const reqUrlExp = /(?:.*?\/){3}([^\/?#].*)/ // 用于正则匹配出api地址

      const checkFetchMethodAndCode = function (key) {
        try {
          let method = ''
          let statusCode = 0
          let resHeader = ''
          method = fetchReqArgs.arguments[1].method || 'GET'
          statusCode = fetchReqArgs.res.status
          resHeader = fetchReqArgs.resHeader

          switch (key) {
            case 'method':
              return method
            case 'statusCode':
              return statusCode
            case 'header':
              return resHeader
            case 'elapsed':
              return fetchReqArgs.endTime - fetchReqArgs.startTime
            default:
              break
          }
        } catch (error) { }
      }

      function stringConnect () {
        this._str_ = new Array()
      }

      stringConnect.prototype.append = function (key, value) {
        this._str_.push(key + '=' + encodeURIComponent(encodeURIComponent(value)))
      }
      stringConnect.prototype.toString = function () {
        return this._str_.join('&')
      }

      var rspTime = new Date().getTime()
      var respParam = new stringConnect()

      respParam.append('is_async', 0)
      respParam.append('code_txt', checkFetchMethodAndCode('statusCode'))
      respParam.append('req_url', `/${res.url.match(reqUrlExp)[1]}`)
      respParam.append('req_method', checkFetchMethodAndCode('method'))
      respParam.append('traceId', checkFetchMethodAndCode('header') || '')

      respParam.append('token', '')
      respParam.append('userAgent', window.navigator.userAgent)
      respParam.append('reqtime', this._reqTime || '')
      respParam.append('btnuuid', tianyanbtnuuid || '')
      respParam.append('sessionId', this.sessionId || '')
      respParam.append('data_type', this.dataType || '')
      respParam.append('req_btn_value', uam_xy_obj.current_btn_value || '')
      respParam.append('req_btn_innerText', uam_xy_obj.current_btn_innerText || '')
      respParam.append('event_type', 'ajax')

      respParam.append('pageTitle', uam_win.document.title)
      respParam.append('referUrl', uam_win.document.referrer)
      respParam.append('rsp_btn_value', uam_xy_obj.current_btn_value || '')
      respParam.append('rsp_btn_innerText', uam_xy_obj.current_btn_innerText || '')
      respParam.append('areaCode', uam_xy_obj.current_area_code || '')
      respParam.append('pageSign', uam_win.document.title + '_' + window.pageSignTimeStamp + '_' + pageSignUUID)
      respParam.append('systemCode', findPaq('systemCode'))
      respParam.append('provinceCode', findPaq('provinceCode'))
      respParam.append('forumLoginId', findPaq('forumLoginId'))
      respParam.append('forumLoginSource', findPaq('forumLoginSource'))
      respParam.append('forumProvinceName', findPaq('forumProvinceName'))

      respParam.append('rsp_time', rspTime)

      var staffId = dealTianyanStaffId()
      respParam.append('staffId', staffId)

      respParam.append('rep_code', checkFetchMethodAndCode('statusCode'))
      respParam.append('timeout', this.timeout)
      respParam.append('is_err', 1)

      respParam.append('firstbyte_time', this._firstbyte_time || 0)
      respParam.append('cb_start_time', this._firstbyte_time || 0)
      respParam.append('lastbyte_time', this._lastbyte_time || 0)
      respParam.append('cb_end_time', this._lastbyte_time || 0)
      respParam.append('read_byte_elapsed', this._lastbyte_time - this._firstbyte_time || 0)
      respParam.append('rsp_size', 0)
      // 浏览器结构信息
      var info = getBrowserObj()
      respParam.append('browser', info.browser + info.version) // 浏览器
      respParam.append('version', info.browserName) // 版本
      respParam.append('os', info.os + info.osVersion) // 操作系统
      respParam.append('device', info.device) // 设备
      respParam.append('engine', info.engine) // 内核
      respParam.append('language', info.language) // 语言

      respParam.append('requestURL', res.url) // 请求的地址
      respParam.append('elapsed', checkFetchMethodAndCode('elapsed')) // 请求的耗时（单位：ms）
      // respParam.append('resSizeRegular', item.decodedBodySize / 1024); //请求返回大小（压缩前，单位kb）
      // respParam.append('resSizeZip', item.encodedBodySize / 1024); //请求返回大小（压缩后，单位kb）
      // respParam.append("pageTitle", encodeURIComponent(encodeURIComponent(uam_win.document.title)));    //页面标题
      var rspAllData = respParam
      var backend_server_ipAndPort = findPaq('server_url')
      backend_server_ipAndPort = backend_server_ipAndPort.replace('sendqueue', 'sendjsrsp')

      var uam_url = backend_server_ipAndPort + '?' + rspAllData

      createAImgRequest(uam_url)
    } catch (error) { }
  }

  try {
    // 获取随机数
    tynewgetuuid = function () {
      try {
        return (tynewgetUUnumber() + tynewgetUUnumber() + '' + tynewgetUUnumber() + '' + tynewgetUUnumber() +
                    '' + tynewgetUUnumber() + '' + tynewgetUUnumber() + tynewgetUUnumber() + tynewgetUUnumber())
      } catch (e) {
      }
    }

    tynewgetUUnumber = function () {
      try {
        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)
      } catch (e) {
      }
    }

    addEvent(window, 'pushState', function (e) {
      window.pageSignTimeStamp = new Date().getTime()
      window.pageSignUUID = tynewgetuuid()

      window.addEventListener(
        'popstate',
        function (e) {
          window.pageSignTimeStamp = new Date().getTime()
          window.pageSignUUID = tynewgetuuid()
        },
        false
      )
    })
    window.onhashchange = function () {
      window.pageSignTimeStamp = new Date().getTime()
      window.pageSignUUID = tynewgetuuid()
    }
  } catch (error) { }
  //= ==============fetch监听 end=================================================================================
})(window, {})

function gettyuuidlast () {
  try {
    return (gettyUUnumberlast() + gettyUUnumberlast() + '' + gettyUUnumberlast() + '' + gettyUUnumberlast() + '' + gettyUUnumberlast() + '' + gettyUUnumberlast() + gettyUUnumberlast() + gettyUUnumberlast())
  } catch (e) {
  }
};

function gettyUUnumberlast () {
  try {
    return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1)
  } catch (e) {
  }
};

function getBrowserObj () {
  var info = {}
  try {
    info = uam_xy_obj.loadBroserFinder()
  } catch (e) {
    try {
      return uam_xy_obj.loadBroserFinder()
    } catch (e) {

    }
  }
  return info
}

try {
  setTimeout(function () {
    var tianyanreq = {}
    try {
      if ($ && $.ajaxSetup) {
        tianyanreq = $
      } else if (jQuery && jQuery.ajaxSetup) {
        tianyanreq = jQuery
      } else {
        return
      }
    } catch (e) {
      return
    }

    tianyanreq.ajaxSetup({
      beforeSend: function (request) {
        try {
          // 生成请求时间
          var exetime = new Date()
          var reqtime = exetime.getTime()
          this._reqTime = reqtime
          var btnuuid = gettyuuidlast()
          // 生成业务uuid推送全局变量
          this._btnuuid = btnuuid
          this.sessionId = uam_xy_obj.sessionId
          var sendstr = ''
          if (uam_xy_obj) {
            for (var index in uam_xy_obj) {
              sendstr += '&' + index + '=' + encodeURIComponent(encodeURIComponent(uam_xy_obj[index]))
            }
          }
          request.setRequestHeader('btnuuid', btnuuid)

          function stringConnect () {
            this._str_ = new Array()
          }

          stringConnect.prototype.append = function (key, value) {
            this._str_.push(key + '=' + encodeURIComponent(encodeURIComponent(value)))
          }
          stringConnect.prototype.toString = function () {
            return this._str_.join('&')
          }

          // 构建请求参数
          var reqParam = new stringConnect()
          reqParam.append('req_time', reqtime)
          reqParam.append('btnuuid', this._btnuuid)
          reqParam.append('sessionId', this.sessionId)
        } catch (e) {
        }
      },
      complete: function (xhr, data) {
        try {
          //
          var traceId = xhr.getResponseHeader('X-Trace-Id')
          var sendstr = ''
          if (uam_xy_obj) {
            for (var index in uam_xy_obj) {
              sendstr += '&' + index + '=' + encodeURIComponent(encodeURIComponent(uam_xy_obj[index]))
            }
          }
          var rspobj = new Object()
          var exetime = new Date()
          rspobj.reqtime = exetime.getTime()
          rspobj.btnuuid = this.tempuuid
          rspobj.busitype = 'jsresponse'
          var tiantandara = data
          if (tiantandara) {
            tiantandara = tiantandara.length > 3000 ? tiantandara.substring(0, 3000) : tiantandara
          }

          /**
                     * 发送请求给后端
                     * @param uam_url 拼接的url
                     */
          function createAImgRequest (uam_url) {
            var uam_Image = new Image()
            uam_Image.onload = function () {
              uam_Image = null
            }
            uam_Image.src = uam_url
          }

          function stringConnect () {
            this._str_ = new Array()
          }

          stringConnect.prototype.append = function (key, value) {
            this._str_.push(key + '=' + encodeURIComponent(encodeURIComponent(value)))
          }
          stringConnect.prototype.toString = function () {
            return this._str_.join('&')
          }
          var rspTime = new Date().getTime()
          var respParam = new stringConnect()
          respParam.append('token', '')
          respParam.append('userAgent', window.navigator.userAgent)

          respParam.append('reqtime', this._reqTime)
          respParam.append('btnuuid', this._btnuuid)
          respParam.append('sessionId', this.sessionId)
          respParam.append('traceId', traceId || '')
          respParam.append('req_url', this.url)
          respParam.append('req_method', this.type)
          respParam.append('is_async', this.async)
          respParam.append('data_type', this.dataType)
          respParam.append('req_btn_value', uam_xy_obj.current_btn_value)
          respParam.append('req_btn_innerText', uam_xy_obj.current_btn_innerText)
          respParam.append('event_type', 'ajax')

          respParam.append('requestURL', uam_xy_obj.uam_pageurl)
          respParam.append('referUrl', uam_win.document.referrer)
          respParam.append('pageTitle', uam_xy_obj.pageTitle)
          respParam.append('rsp_btn_value', uam_xy_obj.current_btn_value)
          respParam.append('rsp_btn_innerText', uam_xy_obj.current_btn_innerText)
          respParam.append('areaCode', uam_xy_obj.current_area_code || '')
          respParam.append('systemCode', findPaq('systemCode'))
          respParam.append('rsp_time', rspTime)

          var staffId = dealTianyanStaffId()
          respParam.append('staffId', staffId)
          respParam.append('provinceCode', findPaq('provinceCode'))
          respParam.append('forumLoginId', findPaq('forumLoginId'))
          respParam.append('forumLoginSource', findPaq('forumLoginSource'))
          respParam.append('forumProvinceName', findPaq('forumProvinceName'))

          respParam.append('rsp_body', '')
          // respParam.append("rsp_body", tiantandara);

          respParam.append('rep_code', 200)
          respParam.append('code_txt', this.statusText)
          respParam.append('timeout', this.timeout)
          respParam.append('elapsed', rspTime - this._reqTime)

          respParam.append('is_err', 1)

          respParam.append('firstbyte_time', this._firstbyte_time || 0)
          respParam.append('cb_start_time', this._firstbyte_time || 0)
          respParam.append('lastbyte_time', this._lastbyte_time || 0)
          respParam.append('cb_end_time', this._lastbyte_time || 0)
          respParam.append('read_byte_elapsed', (this._lastbyte_time - this._firstbyte_time) || 0)
          respParam.append('rsp_size', 0)
          // 浏览器结构信息
          var info = getBrowserObj()
          respParam.append('browser', info.browser + info.version) // 浏览器
          respParam.append('version', info.browserName) // 版本
          respParam.append('os', info.os + info.osVersion) // 操作系统
          respParam.append('device', info.device) // 设备
          respParam.append('engine', info.engine) // 内核
          respParam.append('language', info.language) // 语言
          var rspAllData = respParam
          var reqAllData = this._req_ajx_url
          var backend_server_ipAndPort = findPaq('server_url')
          backend_server_ipAndPort = backend_server_ipAndPort.replace('sendqueue', 'sendjsrsp')

          var uam_url = backend_server_ipAndPort +
                        '?' + rspAllData + '&' + reqAllData
          createAImgRequest(uam_url)
        } catch (e) {

        }
        return data
      },
      dataFilter: function (data) {
        return data
      }
    })
  }, 5000)
} catch (e) {
}
/** ================================================================================================================
 *
 *  植入json.stringify逻辑
 *
 *  =================================================================================================================
 */

function tianyan_stringify (object) {
  var type = typeof object
  var simpleTypes = ['number', 'boolean', 'undefined', 'string', 'function']

  // 数组对象的
  if (object instanceof Array) {
    var len = object.length
    var resArr = []
    for (var i = 0; i < len; i++) {
      var itemType = typeof object[i]
      if (indexOf(simpleTypes, itemType) > -1) {
        // undefined特殊处理，数组中变成null
        if (itemType != 'undefined' && itemType != 'function') {
          resArr.push(parseSimpleObject(object[i]))
        } else {
          resArr.push('null')
        }
      } else {
        // 递归处理JS数组中的复杂元素
        resArr.push(tianyan_stringify(object[i]))
      }
    }

    return '[' + resArr.join(',') + ']'
  }

  // 普通object对象
  if (object instanceof Object) {
    if (object == null) {
      return 'null'
    }

    var resArr = []

    for (var name in object) {
      var itemType = typeof object[name]
      if (indexOf(simpleTypes, itemType) > -1) {
        // undefined特殊处理，object中不编码
        if (itemType != 'undefined' && itemType != 'function') {
          resArr.push('"' + name + '":' + parseSimpleObject(object[name]))
        }
      } else {
        resArr.push('"' + name + '":' + tianyan_stringify(object[name]))
      }
    }

    return '{' + resArr.join(',') + '}'
  }

  function parseSimpleObject (object) {
    var type = typeof object
    if (type == 'string') {
      return '"' + object.toString().replace('"', '\\"') + '"'
    }

    if (type == 'number' || type == 'boolean') {
      return object.toString()
    }

    if (type == 'undefined') {
      return 'undefined'
    }

    if (type == 'function') {
      return
    }

    return '"' + object.toString().replace('"', '\\"') + '"'
  }

  function indexOf (arr, val) {
    for (var i = 0; i < arr.length; i++) {
      if (arr[i] === val) {
        return i
      }
    }

    return -1
  }
}

// ============================================stringify逻辑结束====================================================================

function dealTianyanStaffId () {
  if (findPaq('systemCode') == '90002' || findPaq('systemCode') == '10002') {
    var tempPersist = window.sessionStorage.getItem('persist:model')
    var tempJson = eval('(' + tempPersist + ')')
    var tempUser = tempJson['user']
    var tempCurrentUser = tempUser['currentUser']
    if (tempCurrentUser['userName']) {
      return tempCurrentUser['userName'] + '-' + tempCurrentUser['realName']
    }
  } else {
    return findPaq('staffId')
  }
}

// 单页面应用相关

function addEvent (el, name, fn) {
  if (el.addEventListener) return el.addEventListener(name, fn, false) // 在火狐中会执行这一句
  //   return el.attachEvent('on' + name, fn); //在ie中执行这一句
}

try {
  var _wr = function (type) {
    var orig = history[type]
    return function () {
      var rv = orig.apply(this, arguments)
      var e = new Event(type)
      e.arguments = arguments
      window.dispatchEvent(e)
      return rv
    }
  }
  history.pushState = _wr('pushState')
  history.replaceState = _wr('replaceState')
} catch (error) {

}

```



